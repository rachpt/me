<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rachpt&#39;s Blog</title>
  
  <subtitle>时间总是追不上</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://rachpt.me/"/>
  <updated>2018-05-07T05:48:17.332Z</updated>
  <id>http://rachpt.me/</id>
  
  <author>
    <name>rachpt</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>flexget-and-transmission-on-ubuntu</title>
    <link href="http://rachpt.me/2018/05/07/flexget-and-transmission-on-ubuntu/"/>
    <id>http://rachpt.me/2018/05/07/flexget-and-transmission-on-ubuntu/</id>
    <published>2018-05-06T16:30:00.000Z</published>
    <updated>2018-05-07T05:48:17.332Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Flexget 进阶。自动下载与删除。<br><a id="more"></a></p></blockquote><h1 id="安装-flexget"><a href="#安装-flexget" class="headerlink" title="安装 flexget"></a>安装 flexget</h1><p>flexget 需要 python2.7, 3.4, 3.5 或者 3.6。（居然支持3.6了  (￣▽￣)／ ）</p><p>命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install flexget</span><br><span class="line"></span><br><span class="line">flexget -V <span class="comment"># 检查版本</span></span><br><span class="line">flexget check <span class="comment"># 检查配置文件</span></span><br><span class="line">flexget --<span class="built_in">test</span> execute <span class="comment"># 测试</span></span><br><span class="line">flexget status <span class="comment"># 状态</span></span><br><span class="line">flexget --db-cleanup <span class="comment"># 初始化 SQLite数据库</span></span><br><span class="line">flexget execute <span class="comment"># 运行</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> flexget <span class="comment"># 查看安装路径，用于 crontab 定时任务</span></span><br></pre></td></tr></table></figure></p><p><a href="http://rachpt.me/2018/03/23/notes-for-shell-scripting-bible/">crontab 配置参考</a> 。</p><p>Control daemon:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo status flexget</span><br><span class="line">sudo stop flexget</span><br><span class="line">sudo start flexget</span><br></pre></td></tr></table></figure><h1 id="yml-配置文件"><a href="#yml-配置文件" class="headerlink" title="yml 配置文件"></a>yml 配置文件</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">templates:</span></span><br><span class="line"><span class="attr">  default:</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      host:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">9091</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">username</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">'password'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    free_space:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"><span class="attr">      space:</span> <span class="number">10240</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    download:</span> <span class="string">/home/rc/Downloads</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  limit_size:</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">512</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">61440</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  clean:</span></span><br><span class="line"><span class="attr">    clean_transmission:</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">      host:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">9091</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">username</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">'password'</span></span><br><span class="line"><span class="attr">      finished_for:</span> <span class="number">7</span> <span class="string">days</span></span><br><span class="line"><span class="attr">      tracker:</span> <span class="string">xxxxxxx|xxxxx</span></span><br><span class="line"><span class="attr">      delete_files:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">    disable:</span> <span class="string">details</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  ttg_wiki:</span></span><br><span class="line"><span class="attr">    if:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'1080p' in title"</span><span class="string">:</span> <span class="string">reject</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'720p' + 'WiKi' in title"</span><span class="string">:</span> <span class="string">accept</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="attr">  byr_test:</span></span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    accept_all:</span> <span class="literal">yes</span> </span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line">      <span class="comment">#- limit_size</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">52</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">6144</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      ratio:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  wiki:</span>   </span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    accept_all:</span> <span class="literal">yes</span> </span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">limit_size</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">clean</span> </span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line">      <span class="comment">#ratio: 2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  hdsky:</span></span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">clean</span></span><br><span class="line"><span class="attr">    if:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'Complete' in title"</span><span class="string">:</span> <span class="string">reject</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'iPad' in title"</span><span class="string">:</span> <span class="string">accept</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">400</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">10240</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      ratio:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/mp4</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">##----------------##</span></span><br></pre></td></tr></table></figure><p>#  号注释，yml 需要严格对齐，使用<code>两个空格缩进</code>，形成代码块，yml 文件的语法格式：<code>字段+冒号+空格+内容</code> 。</p><p>templates:  # 模板。</p><p>tasks:  # 任务。</p><p><a href="https://flexget.com/Plugins/transmission" target="_blank" rel="noopener">transmission 模块</a>需要安装，另外，transmission-daemon或者 GUI 需要设置 rpc。</p><p>模块transmission password 记得加上引号。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install transmissionrpc</span><br></pre></td></tr></table></figure><p>space 单位 M，content_size 一样，用于限制大小。download 放的是torrent文件路径。path 为种子内容下载路径。</p><p>具体可以参考 <a href="https://flexget.com/Configuration" target="_blank" rel="noopener">官方文档</a>。</p><p>使用 transmission 模块和使用 watch-dir 相比，更灵活更方便，对不同的 rss ，可以设置不同的分享率 ratio ，以及不同的下载路径 path 。但是添加了的 torrent 文件需要自己写其他脚本删除或者移动。参见<a href="#tr-auto-delete_">其他</a>。</p><h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1><p>使用 flexget 的自动删种可能效果不是很好，需要使用另外的脚本处理。</p><p>待续……</p><p><a href="https://blog.wangyan.org/bt-shell-transmission-clean/" target="_blank" rel="noopener">参考1</a> ，<a href="https://linux.die.net/man/1/transmission-remote" target="_blank" rel="noopener">参考2 transmission-remote</a> ，<a href="http://www.kalso.net/archives/781" target="_blank" rel="noopener">参考3</a> 。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>如果想在种子发布一段时间后猜开始下载，比如越过 新种免费期，可以使用下面的脚本配合 watch-dir 实现。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author rachpt@126.com</span></span><br><span class="line"><span class="comment">#date 2018-05-07</span></span><br><span class="line"><span class="comment">#-----------设置-------------#</span></span><br><span class="line"><span class="comment"># flexget torrent 下载路径</span></span><br><span class="line">flexgetPath=<span class="string">"/home/rachpt/Downloads/temp/"</span></span><br><span class="line"><span class="comment"># transmission watch-dir</span></span><br><span class="line">autoDownloadPath=<span class="string">"/home/rachpt/Downloads/ttg/"</span></span><br><span class="line"><span class="comment"># 间隔时间，秒</span></span><br><span class="line">intervalsTime=25200</span><br><span class="line"><span class="comment">#----------------------------#</span></span><br><span class="line">filelist=$(find <span class="variable">$flexgetPath</span> -iname <span class="string">"*.torrent*"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用换行分割</span></span><br><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">modifiedTime=`<span class="built_in">stat</span> -c %Y <span class="string">"<span class="variable">$filename</span>"</span>`</span><br><span class="line">    currentTime=`date +%s`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [  $[<span class="variable">$currentTime</span> - <span class="variable">$modifiedTime</span>] -gt <span class="variable">$intervalsTime</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">mv -f <span class="string">"<span class="variable">$filename</span>"</span> <span class="string">"<span class="variable">$autoDownloadPath</span><span class="variable">$&#123;flexgetPath##*/&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br></pre></td></tr></table></figure><p><code>&lt;span id=&quot;tr-auto-delete&quot;&gt;</code>transmission 完成下载后自动移动种子文件到指定文件夹脚本。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author rachpt@126.com</span></span><br><span class="line"><span class="comment"># required dumptorrent to find the real name of torrent</span></span><br><span class="line"><span class="comment"># get dumptorrent here: https://sourceforge.net/projects/dumptorrent/files/</span></span><br><span class="line"><span class="comment">#----------------设置------------------#</span></span><br><span class="line">dumptorrentPath=<span class="string">"/usr/local/bin/dumptorrent"</span></span><br><span class="line">flexgetPath=<span class="string">"/home/rachpt/Downloads/ttg/"</span></span><br><span class="line">moveTotPath=<span class="string">"/home/rachpt/Downloads/finish/"</span></span><br><span class="line">logoPath=<span class="string">"/home/rachpt/Downloads/finish/info"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------日志函数---------------#</span></span><br><span class="line"><span class="keyword">function</span> printLogo &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"================================="</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"匹配成功"</span>  &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"下载到了："</span><span class="variable">$TR_TORRENT_DIR</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"种子编号："</span><span class="variable">$TR_TORRENT_ID</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"于："</span><span class="variable">$TR_TIME_LOCALTIME</span> <span class="string">" \c"</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"完成对："</span><span class="variable">$TR_TORRENT_NAME</span><span class="string">" 的移动！"</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------处理空格---------------#</span></span><br><span class="line"><span class="keyword">function</span> moveBlank &#123;</span><br><span class="line">find <span class="string">"<span class="variable">$1</span>"</span> -name <span class="string">"* *"</span> |</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> name</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">na=$(<span class="built_in">echo</span> <span class="variable">$name</span> | tr <span class="string">' '</span> <span class="string">'.'</span>)</span><br><span class="line">mv <span class="string">"<span class="variable">$name</span>"</span> <span class="variable">$na</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#--------------移动种子文件-------------#</span></span><br><span class="line">moveBlank <span class="variable">$flexgetPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成点分割文件名</span></span><br><span class="line"><span class="keyword">function</span> createMoveToPath &#123;</span><br><span class="line">dotTrPath=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$newname</span>"</span> | sed <span class="string">'s/[ ][ ]*/\./g'</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="variable">$dotTrPath</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">totalMoveToPath=<span class="string">"<span class="variable">$moveTotPath</span><span class="variable">$dotTrPath</span>.torrent"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">totalMoveToPath=<span class="string">"<span class="variable">$moveTotPath</span><span class="variable">$newname</span>.torrent"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filelist=$(find <span class="variable">$flexgetPath</span> -iname <span class="string">"*.torrent.*"</span>)</span><br><span class="line"><span class="comment"># 使用换行分割</span></span><br><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">newname=`<span class="variable">$dumptorrentPath</span> <span class="string">"<span class="variable">$filename</span>"</span> | gawk <span class="string">'BEGIN&#123;FS=":"&#125; /Name/&#123;print $2&#125;'</span>`</span><br><span class="line">    newname=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$newname</span>"</span> | sed <span class="string">'s/^ [ ]*//g'</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$newname</span>"</span> = <span class="string">"<span class="variable">$TR_TORRENT_NAME</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">createMoveToPath</span><br><span class="line">mv -f <span class="string">"<span class="variable">$filename</span>"</span> <span class="string">"<span class="variable">$totalMoveToPath</span>"</span>  &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"></span><br><span class="line">printLogo</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br><span class="line"><span class="comment">#----------------移动完成---------------#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Flexget 进阶。自动下载与删除。&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ubuntu" scheme="http://rachpt.me/tags/ubuntu/"/>
    
      <category term="flexget" scheme="http://rachpt.me/tags/flexget/"/>
    
  </entry>
  
  <entry>
    <title>Windows 使用笔记-02</title>
    <link href="http://rachpt.me/2018/04/02/windows-note-02/"/>
    <id>http://rachpt.me/2018/04/02/windows-note-02/</id>
    <published>2018-04-02T04:00:00.000Z</published>
    <updated>2018-04-13T04:38:04.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>承诺好的笔记，一直没写，一是不好意思，因为我已经转向 linux 了，不好说啥，二是才学疏浅，想到没必要将自己的观点强加到他人身上。</p><p>但还是继续，承诺需要兑现。</p></blockquote><a id="more"></a><h1 id="装机后驱动"><a href="#装机后驱动" class="headerlink" title="装机后驱动"></a>装机后驱动</h1><p>不管是核心显卡还是独立显卡，刚刚装好系统后，显示一般都比较粗大，甚至是模糊，亮度最大，不能调节，这是驱动的问题，需要更新驱动。如果不适很老的机器，或者硬件特殊，只需要使用 windows 的系统更新即可自动装好合适的驱动。</p><p>你可能需要先激活系统才能进行自定义设置。激活工具推荐 01笔记文末 链接。</p><p>如果嫌 windows 系统更新的下载速度慢，可以使用 <a href="https://pan.baidu.com/s/1eSvl02m" target="_blank" rel="noopener">绿色版的 驱动精灵</a>安装驱动，推荐 在 <a href="http://www.zdfans.com/" target="_blank" rel="noopener">http://www.zdfans.com/</a> 上下载，或者 baidu，如果你经验足够丰富不会下到 <strong>下载器</strong> 安装流氓软件。</p><p>右键 <code>此电脑</code>  —-&gt; <code>管理</code> —-&gt;  <code>设备管理器</code>（或者 <code>ctrl + x</code>   —-&gt; <code>m</code>，或者 <code>右键</code> 开始 —-&gt; <code>设备管理器(M)</code>）进入设备管理器，没有叹号，表面几乎所有驱动 ok 了。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy2n877tnj21030nz0wq.jpg" alt="pic"></p><h1 id="关闭-windows-的自动更新"><a href="#关闭-windows-的自动更新" class="headerlink" title="关闭 windows 的自动更新"></a>关闭 windows 的自动更新</h1><p>为什么要关闭 自动更新，会不会不安全？</p><p>几乎没有坏的影响，好的到是有，之所以 你背流氓 安装 xx管家、xx助手等不是电脑中毒了，二是你自己手贱所致。如何下载到正确的软件 我之后会提到。别用软件管家！真的是没必要，贪图眼前的便利准会掉坑里。</p><p>自动更新，windows 防火墙，windows defender 这三个不是同一个东西。</p><p>如何关闭。（家庭版需要其他方法，自己百度）</p><p>点击 <code>运行</code>，或者     <code>win + R</code> ，输入 <code>gpedit.msc</code> ；或者 打开 <code>cmd</code> 输入 <code>gpedit</code> 。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy310p3rwj20r70gsq3u.jpg" alt="pic"></p><p>依次展开 <code>计算机配置</code> —-&gt; <code>管理模板</code> —-&gt; <code>windows 组件</code> —-&gt;  <code>windows 更新</code>。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy358unh2j20ky0eowfm.jpg" alt="pic"></p><p>将 <code>配置自动更新</code>  （双击打开） 改成 <code>已禁用</code> ，这是最重要的，其他的可以不改，如果你想尝试 ，请仔细阅读 说明。可以将 <code>自动更新频率</code> 设为 <code>禁用</code>。</p><p>同样的道理，你可以在这里面 禁用 onedrive  defender等。</p><p>理论上讲，子要你不自己取点 设置（<code>win+I</code>） 里面的 检查更新，系统不会自己 更新。</p><h1 id="运行库"><a href="#运行库" class="headerlink" title="运行库"></a>运行库</h1><p>Microsoft Visual C++ Redist xxxx，有些软件提醒你安装运行库，</p><p>推荐  <a href="http://www.zdfans.com/systemplus/yunxingku" target="_blank" rel="noopener">zdfans</a>  上面的运行库。说一下，这个 zdfans 大部分软件不是 他自己做的，是搬运，或者说是一种备份。自己百度 常用运行库也是可以的。</p><h1 id="别提醒我-是否"><a href="#别提醒我-是否" class="headerlink" title="别提醒我 是否"></a>别提醒我 是否</h1><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy3kbspuuj210q0p644g.jpg" alt="pic"></p><p>我知道需要运行的软件很安全，不需要这个。怎么去掉？</p><p>打开 <code>控制面板</code>（<code>win + R</code>然后输入 <code>ctontrol</code>）不行的话你点点点找一下，</p><p>展开 <code>用户账户</code>，然后再点击 <code>用户账户</code>。接着 <code>更改用户账户控制设置</code>。</p><p>滑块移到最下面，确定。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy3rh9rg3j20v80lracg.jpg" alt="pic"></p><h1 id="显示此电脑"><a href="#显示此电脑" class="headerlink" title="显示此电脑"></a>显示此电脑</h1><p><code>win + I</code> 打开设置，或者你点点点找一下，不同版本可能不一样。</p><p><code>个性化</code> —-&gt; <code>主题</code> —-&gt; <code>桌面图标设置</code>，把<code>计算机</code>勾上，其他的按需勾选。</p><p>又或者 <code>桌面 右键</code> —-&gt; <code>个性化</code> —-&gt; <code>主题</code> —-&gt; <code>桌面图标设置</code>。</p><p>点点点，没什么好说的。</p><h1 id="更干净的界面"><a href="#更干净的界面" class="headerlink" title="更干净的界面"></a>更干净的界面</h1><p>推荐 软件 <code>dism++</code>， 下载请出门百度，第一个就是（如果你没被广告）。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy41gicfdj20ks06yq3n.jpg" alt="pic"></p><p>​               这个  <a href="https://www.chuyu.me/zh-Hans/index.html" target="_blank" rel="noopener">Dism++ x86/x64</a> ，就是下载链接。</p><p> 绿色软件 无需安装，解压后 推荐放到 D  盘。</p><p>dism++ 可以干的事：</p><ul><li>清理垃圾，清理 C盘的windows 目录，我一般是全部勾上清理。</li><li>去掉 桌面 <code>快捷方式 字样</code>，<code>快捷方式箭头</code>，以及<code>小盾牌</code>，具体自己去该软件里面点点点找一下。</li><li>精简 <code>文件资源管理器</code> （就是点开此电脑的界面）左侧 的东西，比如网络、家庭组、可移动设备、以及此电脑下的 6个（或者其他）文件夹。</li><li>找回 window 照片查看器，去掉 ie 右上角笑脸。</li><li>关闭 安全警告等等 。</li><li>卸载 uwp 应用，不懂别乱卸！</li></ul><h1 id="显示复选框-扩展名等"><a href="#显示复选框-扩展名等" class="headerlink" title="显示复选框 扩展名等"></a>显示复选框 扩展名等</h1><p>如下图没什么好说的。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy4cthwiaj20no0g43zm.jpg" alt="pic"></p><h1 id="清理注册表"><a href="#清理注册表" class="headerlink" title="清理注册表"></a>清理注册表</h1><p>软件卸载后一般会在注册表里面留下无用的记录，可以使用 <code>CCleaner</code>清理，这软件不免费，推荐 zdfans 上面下载，或者其他的 什么 大眼仔啥的。</p><p>这个软件也可以清理系统 垃圾 ，主要是 user 目录下的，注意清理别勾选 浏览器的 cookie，否则你每次都要登录。</p><p>使用绿色版！</p><h1 id="一些日用软件"><a href="#一些日用软件" class="headerlink" title="一些日用软件"></a>一些日用软件</h1><ol><li><p>bandizip</p><p><a href="https://www.bandisoft.com/bandizip/cn/" target="_blank" rel="noopener">点击到官网</a>，免费，无广告，图标主题不错！兼容 rar、7z、zip、等各种格式，压缩 推荐 使用 7z 格式，别用 rar 这个收费格式，也别用各种破解版 winRAR 了（别提免费版），好压、360压啥的也不要用。而且支持不解压 看图。自动解压功能也很好用，具体看官网的介绍。</p><p><a href="https://www.7-zip.org/" target="_blank" rel="noopener">7zip</a> 也不错，可是界面有点丑。不嫌弃用这个也可以的。</p></li><li><p>potplayer</p><p>棒子出品，质量不错，解码强，无广告，可玩性很丰富，有很多快捷键。</p><p><a href="http://potplayer.daum.net/?lang=zh_CN" target="_blank" rel="noopener">点击到官网</a> ，安装的时候记得把推荐的额外解码器都装上，保平安。如果嫌烦，可以关闭它的自动更新。开源 全平台的 <a href="http://www.videolan.org/" target="_blank" rel="noopener">vlc</a> 也是不错的，论外观易用性，还是首推 pot。我 Linux 上最喜欢的简洁 <a href="https://mpv.io/" target="_blank" rel="noopener">mpv</a> (全平台)播放器是不会推荐的，那是极客的最爱。</p></li><li><p>TIM</p><p>比 QQ 好，干净些许。</p></li><li><p>Sumatra PDF</p><p>免费小巧的 pdf &amp; 电子书（mobi、epub等）阅读软件，如果你不需要 做标记，用这个准没错，有绿色便携版，推荐使用安装版，可以关联格式。</p><p><a href="https://www.sumatrapdfreader.org/free-pdf-reader.html" target="_blank" rel="noopener">点击到官网</a> ，LaTeX 的御用 阅读器。</p></li><li><p>Gimp &amp; photoshop</p><p>这年头，不会P图，好意思说自己会用电脑？</p><p>免费 开源 跨平台 就用 Gimp，只用 win 的话，网上搜个 破解版的 ps cc，有绿色破解版，自己baidu，这玩意儿 熟能生巧。</p><p><a href="https://www.gimp.org/" target="_blank" rel="noopener">点击到 Gimp 官网</a> 。Gimp 比 PS 小巧很多，有中文官方文档。</p></li><li><p>Snipaste</p><p><a href="https://www.snipaste.com/" target="_blank" rel="noopener">点击到官网</a> ，比 QQ（TIM） 的强大，图标好看，快捷键强。免费。希望 linux 快点出来。</p></li><li><p>写代码</p><p>Visual Studio Code，atom，sublime 破解版，notepad++，notepad2 都不错。</p><p>如果只是想看 linux 生成的 文本文件 ，notepad2 代替默认的记事本很便利。</p></li><li><p>IDM &amp; FDM</p><p>下载器，区别前者收费，后者免费，但是前者感觉更好。迅雷什么的还是不要用。</p><p><a href="https://www.freedownloadmanager.org/download.htm" target="_blank" rel="noopener">Get Free Download Manager</a> ，<a href="https://pan.lanzou.com/i0lcb4d" target="_blank" rel="noopener">IDM -旧版- 绿色破解版</a> 。</p></li><li><p>视频压制</p><p>推荐使用 <a href="https://maruko.appinn.me/" target="_blank" rel="noopener">小丸工具箱</a>，如果你不会 使用 ffmpeg 的话，megui 啥的大部分人也用不着。</p></li><li><p>隆重介绍一下火绒</p><p>想不出什么理由让我不推荐它。如果你不放心 defender ，别用管家、别用卫士！</p><p><a href="https://www.huorong.cn/" target="_blank" rel="noopener">点击到官网</a> ，注意 设置取消 它的 主页推广，如果你不想被它换主页。</p></li></ol><p>先这样吧 :joy: 。</p><p>推荐阅读 <a href="https://amazing-apps.gitbooks.io/windows-apps-that-amaze-us/content/zh-CN/" target="_blank" rel="noopener">Windows 绝赞应用</a> 。 可以先关注 <a href="http://amazingapps.org/" target="_blank" rel="noopener">http://amazingapps.org/</a> 这个，截止目前就 windows 的比较完整。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;承诺好的笔记，一直没写，一是不好意思，因为我已经转向 linux 了，不好说啥，二是才学疏浅，想到没必要将自己的观点强加到他人身上。&lt;/p&gt;
&lt;p&gt;但还是继续，承诺需要兑现。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="windows" scheme="http://rachpt.me/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>use-linux-format-not-dos</title>
    <link href="http://rachpt.me/2018/04/01/use-linux-format-not-dos/"/>
    <id>http://rachpt.me/2018/04/01/use-linux-format-not-dos/</id>
    <published>2018-04-01T07:08:21.000Z</published>
    <updated>2018-04-01T07:43:27.309Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>写个 shell 脚本格式化输出数据，出现诡异 bug，郁闷了一天，早上看书之际，dos2unix 出现到脑海中，乌云散去，果然如此。</p></blockquote><a id="more"></a><h1 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h1><p>有一个 txt 文件，行数很多，需要复制其中的部分数据到 excel 统计，一个文件大概要复制 40-50 次，懒人总是想捷径。首先想到的是使用 shell 脚本实现，因为 python 才开始，先是看书，4-5天，写脚本，各种碰壁，于是 用了低级方法可以干活，隔几天后 改进，如下。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">tempfile=`mktemp const.XXXXXXXX`</span><br><span class="line"></span><br><span class="line">sed -n <span class="string">'/+\/-/p'</span> <span class="variable">$1</span> &gt; <span class="variable">$tempfile</span></span><br><span class="line">bulkmodulus=`gawk <span class="string">'/=/ &#123; print $4 &#125;'</span> <span class="variable">$tempfile</span>`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (( j = 4; j &lt; 7; j = j + 2 ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">for</span> (( i = 1; i &lt; 22; i++ ))</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">cijTempName=`cat <span class="variable">$tempfile</span> | gawk -v circle=<span class="variable">$j</span> <span class="string">'$1 == loop &#123;print $circle&#125;'</span> loop=<span class="variable">$i</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$i</span> -ge 2 ] &amp;&amp; [ <span class="variable">$i</span> -le 6 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$cijTempName</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"-\t\c"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$cijTempName</span><span class="string">"\t\c"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$cijTempName</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"0\t\c"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$cijTempName</span><span class="string">"\t\c"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'bulk:'</span> <span class="variable">$bulkmodulus</span> </span><br><span class="line"></span><br><span class="line">rm -f <span class="variable">$tempfile</span> <span class="variable">$tempfile2</span></span><br></pre></td></tr></table></figure><p>数据大概如下：</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpx6q3w2kjj211c0qdtf0.jpg" alt="pic"></p><p>做了部分模糊处理。</p><h1 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h1><p>需要提出  cij 的 第 4列 以及 第 6 列。使用制表符在各自行中打印。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpx6wnmz17j20ki093mzn.jpg" alt="pic"></p><p>结果出乎我的意料，第二行的 误差值 只打印了两个。</p><p>百思不得其解，我甚至已经考虑 使用 awk 的 FS ORS 各种折腾。最后皆以失败告终。</p><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>今天图书馆看书，突然想到我这个 txt 文件是在 windows 生成的，自然 换行符与 linux/unix 的不同，如此以来自然能够解释 中间部分正常，而尾巴部分出现诡异。</p><p>于是，加上 <code>dos2unix Constants.txt</code> ，完美解决问题。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpx6w9o52yj20ki093772.jpg" alt="pic"></p><p>存在即是合理，不是莫名其妙，只是你不知道。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;写个 shell 脚本格式化输出数据，出现诡异 bug，郁闷了一天，早上看书之际，dos2unix 出现到脑海中，乌云散去，果然如此。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>use-outer-variables-in-awk</title>
    <link href="http://rachpt.me/2018/03/31/use-outer-variables-in-awk/"/>
    <id>http://rachpt.me/2018/03/31/use-outer-variables-in-awk/</id>
    <published>2018-03-31T08:54:27.000Z</published>
    <updated>2018-03-31T09:25:46.067Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>awk 命令中使用外部定义的变量。</p></blockquote><a id="more"></a><p>做好了的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (( i = 1; i &lt; 22; i++ ))</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">cijTempName=`cat <span class="variable">$tempfile</span> | gawk <span class="string">'$1 == loop &#123;print $4&#125;'</span> loop=<span class="variable">$i</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$i</span> -ge 2 ] &amp;&amp; [ <span class="variable">$i</span> -le 6 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$cijTempName</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"-\t\c"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$cijTempName</span><span class="string">"\t\c"</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$cijTempName</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"0\t\c"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="variable">$cijTempName</span><span class="string">"\t\c"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>使用 awk（gawk 是 AWK 的 GNU 版本）获取每行第一个位置的元素，并与外面的 loop counter 比较，如果比配，则打印这一行中的 第四个元素，否则，1-6 loop 中打印 “-”，后面的打印 0。</p><p>关键点 gawk 中判断 \$1 与 loop counter 如何处理。</p><blockquote><p>格式：awk ‘{action}’  变量名=变量值   </p></blockquote><p>这样传入变量，可以在action中获得值。 注意：变量名与值放到’{action}’后面。</p><p>如果要在 BEGIN 的action不能获得变量值，使用 参数 v，即是 <code>awk -v</code> 。这里没用到。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpw3zwkxvnj20f607udgy.jpg" alt="pic"></p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpw4kk42izj20g205cdh3.jpg" alt="pic"></p><p><a href="https://www.cnblogs.com/chengmo/archive/2010/10/03/1841753.html" target="_blank" rel="noopener">参考内容</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;awk 命令中使用外部定义的变量。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="awk" scheme="http://rachpt.me/tags/awk/"/>
    
  </entry>
  
  <entry>
    <title>the-gateway-of-materials-studio</title>
    <link href="http://rachpt.me/2018/03/31/the-gateway-of-materials-studio/"/>
    <id>http://rachpt.me/2018/03/31/the-gateway-of-materials-studio/</id>
    <published>2018-03-31T03:13:07.000Z</published>
    <updated>2018-03-31T03:55:16.638Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>关于 Materials studio 的 Remote Gateway。</p></blockquote><a id="more"></a><p>MS 默认 使用 <a href="http://localhost:18888" target="_blank" rel="noopener">http://localhost:18888</a> 查看进程，之前一直不知道 <code>Edti</code> 的用户名与密码是啥，google 了下，找到官方帮助文档，看了下了解了些许，这里记录一下。</p><h1 id="开关"><a href="#开关" class="headerlink" title="开关"></a>开关</h1><p>找到路径 <code>~/Accelrys/MaterialsStudio8.0/etc/Gateway</code> 与自己的安装路径有关。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./gwstart</span><br><span class="line"><span class="comment">#  开</span></span><br><span class="line">./gwstop</span><br><span class="line"><span class="comment"># 关</span></span><br><span class="line">./gwrestop</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#目录下的其他可执行文件功能，如其名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行计算中 需要保持 这个 是开得状态。</span></span><br></pre></td></tr></table></figure><h1 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在刚才的目录下</span></span><br><span class="line"></span><br><span class="line">./gwusers /list</span><br><span class="line"><span class="comment"># 列出 用户</span></span><br><span class="line"></span><br><span class="line">./gwusers /add rachpt</span><br><span class="line"><span class="comment"># 添加用户</span></span><br></pre></td></tr></table></figure><p>默认情况下 使用</p><div class="note success"><p><strong>gatekeeper</strong></p><p><em>密码： 空</em></p></div><p>管理 emote Gateway 。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpvv0vvyybj20mi09yq3q.jpg" alt="pic"></p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpvu4c62suj20ow0lt3zw.jpg" alt="pic"></p><p><a href="https://sites.ualberta.ca/dept/chemeng/software/Documentation/MaterialsStudio_8.0_InstallGuide.pdf" target="_blank" rel="noopener"> 参考内容</a> 。</p><p><a href="/2018/01/11/install-materials-studio-on-ubuntu/">更多请看</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;关于 Materials studio 的 Remote Gateway。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="DFT" scheme="http://rachpt.me/categories/DFT/"/>
    
    
      <category term="castep" scheme="http://rachpt.me/tags/castep/"/>
    
      <category term="ms" scheme="http://rachpt.me/tags/ms/"/>
    
  </entry>
  
  <entry>
    <title>a-bash-script-for-pt-signin</title>
    <link href="http://rachpt.me/2018/03/29/a-bash-script-for-pt-signin/"/>
    <id>http://rachpt.me/2018/03/29/a-bash-script-for-pt-signin/</id>
    <published>2018-03-29T02:47:06.000Z</published>
    <updated>2018-04-01T15:23:29.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>写一个脚本，每天 定时自动签到 PT 站。</p></blockquote><a id="more"></a><div class="note warning"><p>加了 图片验证的比较复杂，目前搞不定，只对不需要 验证码的签到有效。</p></div><p>脚本如下，自己需要修改 cookie ，或者其他。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author: rachpt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hyperay 签到"</span></span><br><span class="line">curl <span class="string">'https://www.hyperay.org/sign_in.php'</span> \</span><br><span class="line">-H <span class="string">'Host: www.hyperay.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'Cookie: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">--data <span class="string">'action=sign_in'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hdhome 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://hdhome.org/attendance.php'</span> \</span><br><span class="line">-H <span class="string">'Host: hdhome.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Cookie: __xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">-H <span class="string">'Upgrade-Insecure-Requests: 1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"6v 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'http://bt.neu6.edu.cn/forum.php'</span> \</span><br><span class="line">-H <span class="string">'Host: bt.neu6.edu.cn'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Cookie: LRpW_2132_ulastactivity=fb5dVHpNQ0vxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">-H <span class="string">'Upgrade-Insecure-Requests: 1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hdchina 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://hdchina.org/plugin_sign-in.php?cmd=signin'</span> \</span><br><span class="line">-H <span class="string">'Host: hdchina.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H <span class="string">'Cookie: __cxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">--data <span class="string">'cmd=signin'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"TTG 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">tempPage=`mktemp ttgpage.XXXXXX`</span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://totheglory.im/'</span> \</span><br><span class="line">-H <span class="string">'Host: totheglory.im'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-Type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H <span class="string">'Cookie: __xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> &gt; <span class="variable">$tempPage</span></span><br><span class="line"></span><br><span class="line">myTimestamp=`gawk <span class="string">'/token/&#123;print $3&#125;'</span> <span class="variable">$tempPage</span> | gawk <span class="string">'BEGIN&#123;FS="\""&#125; &#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line">myToken=`gawk <span class="string">'/token/&#123;print $5&#125;'</span> <span class="variable">$tempPage</span> | gawk <span class="string">'BEGIN&#123;FS="\""&#125; &#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://totheglory.im/signed.php'</span> \</span><br><span class="line">-H <span class="string">'Host: totheglory.im'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-Type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H <span class="string">'Cookie: __xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">--data <span class="string">'signed_timestamp=$myTimestamp&amp;signed_token=$myToken'</span></span><br><span class="line"></span><br><span class="line">rm -f <span class="variable">$tempPage</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"所有签到完成！"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>其中 TTG 和其他的有区别，需要获取 但前时间 time 以及 token，比较懒，curl 的头可以封装 成函数，这里 直接 使用 firefox 复制的 curl 链接。:joy:  😂  😂  </p><p><img src="https://ww3.sinaimg.cn/large/675bda05ly1fptinhxx2dj21120n2q72.jpg" alt="pic"></p><p>定时 任务 请参考 <a href="/2018/03/23/notes-for-shell-scripting-bible/">here</a> , <a href="/2017/12/18/notes-for-ubuntu/#定时任务">and here</a> 。</p><p>第二版，添加 cmct.tv ，TTG 的需要修改 cookie 格式，以及变量存在的行使用 双引号！</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author: rachpt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hyperay 签到"</span></span><br><span class="line">curl <span class="string">'https://www.hyperay.org/sign_in.php'</span> \</span><br><span class="line">-H <span class="string">'Host: www.hyperay.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'Cookie: xxxxxxxxxxxxxx'</span>  \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">--data <span class="string">'action=sign_in'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hdhome 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://hdhome.org/attendance.php'</span> \</span><br><span class="line">-H <span class="string">'Host: hdhome.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Cookie: xxxxxxxxxxxxxx'</span>  \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">-H <span class="string">'Upgrade-Insecure-Requests: 1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"6v 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'http://bt.neu6.edu.cn/forum.php'</span> \</span><br><span class="line">-H <span class="string">'Host: bt.neu6.edu.cn'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Cookie: xxxxxxxxxxxxxx'</span>  \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">-H <span class="string">'Upgrade-Insecure-Requests: 1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hdchina 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://hdchina.org/plugin_sign-in.php?cmd=signin'</span> \</span><br><span class="line">-H <span class="string">'Host: hdchina.org'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H <span class="string">'Cookie: xxxxxxxxxxxxxx'</span>  \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> \</span><br><span class="line">--data <span class="string">'cmd=signin'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"TTG 签到"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">tempPage=`mktemp ttgpage.XXXXXX`</span><br><span class="line"></span><br><span class="line">curl  -c ttgcookie <span class="string">'https://totheglory.im/'</span> \</span><br><span class="line">-H <span class="string">'Host: totheglory.im'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-Type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H <span class="string">'Cookie: __cfduid=xxxxxxxxxxxxxx; uid=XXXXXX; pass=xxxxxxxx'</span> \</span><br><span class="line">-H <span class="string">'DNT: 1'</span> \</span><br><span class="line">-H <span class="string">'Connection: keep-alive'</span> &gt; <span class="variable">$tempPage</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># myTimestamp=`gawk '/token/&#123;print $3&#125;' $tempPage | gawk 'BEGIN&#123;FS="\""&#125; &#123;print $2&#125;'`</span></span><br><span class="line"><span class="comment"># 不需要上面这个！</span></span><br><span class="line">myToken=`gawk <span class="string">'/token/&#123;print $5&#125;'</span> <span class="variable">$tempPage</span> | gawk <span class="string">'BEGIN&#123;FS="\""&#125; &#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line">myLaccess=`cat <span class="string">"ttgcookie"</span> | awk <span class="string">'/laccess/&#123;print $7&#125;'</span>`</span><br><span class="line"></span><br><span class="line">curl <span class="string">'https://totheglory.im/signed.php'</span> \</span><br><span class="line">-H <span class="string">'Host: totheglory.im'</span> \</span><br><span class="line">-H <span class="string">'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0'</span> \</span><br><span class="line">-H <span class="string">'Accept: */*'</span> \</span><br><span class="line">-H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span> --compressed \</span><br><span class="line">-H <span class="string">'Content-Type: application/x-www-form-urlencoded'</span> \</span><br><span class="line">-H <span class="string">'X-Requested-With: XMLHttpRequest'</span> \</span><br><span class="line">-H “Cookie: __cfduid=xxxxxxxxxxxxxx; uid=XXXXXX<span class="string">'; pass=xxxxxxxx ” \</span></span><br><span class="line"><span class="string">-H '</span>DNT: 1<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Connection: keep-alive<span class="string">' \</span></span><br><span class="line"><span class="string">--data “signed_timestamp=$myLaccess&amp;signed_token=$myToken”</span></span><br><span class="line"><span class="string"># 注意 使用了变量的地方 使用 双引号 不能使用 单引号。</span></span><br><span class="line"><span class="string">rm -f $tempPage ttgcookie</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo '</span><span class="string">'</span></span><br><span class="line"><span class="string">echo "CMCT.tv 签到"</span></span><br><span class="line"><span class="string">echo '</span><span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">curl '</span>https://cmct.tv/plugin.php?id=dsu_paulsign:sign&amp;operation=qiandao&amp;infloat=1&amp;inajax=1<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Host: cmct.tv<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Accept: */*<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<span class="string">' --compressed \</span></span><br><span class="line"><span class="string">-H '</span>Content-Type: application/x-www-form-urlencoded<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>X-Requested-With: XMLHttpRequest<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Cookie: xxxxxxxxxxxxxx<span class="string">'  \</span></span><br><span class="line"><span class="string">-H '</span>DNT: 1<span class="string">' \</span></span><br><span class="line"><span class="string">-H '</span>Connection: keep-alive<span class="string">' \</span></span><br><span class="line"><span class="string">--data '</span>formhash=04fcd2f6&amp;qdxq=ym&amp;qdmode=1&amp;todaysay=%C7%A9%B5%BD%C0%B2%C0%B2%C0%B2%A1%A3%A1%A3%A1%A3&amp;fastreply=0<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo '</span><span class="string">'</span></span><br><span class="line"><span class="string">echo "所有签到完成！"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exit</span></span><br></pre></td></tr></table></figure><p>注意 使用了变量的地方 使用 双引号 不能使用 单引号。TTG cookie 中的 PHPSESSID 字段 不需要。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpxejwowekj20vm0hytfq.jpg" alt="pic"></p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpxegwh418j20vm0hy46g.jpg" alt="pic"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;写一个脚本，每天 定时自动签到 PT 站。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
      <category term="pt" scheme="http://rachpt.me/tags/pt/"/>
    
  </entry>
  
  <entry>
    <title>change-sidebar-width-of-firefox</title>
    <link href="http://rachpt.me/2018/03/28/change-sidebar-width-of-firefox/"/>
    <id>http://rachpt.me/2018/03/28/change-sidebar-width-of-firefox/</id>
    <published>2018-03-28T13:12:24.000Z</published>
    <updated>2018-03-28T14:11:36.691Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Firefox 的侧边书签很好用，但是在低分辨率屏幕上，最小宽度总是太宽，有办法突破最小值吗，答案是有的。不知道现在侧边栏插件适配了没有。这里记录在 ubuntu 平台使用自定义 css 样式改小侧边栏的最小值。</p></blockquote><a id="more"></a><h1 id="配置文件路径"><a href="#配置文件路径" class="headerlink" title="配置文件路径"></a>配置文件路径</h1><p>在 firfox 地址栏输入 <code>about:profiles</code> ，找到配置文件路径。如下图。</p><p><img src="https://ww4.sinaimg.cn/large/675bda05ly1fpsvjnovh4j20rx0kd40e.jpg" alt="pic"></p><p>在 Root Directory 中创建 <code>chrome</code> 文件夹，然后在其中新建一个名为 <code>userChrome.css</code> 的 <code>css</code> 文件。</p><h1 id="CSS-文件"><a href="#CSS-文件" class="headerlink" title="CSS 文件"></a>CSS 文件</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span>,<span class="selector-id">#sidebar</span>,<span class="selector-id">#sidebar-header</span> &#123;</span><br><span class="line">   <span class="attribute">max-width</span>: <span class="number">300px</span> <span class="meta">!important</span>;</span><br><span class="line">   <span class="attribute">min-width</span>: <span class="number">50px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启 firefox 生效，效果 如上图。</p><p><a href="https://www.howtogeek.com/209320/how-to-set-up-and-use-multiple-profiles-user-accounts-in-firefox/" target="_blank" rel="noopener">参考内容1</a>，<a href="https://www.howtogeek.com/334716/how-to-customize-firefoxs-user-interface-with-userchrome.css/" target="_blank" rel="noopener">内容2</a>，<a href="https://bbs.kafan.cn/forum.php?mod=viewthread&amp;tid=1692356&amp;page=1#pid30582934" target="_blank" rel="noopener">内容3</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Firefox 的侧边书签很好用，但是在低分辨率屏幕上，最小宽度总是太宽，有办法突破最小值吗，答案是有的。不知道现在侧边栏插件适配了没有。这里记录在 ubuntu 平台使用自定义 css 样式改小侧边栏的最小值。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="firefox" scheme="http://rachpt.me/tags/firefox/"/>
    
  </entry>
  
  <entry>
    <title>transmission-settings</title>
    <link href="http://rachpt.me/2018/03/25/transmission-settings/"/>
    <id>http://rachpt.me/2018/03/25/transmission-settings/</id>
    <published>2018-03-25T12:51:06.000Z</published>
    <updated>2018-03-25T14:31:36.740Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>之前不会设置 transmission ，习惯了 ut 的点点点，觉得很是不好用，对其 json 的配置文件很不友好的形式感到恶心，不过现在有了更多的 linux 命令行与 shell 脚本知识后，再看 transmission，真心佩服如此灵活的配置。什么 qttorrent，deluge 什么的，一边去，看我 transmission。<br>这里记录一些 配置心得。<br><a id="more"></a></p></blockquote><p>transmission 有好几个版本，带有用户形图界面 GUI 的 GTK+、QT，完整命令行的 cli，以及守护进程的 daemon。<br>其中 daemon版没有任何 GUI界面，需要一个例外的软件管理它控制它，remote 或者 webgui。</p><p>下面说的是 daemon 版的设置，对其他的也是有效的。只是 <code>settings.json</code> 的位置读一样。</p><h1 id="rpc"><a href="#rpc" class="headerlink" title="rpc"></a>rpc</h1><p>rpc 可以理解为 WEBGUI 控制的相关设置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&quot;rpc-authentication-required&quot;: false,</span><br><span class="line"># 是否需要用户名与密码验证，是全局设置</span><br><span class="line">&quot;rpc-bind-address&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line"># 黑名单，全局性的</span><br><span class="line">&quot;rpc-enabled&quot;: true,</span><br><span class="line"># 是否开启 WebGUI，开启其他才有效</span><br><span class="line">&quot;rpc-host-whitelist&quot;: &quot;*example.com&quot;,</span><br><span class="line"># 在有密码验证的时候，host名单，默认 localhost 和所有 ip 地址在其中</span><br><span class="line">&quot;rpc-host-whitelist-enabled&quot;: true,</span><br><span class="line"># 是否开启 host 白名单</span><br><span class="line">&quot;rpc-password&quot;: &quot;×××&quot;,</span><br><span class="line"># 密码，保存后自动转化成加密态</span><br><span class="line">&quot;rpc-port&quot;: 9091,</span><br><span class="line"># 端口，默认9091,ip + : + 端口号，才能访问 tr</span><br><span class="line">&quot;rpc-url&quot;: &quot;/transmission/&quot;,</span><br><span class="line"># 路径名，显示在端口后面，默认即可</span><br><span class="line">&quot;rpc-username&quot;: &quot;××&quot;,</span><br><span class="line"># 用于认证的有户名</span><br><span class="line">&quot;rpc-whitelist&quot;: &quot;127.0.0.1,10.42.0.*&quot;,</span><br><span class="line"># 全局白名单，只有 ip 在其中的客户机才能访问，可以使用通配符</span><br><span class="line"># 这个与 需不需要 用户名与密码验证无关</span><br><span class="line">&quot;rpc-whitelist-enabled&quot;: true,</span><br><span class="line"># 是否开启 白名单访问，除非你只在一个固定的 ip (段)上管理，否则不要开启</span><br></pre></td></tr></table></figure><p><a href="https://github.com/transmission/transmission/wiki/Editing-Configuration-Files#rpc" target="_blank" rel="noopener">参考设置</a> 。</p><h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;script-torrent-done-enabled&quot;: true,</span><br><span class="line"># 每一个种子完成后 执行脚本 开关</span><br><span class="line">&quot;script-torrent-done-filename&quot;: &quot;/home/transmission/auto&quot;,</span><br><span class="line"># 执行的脚本路径，使用 全路径</span><br></pre></td></tr></table></figure><p>可以 使用的变量</p><pre><code>TR_APP_VERSIONTR_TIME_LOCALTIMETR_TORRENT_DIRTR_TORRENT_HASHTR_TORRENT_IDTR_TORRENT_NAME </code></pre><p><a href="https://trac.transmissionbt.com/browser/trunk/extras/send-email-when-torrent-done.sh" target="_blank" rel="noopener">一个例子</a> ,</p><p><a href="https://trac.transmissionbt.com/wiki/Scripts#Script" target="_blank" rel="noopener">参考地址</a> 。</p><p>其他暂时没什么说的，都能百度到，或者看官方文档搞定。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;之前不会设置 transmission ，习惯了 ut 的点点点，觉得很是不好用，对其 json 的配置文件很不友好的形式感到恶心，不过现在有了更多的 linux 命令行与 shell 脚本知识后，再看 transmission，真心佩服如此灵活的配置。什么 qttorrent，deluge 什么的，一边去，看我 transmission。&lt;br&gt;这里记录一些 配置心得。&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="transmission" scheme="http://rachpt.me/tags/transmission/"/>
    
  </entry>
  
  <entry>
    <title>notes-for-shell-scripting-bible</title>
    <link href="http://rachpt.me/2018/03/23/notes-for-shell-scripting-bible/"/>
    <id>http://rachpt.me/2018/03/23/notes-for-shell-scripting-bible/</id>
    <published>2018-03-23T13:23:22.000Z</published>
    <updated>2018-04-02T11:03:03.875Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Linux 命令行与 shell 脚本编程大全（第二版）简要阅读笔记。</p></blockquote><a id="more"></a><p>看到哪儿就就记到哪，没有规律可循。</p><h1 id="cron-时间表"><a href="#cron-时间表" class="headerlink" title="cron 时间表"></a>cron 时间表</h1><p>全称 <code>cron table</code> ，*  通配符，dayofweek 可以使用 三字母格式（mon, tue, wed, thu, fri,  sat, sun）</p><p>对应<code>0-6</code> ，0 为 sun。</p><p>每一月最后一天执行脚本的一种方式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 12 * * * <span class="keyword">if</span> [ `date +%d -d tomorrow` = 01 ] ; <span class="keyword">then</span> ; COMMAND</span><br></pre></td></tr></table></figure><p>crontab -l    列出所有定时任务。</p><p>crontab -e    编辑用户自己的时间表，文件在 <code>/var/spool/cron/</code> 目录下。</p><p>对于不要求使用精确时间的任务，可以在 <code>/etc/cron.*ly</code> 添加脚本。</p><p>hourly，monthly，daily。意如其名，复制到里面即可。</p><p>cron 惟一的问题是假定你 7x24 小时开机。</p><p>anacron 可以执行错过了的 cron 任务。</p><p>cron 时间戳文件在 <code>/var/spool/anacron</code> 下，作业表在 <code>/etc/anacrontab</code>  文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0    2    *    *    6</span><br><span class="line">*    *    *    *    *    *</span><br><span class="line">-    -    -    -    -    -</span><br><span class="line">|    |    |    |    |    |</span><br><span class="line">|    |    |    |    |    + year [optional]</span><br><span class="line">|    |    |    |    +----- day of week (0 - 7) (Sunday=0 or 7)</span><br><span class="line">|    |    |    +---------- month (1 - 12)</span><br><span class="line">|    |    +--------------- day of month (1 - 31)</span><br><span class="line">|    +-------------------- hour (0 - 23)</span><br><span class="line">+------------------------- min (0 - 59)</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpyim8n1ovj20f20cit8w.jpg" alt="pic"></p><p><a href="http://www.atool.org/crontab.php" target="_blank" rel="noopener">在线验证 corntab 表达式</a> 。</p><h1 id="开机运行脚本"><a href="#开机运行脚本" class="headerlink" title="开机运行脚本"></a>开机运行脚本</h1><p>ubuntu 发行版默认开机运行级别 2 ，如果想改，需要自己创建 <code>/etc/inittab</code>文件。</p><p>0，关机；1 ，单用户模式；6 ，关机。2-5 ubuntu 不区分，red hat 区分。</p><p>不同发行版使用的 开机脚本(upstart script)路径不同，如</p><p><code>/etc/rc#.d</code></p><p><code>/etc/init.d</code></p><p><code>/etc/init.d/rc.d</code></p><p>定义自己的</p><p><code>/etc/initio.d/rc.local</code>  dabian 发行版</p><p><code>/etc/rc.local</code>    ubuntn 发行版</p><p>如果使用脚本，需要使用全路径名。</p><h1 id="任务优先级"><a href="#任务优先级" class="headerlink" title="任务优先级"></a>任务优先级</h1><p>使用 <code>nice</code> 与 <code>renice</code> 命令修改优先级。值  -20  –  20 ，越大优先级越小。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nice -d 10 ./test.sh</span><br><span class="line"></span><br><span class="line">renice 12 -p 进程号</span><br></pre></td></tr></table></figure><p>普通用户只能降低优先级，root 用户（或者 sudo）可以随意。</p><h1 id="进程状态-S"><a href="#进程状态-S" class="headerlink" title="进程状态 S"></a>进程状态 S</h1><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">意义</th></tr></thead><tbody><tr><td style="text-align:center">D</td><td style="text-align:center">可中断的休眠状态</td></tr><tr><td style="text-align:center">R</td><td style="text-align:center">运行状态</td></tr><tr><td style="text-align:center">S</td><td style="text-align:center">休眠状态</td></tr><tr><td style="text-align:center">T</td><td style="text-align:center">跟踪状态或停止状态</td></tr><tr><td style="text-align:center">Z</td><td style="text-align:center">僵化状态</td></tr></tbody></table><h1 id="模式空间与保持空间"><a href="#模式空间与保持空间" class="headerlink" title="模式空间与保持空间"></a>模式空间与保持空间</h1><p>一个经典案例，使用模式空间与保持空间实现反序。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'&#123;1!G ; h ; %p &#125;'</span> filepath</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">操作</th></tr></thead><tbody><tr><td style="text-align:center">h</td><td style="text-align:center">模式空间 复制 到保持空间</td></tr><tr><td style="text-align:center">H</td><td style="text-align:center">模式 附加 到 保持</td></tr><tr><td style="text-align:center">g</td><td style="text-align:center">保持 复制到 模式</td></tr><tr><td style="text-align:center">G</td><td style="text-align:center">保持 附加到 模式</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">二者交换</td></tr></tbody></table><p><code>！</code> negate 排除命令。排除末尾行，<strong>\$!</strong> <em>N</em>  ….</p><h1 id="and-符号"><a href="#and-符号" class="headerlink" title="and 符号"></a>and 符号</h1><p>使用<code>&amp;</code>符号 代替 <code>sed</code> 匹配的内容。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"The cat sleeps in his hat"</span> | sed <span class="string">'s/.at/"&amp;"/g'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">The <span class="string">"cat"</span> sleeps <span class="keyword">in</span> his <span class="string">"hat"</span></span><br></pre></td></tr></table></figure><p>上例中可以使用 子字符模块 实现，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"That furry cat is pretty, taht furry hat is pretty"</span> | sed <span class="string">'s/hurry \(.at\)/\1/'</span></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">That cat is pretty, taht hat is pretty</span><br></pre></td></tr></table></figure><p><code>\1</code> 替换第一个模块，<code>\2</code> 替换第二个，以此类推。</p><h1 id="加倍行间距"><a href="#加倍行间距" class="headerlink" title="加倍行间距"></a>加倍行间距</h1><p>一个简单的命令，加倍行间距。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'$!G'</span> datafile</span><br></pre></td></tr></table></figure><p>保持空间 在启动sed的时候默认只有一行空行。</p><p>但是有一个缺点，如果原文件中已经有些许空行，则会出现空行不均。</p><p>改进方法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'/^$/d;$!G'</span> datafile</span><br></pre></td></tr></table></figure><p>先删除空行，然后加倍行。如果空行中有空格，需要例外匹配。</p><h1 id="添加行号"><a href="#添加行号" class="headerlink" title="添加行号"></a>添加行号</h1><p>简单的方法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'='</span> datafile</span><br></pre></td></tr></table></figure><p>但是 行号 与行不在同一行。改进。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'='</span> datafile | sed <span class="string">'N; S/\n/ /'</span></span><br></pre></td></tr></table></figure><p>说明，N 同时处理两行，将其中的 \n 换成 空格。</p><h1 id="打印末尾几行"><a href="#打印末尾几行" class="headerlink" title="打印末尾几行"></a>打印末尾几行</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rachpt@pc ~/desktop $ sed <span class="string">'&#123;</span></span><br><span class="line"><span class="string">&gt; :start</span></span><br><span class="line"><span class="string">&gt; $q</span></span><br><span class="line"><span class="string">&gt; N</span></span><br><span class="line"><span class="string">&gt; 11,$D</span></span><br><span class="line"><span class="string">&gt; b start</span></span><br><span class="line"><span class="string">&gt; &#125;'</span> ms_castep.param</span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">geom_method : BFGS</span><br><span class="line">fixed_npw : <span class="literal">false</span></span><br><span class="line">geom_modulus_est :      500.000000000000000  GPa</span><br><span class="line">calculate_ELF : <span class="literal">false</span></span><br><span class="line">calculate_stress : <span class="literal">true</span></span><br><span class="line">popn_calculate : <span class="literal">true</span></span><br><span class="line">calculate_hirshfeld : <span class="literal">true</span></span><br><span class="line">calculate_densdiff : <span class="literal">false</span></span><br><span class="line">popn_bond_cutoff :        3.000000000000000</span><br><span class="line">pdos_calculate_weights : <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>\$q 末行退出 b 跳转的循环，D 只输出模式空间中的第一行。</p><h1 id="选择性删除空行"><a href="#选择性删除空行" class="headerlink" title="选择性删除空行"></a>选择性删除空行</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rachpt@pc ~/desktop $ sed <span class="string">'/./,/^$/!d'</span> <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">This is a header line</span><br><span class="line"></span><br><span class="line">line 2</span><br><span class="line">line 3</span><br><span class="line"></span><br><span class="line">line 4</span><br><span class="line"></span><br><span class="line">end of file</span><br><span class="line">rachpt@pc ~/desktop $</span><br></pre></td></tr></table></figure><p><code>/./,/^$/</code> 匹配 任意字符行可空行区间。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Linux 命令行与 shell 脚本编程大全（第二版）简要阅读笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>CASTEP-module-in-MS</title>
    <link href="http://rachpt.me/2018/03/23/CASTEP-module-in-MS/"/>
    <id>http://rachpt.me/2018/03/23/CASTEP-module-in-MS/</id>
    <published>2018-03-23T02:56:20.000Z</published>
    <updated>2018-03-23T03:14:45.997Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>网上找的部分 Materials Studio 关于 CASTEP 模块的使用。</p></blockquote><a id="more"></a><h1 id="生成的文件作用"><a href="#生成的文件作用" class="headerlink" title="生成的文件作用"></a>生成的文件作用</h1><p><code>.cell</code>    文件包含 坐标和晶格参数<br><code>.param</code>  文件包含 所有模拟输入参数</p><p>ms 设置 中的 Optimize cell 意思是优化晶格常数，改变 计算精度，自动优化晶包</p><p>得到的文件<br><code>.xsd</code>        最后的优化结构<br><code>.xtd</code>        轨迹文件，包含每一步的结构<br><code>.castep</code>    包含优化信息的输出文件</p><p>计算任何性质，都有 <code>.param</code> <code>.castep</code> 文件输出。</p><p>linux 使用 perl 脚本命令进行 处理</p><p>比如    <code>perl cell2poscar.pl .cell, 生成POSCAR文件</code></p><p><a href="http://muchong.com/zhuanji-322-1" target="_blank" rel="noopener">原出处</a> 。</p><h1 id="关于第一原理的一些理解："><a href="#关于第一原理的一些理解：" class="headerlink" title="关于第一原理的一些理解："></a>关于第一原理的一些理解：</h1><p>（1）第一性原理其实是包括基于密度泛函的从头算和基于Hartree-Fock自洽计算的从头算，前者以电子密度作为基本变量（霍亨伯格-科洪定理），通过求解Kohn-Sham方程，迭代自洽得到体系的基态电子密度，然后求体系的基态性质；后者则通过自洽求解Hartree-Fock方程，获得体系的波函数，求基态性质；<br>评述：K-S方程的计算水平达到了H-F水平，同时还考虑了电子间的交换关联作用。<br>（2）关于DFT中密度泛函的Functional，其实是交换关联泛函，包括LDA，GGA，杂化泛函等等。<br>一般LDA为局域密度近似，在空间某点用均匀电子气密度作为交换关联泛函的唯一变量，多数为参数化的CA-PZ方案；<br>GGA为广义梯度近似，不仅将电子密度作为交换关联泛函的变量，也考虑了密度的梯度为变量，包括PBE,PW,RPBE等方案，BLYP泛函也属于GGA；<br>此外还有一些杂化泛函，B3LYP等。<br>（3）关于赝势<br>在处理计算体系中原子的电子态时，有两种方法，一种是考虑所有电子，叫做全电子法，比如WIEN2K中的FLAPW方法(线性缀加平面波)；此外还有一种方法是只考虑价电子，而把芯电子和原子核构成离子实放在一起考虑，即赝势法，一般赝势法是选取一个截断半径，截断半径以内，波函数变化较平滑，和真实的不同，截断半径以外则和真实情况相同，而且赝势法得到的能量本征值和全电子法应该相同。<br>赝势包括模守恒和超软，模守恒较硬，一般需要较大的截断能，超软势则可以用较小的截断能即可。另外，模守恒势的散射特性和全电子相同，因此一般红外，拉曼等光谱的计算需要用模守恒势。<br>赝势的测试标准应是赝势与全电子法计算结果的匹配度，而不是赝势与实验结果的匹配度，因为和实验结果的匹配可能是偶然的。<br>（4）关于收敛测试：<br>（a）Ecut，也就是截断能，一般情况下，总能相对于不同Ecut做计算，当Ecut增大时总能变化不明显了即可；然而，在需要考虑体系应力时，还需对应力进行收敛测试，而且应力相对于Ecut的收敛要比总能更为苛刻，也就是某个截断能下总能已经收敛了，但应力未必收敛。<br>（b）K-point，即K网格，一般金属需要较大的K网格，采用超晶胞时可以选用相对较小的K网格，但实际上还是要经过测试。<br>（5）关于磁性<br>一般何时考虑自旋呢？举例子，例如BaTiO3中，Ba、Ti和O分别为+2，+4和-2价，离子全部为各个轨道满壳层的结构，就不必考虑自旋了；对于BaMnO3中，由于Mn+3价时d轨道还有电子，但未满，因此需考虑Mn的自旋，至于Ba和O则不必考虑。其实设定自旋就是给定一个原子磁矩的初始值，只在刚开始计算时作为初始值使用，具体的可参照磁性物理。<br>（6）关于几何优化<br>包括很多种了，比如晶格常数和原子位置同时优化，只优化原子位置，只优化晶格常数，还有晶格常数和原子位置分开优化等等。<br>在PRL一篇文章中见到过只优化原子位置，晶格常数用实验值的例子（PRL 100, 186402 (2008)）；也见到过晶格常数先优化，之后固定晶格常数优化原子位置的情况；更多的情况则是Full geometry optimization。<br>一般情况下，也有不优化几何结构直接计算电子结构的，但是对于缺陷形成能的计算则往往要优化。<br>（7）关于软件<br>软件大致分为基于平面波的软件，如CASTEP、PWSCF和ABINIT等等，计算量大概和体系原子数目的三次方相关；还有基于原子轨道线性组合的软件(LCAO)，比如openmx，siesta，dmol等，计算量和体系原子数目相关，一般可模拟较多原子数目的体系。 </p><p>参考文献：<br><em>Designing meaningful density functional theory calculations in materials science—a primer</em></p><p>赝势</p><p>晶包内原子超过30个时，或者晶包内有许多空洞的地方，使用 <code>real-space</code> 效率更高。</p><p><a href="https://wenku.baidu.com/view/cfd6d12e360cba1aa911daa6.html" target="_blank" rel="noopener">出处</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;网上找的部分 Materials Studio 关于 CASTEP 模块的使用。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="DFT" scheme="http://rachpt.me/categories/DFT/"/>
    
    
      <category term="castep" scheme="http://rachpt.me/tags/castep/"/>
    
  </entry>
  
  <entry>
    <title>几个 shell 脚本</title>
    <link href="http://rachpt.me/2018/03/19/sevseral-shell-scripts/"/>
    <id>http://rachpt.me/2018/03/19/sevseral-shell-scripts/</id>
    <published>2018-03-19T14:12:41.000Z</published>
    <updated>2018-03-20T15:06:46.979Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录几个 shell 脚本，高效。</p></blockquote><a id="more"></a><h1 id="批量使用下划线替换路径中的空格"><a href="#批量使用下划线替换路径中的空格" class="headerlink" title="批量使用下划线替换路径中的空格"></a>批量使用下划线替换路径中的空格</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line">find . -name <span class="string">"* *"</span>|</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> name;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">        na=$(<span class="built_in">echo</span> <span class="variable">$name</span> | tr <span class="string">' '</span> <span class="string">'_'</span>)</span><br><span class="line"></span><br><span class="line">        mv <span class="string">"<span class="variable">$name</span>"</span> <span class="variable">$na</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><a href="http://crabdave.iteye.com/blog/2315483" target="_blank" rel="noopener">参考文章</a>。</p><h1 id="Imagemagic-批量缩小图片"><a href="#Imagemagic-批量缩小图片" class="headerlink" title="Imagemagic 批量缩小图片"></a>Imagemagic 批量缩小图片</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d re_size ];<span class="keyword">then</span></span><br><span class="line">  mkdir -p re_size</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">filelist=$(find  -iname <span class="string">"*.jpg"</span>)</span><br><span class="line">FOLDER=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">tempname=<span class="variable">$&#123;filename#*.&#125;</span></span><br><span class="line">newfilename=<span class="variable">$&#123;FOLDER&#125;</span><span class="variable">$&#123;tempname&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d re_size<span class="variable">$&#123;tempname%/*&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">  mkdir -p re_size<span class="variable">$&#123;tempname%/*&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">convert <span class="variable">$newfilename</span> -resize 800 -quality 60 <span class="variable">$&#123;FOLDER&#125;</span>/re_size<span class="variable">$&#123;tempname&#125;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><a href="http://www.jincon.com/archives/249" target="_blank" rel="noopener">参考文章1</a> ，<a href="http://blog.sina.com.cn/s/blog_ba532aea0101bty5.html" target="_blank" rel="noopener">参考2</a>  。</p><h1 id="批量压制视频"><a href="#批量压制视频" class="headerlink" title="批量压制视频"></a>批量压制视频</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="comment"># author: rachpt@126.com</span></span><br><span class="line"><span class="comment">#------settings--------#</span></span><br><span class="line"></span><br><span class="line">myfolder=finshed</span><br><span class="line"><span class="comment"># use sd or ipad</span></span><br><span class="line">compatibility=sd </span><br><span class="line"></span><br><span class="line"><span class="comment">#-------maincode-------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$compatibility</span> == <span class="string">"sd"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">cut=<span class="string">"854x480"</span></span><br><span class="line">videorate=<span class="string">"500k"</span></span><br><span class="line">audiorate=<span class="string">"64k"</span></span><br><span class="line">speed=<span class="string">"fast"</span></span><br><span class="line">profile=<span class="string">"-x264-params \"profile=high:level=4.0\""</span></span><br><span class="line">out=<span class="string">"480p"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$compatibility</span> == <span class="string">"ipad"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">cut=<span class="string">"1280x720"</span></span><br><span class="line">videorate=<span class="string">"2200k"</span></span><br><span class="line">audiorate=<span class="string">"128k"</span></span><br><span class="line">speed=<span class="string">"slow"</span></span><br><span class="line">profile=<span class="string">"-x264-params \"profile=high:level=4.2\""</span></span><br><span class="line">out=<span class="string">"720p"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$myfolder</span> ];<span class="keyword">then</span></span><br><span class="line">  mkdir -p <span class="variable">$myfolder</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">filelist=$(find \( -iname <span class="string">"*.mp4"</span> -o -iname <span class="string">"*.mkv"</span> -o -iname <span class="string">"*.ts"</span> -o -iname <span class="string">"*.avi"</span> -o -iname <span class="string">"*.wmv"</span> \) -a ! -name <span class="string">"*_<span class="variable">$out</span>.mp4"</span>)</span><br><span class="line">FOLDER=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">tempname=<span class="variable">$&#123;filename#*/&#125;</span></span><br><span class="line">newfilename=<span class="variable">$&#123;FOLDER&#125;</span>/<span class="variable">$&#123;tempname&#125;</span></span><br><span class="line">ffmpegcode=<span class="string">"ffmpeg -i <span class="variable">$newfilename</span> -s <span class="variable">$cut</span> -c:v libx264 <span class="variable">$profile</span> -preset <span class="variable">$speed</span> -b:v <span class="variable">$videorate</span>"</span></span><br><span class="line">isempty=<span class="variable">$&#123;filename#*.&#125;</span></span><br><span class="line">isempty=<span class="variable">$&#123;isempty%/*&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$myfolder</span><span class="variable">$isempty</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">  mkdir -p <span class="variable">$myfolder</span><span class="variable">$isempty</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">nohup <span class="variable">$ffmpegcode</span> -pass 1 -an -f mp4 -y /dev/null &amp;&amp; <span class="variable">$ffmpegcode</span> -pass 2 -c:a aac -b:a <span class="variable">$audiorate</span> -strict -2 <span class="variable">$&#123;FOLDER&#125;</span>/<span class="variable">$myfolder</span>/<span class="variable">$&#123;tempname%.*&#125;</span>_<span class="variable">$out</span>.mp4 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">rm -f ffmpeg2pass*</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"finished!"</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录几个 shell 脚本，高效。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Materials Studio CASTEP 迭代次数设置</title>
    <link href="http://rachpt.me/2018/03/14/ms-scf-max-iterations/"/>
    <id>http://rachpt.me/2018/03/14/ms-scf-max-iterations/</id>
    <published>2018-03-14T03:33:31.926Z</published>
    <updated>2018-03-14T03:33:31.926Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>今天遇到 Materials Studio cij 计算失败，提示基态电子最小化失败。检查输出文件，发现蛛丝马迹。</p></blockquote><a id="more"></a><h1 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error check_elec_ground_state : electronic_minimisation of initial cell failed.</span><br><span class="line">Current trace stack:</span><br><span class="line"> check_elec_ground_state</span><br><span class="line"> castep</span><br></pre></td></tr></table></figure><p>检查<code>castep</code> 文件发现下面的片段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">     99  -2.09594982E+004  6.31070540E-001   3.18129596E-006    4013.01  &lt;-- SCF</span><br><span class="line">    100  -2.09594980E+004  6.31017470E-001  -2.41328571E-006    4053.95  &lt;-- SCF</span><br><span class="line">------------------------------------------------------------------------ &lt;-- SCF</span><br><span class="line"> *Warning* max. SCF cycles performed but system has not reached the groundstate.</span><br><span class="line">  </span><br><span class="line">Current total energy, E     =  -20959.33865776     eV</span><br><span class="line">Current free energy (E-TS)  =  -20959.49797103     eV</span><br><span class="line">(energies not corrected for finite basis set)</span><br><span class="line"> .</span><br><span class="line"> .</span><br><span class="line"> .</span><br></pre></td></tr></table></figure><p>意思大概是我设置的 <code>SCF</code> 迭代次数不够，100次后仍然未能找到自恰解。</p><p>回想使用步骤皆是以前的所用的，马上翻看之前成功的<code>castep</code>文件，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">     13  -2.78030685E+004 -1.99686373E+000  -7.49554981E-007     898.41  &lt;-- SCF</span><br><span class="line">     14  -2.78030685E+004 -1.99941165E+000   4.13854537E-008     943.16  &lt;-- SCF</span><br><span class="line">     15  -2.78030685E+004 -2.00267847E+000  -2.65786251E-007     988.60  &lt;-- SCF</span><br><span class="line">------------------------------------------------------------------------ &lt;-- SCF</span><br><span class="line"> </span><br><span class="line">Final energy, E             =  -27803.06847596     eV</span><br><span class="line">Final free energy (E-TS)    =  -27803.06847596     eV</span><br><span class="line">(energies not corrected for finite basis set)</span><br></pre></td></tr></table></figure><p>几乎都是十几次得到自恰解。</p><p>找到问题所在。</p><h1 id="迭代次数我不是设置的500-么"><a href="#迭代次数我不是设置的500-么" class="headerlink" title="迭代次数我不是设置的500 么"></a>迭代次数我不是设置的500 么</h1><p>回到 windows 版的MS，检查设置。我勒个去，<code>Geometry Optimization</code> 的 <code>Max.iterations</code>是500没错，但是<code>Elastic Constants</code> 的 <code>Max.iterations</code>还是默认的100。</p><p>还有 SCF 迭代次数可以设置。</p><p>问题有可能就在这里，提高迭代次数上线，有可能能够收敛，也有可能不能，白白浪费时间。</p><p>截断能、k点、自旋、对称性等都有可能影响收敛。</p><p>没办法，只能试试看了。</p><p>后续如果解决，会详细记录。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;今天遇到 Materials Studio cij 计算失败，提示基态电子最小化失败。检查输出文件，发现蛛丝马迹。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="DFT" scheme="http://rachpt.me/categories/DFT/"/>
    
    
      <category term="castep" scheme="http://rachpt.me/tags/castep/"/>
    
      <category term="ms" scheme="http://rachpt.me/tags/ms/"/>
    
  </entry>
  
  <entry>
    <title>几个 MS 错误</title>
    <link href="http://rachpt.me/2018/03/13/some-error-of-ms/"/>
    <id>http://rachpt.me/2018/03/13/some-error-of-ms/</id>
    <published>2018-03-13T14:02:23.000Z</published>
    <updated>2018-03-13T14:12:33.863Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录几个 MS 的错误。</p></blockquote><a id="more"></a><h1 id="未找到基态能"><a href="#未找到基态能" class="headerlink" title="未找到基态能"></a>未找到基态能</h1><p> 在计算过程中经常遇到计算失败的情况，文件给出的警告是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*Warning* max. SCF cycles performed but system has not reached the groundstate.</span><br><span class="line"></span><br><span class="line"> Warning: electronic minimisation did not converge when finding ground state.</span><br></pre></td></tr></table></figure><p> 和收敛有关的参数主要有能量的<code>CUTOFF</code>，<code>SCF的次数</code>，<code>SMEAR</code>，以及<code>K点选取</code>等，可以尝试一下。</p><h1 id="SCF最大仍不收敛"><a href="#SCF最大仍不收敛" class="headerlink" title="SCF最大仍不收敛"></a>SCF最大仍不收敛</h1><p>一般来说，MS默认的SCF次数100对于小系统是够用的，但是，原子数一多，就不一定了。</p><p>a) 首先结构的合理性，如果自建的结构偏离最低能量太大（或失配度太大），可能会难以收敛。</p><p>b) 取消一切对称性，充分驰豫晶格。</p><p>c) 有些结构本身就是亚稳态，scf的各项收敛指标如果设的太高，对于亚稳态就可能达不到如此的精度。</p><p>d) 改变收敛的条件，降低精度(能量的截断值)。</p><p>e) 增加循环次数。</p><p>f) 改变赝势。</p><h1 id="优化不收敛"><a href="#优化不收敛" class="headerlink" title="优化不收敛"></a>优化不收敛</h1><p>增加设Max.Interations的大小</p><p><code>interations</code>是定义积分精度的，相当于gaussian里的int选项；根据gauss的经验，对重原子如果不用细的积分网格，结果就不准确，特别是频率计算，可能会把正的频率算成负的频率。提高 interations的确可以提高精度，特别是对于过渡态和频率计算。</p><h1 id="总能和文献不一致，而且多种方法都不同"><a href="#总能和文献不一致，而且多种方法都不同" class="headerlink" title="总能和文献不一致，而且多种方法都不同"></a>总能和文献不一致，而且多种方法都不同</h1><p> 很正常，只要相对值近似就可以。</p><p>在倒空间进行电子结构计算的方法中,都存在一个能量零点的取法的问题,不同的程序,取的不同。根本原因是V(G)在G=0是发散的(可以去R.T. Martin的电子结构那本书)。</p><p>castep是利用周期性,在倒空间进行电子结构计算的.我没有记错的话,Dmol3是在实空间来进行电子结构计算的.能量零点的取法就跟不同前者了。</p><p>因此在进行电子结构计算中，不要比较任何绝对能量值的大小，这样是毫无意义的，即使是同一个程序中也是这样，更不用说是两个不同的程序。</p><p>能量的相对值才具有物理意义。</p><hr><p><a href="http://blog.sina.com.cn/s/blog_68e8ad8f01016oyg.html" target="_blank" rel="noopener">部分来自该文</a> 。</p><h1 id="CASTEP结果错报警信息"><a href="#CASTEP结果错报警信息" class="headerlink" title="CASTEP结果错报警信息"></a>CASTEP结果错报警信息</h1><p>是CASTEP结果中的出错报警信息，该信息的含义如下：</p><p><em>Warning</em> max. SCF cycles performed but system has not reached the groundstate.<br>已完成最大SCF循环，但体系仍未到达基态。<br>Current total energy, E     =  -3470.539604785     eV<br>Current free energy (E-TS)  =  -3470.795901720     eV<br>(energies not corrected for finite basis set)</p><p>NB est. 0K energy (E-0.5TS) =  -3470.667753253     eV<br>上述三者分别为完成最大SCF循环后（即当前）能量值。<br>*<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>***</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br> Warning: electronic minimisation did not converge when finding ground state.<br>在搜寻基态过程中电子最小化并未达到收敛，</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录几个 MS 的错误。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="DFT" scheme="http://rachpt.me/categories/DFT/"/>
    
    
      <category term="castep" scheme="http://rachpt.me/tags/castep/"/>
    
      <category term="ms" scheme="http://rachpt.me/tags/ms/"/>
    
  </entry>
  
  <entry>
    <title>Linux 中快速添加 hexo 文章</title>
    <link href="http://rachpt.me/2018/03/13/quick-add-a-essay-on-hexoSystem/"/>
    <id>http://rachpt.me/2018/03/13/quick-add-a-essay-on-hexoSystem/</id>
    <published>2018-03-13T10:41:51.000Z</published>
    <updated>2018-03-13T12:36:36.145Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在 hexo 添加新的文章的方式通常使用 new 命令新建一个 post ，然后编辑保存，或者直接使用编辑器新建保存，写了一个 shell 脚本实现便利地写文章。</p></blockquote><a id="more"></a><p>所用的系统为 Linux mint ，markdown 编辑器为 typora 。</p><p>由于在 <code>_post</code> 中直接新建 md 文件需要自己手动天际 yaml 文件头，title 、date 等。而 cd 到 hexo 根目录后，使用命令 <code>hexo new post &quot;title-of-essay&quot;</code> ，即可在 <code>_post</code> 中创建预定样式的 md 文件，但是步骤略微繁琐。</p><div class="note default"><p>通常的步骤：</p></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> blog <span class="comment">#我的 hexo 博客目录</span></span><br><span class="line">hexo new post title-for<span class="_">-a</span>-page</span><br><span class="line"></span><br><span class="line">typora ~blog/<span class="built_in">source</span>/_posts/title-for<span class="_">-a</span>-page.md &amp;</span><br></pre></td></tr></table></figure><p>需要按的键比较多。</p><p>想到使用 shell 脚本，然后使用  alias 设置别名，爽歪歪。</p><p>脚本如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="built_in">read</span> -t 600 -p <span class="string">"输入文章标题："</span> title</span><br><span class="line"><span class="built_in">cd</span> ~/blog </span><br><span class="line">dir=$(hexo new post <span class="variable">$title</span> | cut -d : -f 2)</span><br><span class="line">dir=<span class="variable">$&#123;dir#*/&#125;</span></span><br><span class="line"><span class="built_in">cd</span> ~ </span><br><span class="line">typora <span class="variable">$dir</span> &amp;</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>其中 600 是超时时间，单位秒，typora 为 md 格式编辑器。</p><p>编辑 <code>bashrc</code> 。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gedit .bashrc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在最后添加</span></span><br><span class="line"><span class="built_in">alias</span> ww=<span class="string">'sh /home/rachpt/document/ww.sh &amp;&amp; exit'</span></span><br><span class="line"><span class="comment"># 写上自己的路径，创建新的文件后自动关闭终端。ww 为自定义别名。</span></span><br></pre></td></tr></table></figure><div class="note success"><p>几点笔记：</p><ol><li>read 命令实现读取用后输入信息。</li><li>变量赋值后面直接使用“=”，前后不能空格。</li><li>使用前面的变量 使用$ + 变量名。</li><li>管道运算符<code>|</code> 将前面命令的输出输入下一个可以<strong>接受标准输入</strong>的命令。</li><li><code>cut</code> 实现分片。</li><li><code>#*/</code> 删除第一个<code>/</code> 以及其前面的部分。</li></ol></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在 hexo 添加新的文章的方式通常使用 new 命令新建一个 post ，然后编辑保存，或者直接使用编辑器新建保存，写了一个 shell 脚本实现便利地写文章。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
      <category term="hexo" scheme="http://rachpt.me/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>简单使用 FFmpeg 压制视频</title>
    <link href="http://rachpt.me/2018/03/12/a-simple-example-of-FFmpeg/"/>
    <id>http://rachpt.me/2018/03/12/a-simple-example-of-FFmpeg/</id>
    <published>2018-03-12T13:52:01.000Z</published>
    <updated>2018-03-20T10:02:25.795Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用 FFmpeg 2pass 简单改小视频分辨率，降低音视频码率，以用于移动设备观看。</p></blockquote><a id="more"></a><p>直接上命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i in.mp4 -s 854x480 -c:v libx264 -preset slow -b:v 500k -pass 1 -an -f mp4 -y /dev/null   <span class="comment">#windows 最后使用 NULL，linux 使用 /dev/null。抑制输出。</span></span><br><span class="line"><span class="comment"># -s 后面就是视频分辨率， b:v  b:a 后面是相应码率。</span></span><br><span class="line"><span class="comment"># &amp;&amp; \ 可以连接两句</span></span><br><span class="line">ffmpeg -i in.mp4 -s 854x480 -c:v libx264 -preset slow -b:v 500k -pass 2 -c:a aac -b:a 64k -strict -2 out.mp4</span><br><span class="line"><span class="comment"># strict -2 参数由ffmpeg版本决定，旧的要，否则报错。</span></span><br></pre></td></tr></table></figure><p>速度选项：</p><p>ultrafast<br>superfast<br>veryfast<br>faster<br>fast<br>medium – default preset<br>slow<br>slower<br>veryslow </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-an   : 不编码音频</span><br><span class="line">-vcodec : 设置视频的编码，我这里使用的是x264</span><br><span class="line">-b   : 这个是码率</span><br><span class="line">-f   : 强制使用格式</span><br><span class="line">-y   : 自动输y确认</span><br></pre></td></tr></table></figure><p>一条命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ffmpeg -i in.mkv -s 854x480 -c:v libx264 -preset slow -b:v 500k -pass 1 -an -f mp4 -y /dev/null &amp;&amp; \ffmpeg -i in.mkv -s 854x480 -c:v libx264 -preset slow -b:v 500k -pass 2 -c:a aac -b:a 64k -strict -2 out.mp4 &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>注意 <code>\</code> 后面不要空格，直接接 <code>ffmpeg</code> 命令。或者不要这个连接符 试试。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05gy1fpavl4w4ymj20zm0frdoz.jpg" alt="pic-1"></p><p> <a href="https://stackoverflow.com/questions/32931685/the-encoder-aac-is-experimental-but-experimental-codecs-are-not-enabled" target="_blank" rel="noopener">参考内容1</a> ， <a href="http://trac.ffmpeg.org/wiki/Encode/H.264" target="_blank" rel="noopener">参考内容2</a>  。</p><div class="note success"><p>使用脚本批量压制：</p></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"></span><br><span class="line">filelist=$(find *.mp4 *.mkv *.avi ! -name <span class="string">"*_480p.mp4"</span> -a)</span><br><span class="line">OLDIFS=<span class="string">"<span class="variable">$IFS</span>"</span></span><br><span class="line">IFS=$<span class="string">"\n"</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> *.mp4 *.mkv *.avi</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">nohup ffmpeg -i <span class="variable">$filename</span> -s 854x480 -c:v libx264 -preset fast -b:v 500k -pass 1 -an -f mp4 -y /dev/null &amp;&amp; \</span><br><span class="line">ffmpeg -i <span class="variable">$filename</span> -s 854x480 -c:v libx264 -preset fast -b:v 500k -pass 2 -c:a aac -b:a 64k -strict -2 <span class="string">"<span class="variable">$&#123;filename%.*&#125;</span>"</span>_480p.mp4 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">rm ffmpeg2pass*</span><br><span class="line"></span><br><span class="line">IFS=<span class="variable">$OLDIFS</span></span><br></pre></td></tr></table></figure><p><a href="http://lazybios.com/2013/07/flv-convert-to-mp3-shell-script/" target="_blank" rel="noopener">参考文档1</a> ， <a href="http://blog.csdn.net/weiyuefei/article/details/52704920" target="_blank" rel="noopener">参考文档2—nohup</a> ，<a href="http://linux.51yip.com/search/find" target="_blank" rel="noopener">参考文档—find</a> ，<a href="http://blog.csdn.net/reliveit/article/details/45271415" target="_blank" rel="noopener">参考文档—IFS</a> 。</p><p><code>find</code> 使用有无，具体修改如下。</p><div class="note success"><p>改进版，可以处理子目录下的所有 <code>mp4 mkv avi wmv</code>格式视频。</p></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">rm -f nohup.out</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d finish ];<span class="keyword">then</span></span><br><span class="line">  mkdir -p finish</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">filelist=$(find  \( -iname <span class="string">"*.mp4"</span> -o -iname <span class="string">"*.mkv"</span> -o -iname <span class="string">"*.avi"</span> -o -iname <span class="string">"*.wmv"</span> \) -a ! -name <span class="string">"*_480p.mp4"</span>)</span><br><span class="line">FOLDER=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">tempname=<span class="variable">$&#123;filename##*/&#125;</span></span><br><span class="line">newfilename=<span class="variable">$&#123;tempname%.*&#125;</span></span><br><span class="line">nohup ffmpeg -i <span class="variable">$FOLDER</span><span class="variable">$&#123;filename#*.&#125;</span> -s 854x480 -c:v libx264 -preset fast -b:v 500k -pass 1 -an -f mp4 -y /dev/null &amp;&amp; ffmpeg -i <span class="variable">$FOLDER</span><span class="variable">$&#123;filename#*.&#125;</span> -s 854x480 -c:v libx264 -preset fast -b:v 500k -pass 2 -c:a aac -b:a 64k -strict -2 finish/<span class="string">"<span class="variable">$&#123;newfilename&#125;</span>"</span>_480p.mp4 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rm -f ffmpeg2pass*</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h1 id="裁剪"><a href="#裁剪" class="headerlink" title="裁剪"></a>裁剪</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 00:00:00 -i in.mp4 -to 03:35:55 -vcodec copy -acodec copy -avoid_negative_ts 1 cutout.mp4</span><br></pre></td></tr></table></figure><p><code>-i</code> 需要在 <code>-to</code> 前面。</p><p><a href="http://blog.csdn.net/matrix_laboratory/article/details/53157383" target="_blank" rel="noopener">参考文章1</a>，<a href="http://trac.ffmpeg.org/wiki/Seeking" target="_blank" rel="noopener">参考2</a>。</p><p>附录：</p><p>mpv 几个快捷键</p><table><thead><tr><th style="text-align:center">键</th><th style="text-align:center">功能</th></tr></thead><tbody><tr><td style="text-align:center">&lt;</td><td style="text-align:center">逐帧 播放，上一帧</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">逐帧 播放，下一帧</td></tr><tr><td style="text-align:center">M</td><td style="text-align:center">静音</td></tr><tr><td style="text-align:center">shift  +  &lt;–</td><td style="text-align:center">退一秒</td></tr><tr><td style="text-align:center">shift  +  –&gt;</td><td style="text-align:center">进一秒</td></tr></tbody></table><p><a href="http://blog.csdn.net/REIONE/article/details/52610581" target="_blank" rel="noopener">参考内容</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用 FFmpeg 2pass 简单改小视频分辨率，降低音视频码率，以用于移动设备观看。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ffmpeg" scheme="http://rachpt.me/tags/ffmpeg/"/>
    
  </entry>
  
  <entry>
    <title>解决 mint 系统中 mendeley 无法使用 fcitx 输入中文</title>
    <link href="http://rachpt.me/2018/03/12/solve-the-problem-of-cannot-inputting-Chinese-in-mendeley/"/>
    <id>http://rachpt.me/2018/03/12/solve-the-problem-of-cannot-inputting-Chinese-in-mendeley/</id>
    <published>2018-03-12T02:46:14.000Z</published>
    <updated>2018-03-12T03:16:00.473Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>自从使用了 mendeley 软件后各种不顺，万恶之源就是在 mendeley 中无法使用 fcitx 输入中文。</p><p>一开始的解决办法是换用 ibus 输入法，万般无赖，离开了使用良久的 fcitx，转向 ibus。先是 ibus 的 sunpinyin 无法设置使用双拼，然后是升级 libpinyin ，最后是尝试升级 ibus 本身，最后以失败告终，白白浪费时间罢了。</p></blockquote><a id="more"></a><p>使用 ibus 最后连中文都无法输入，重启也无效。于是换回熟悉的 fcitx ，居然让我发现了解决 fcitx 与 mendeley 之间矛盾的方法。</p><p>最简单的解决办法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/lib/x86_64-linux-gnu/qt5/plugins/platforminputcontexts/libfcitxplatforminputcontextplugin.so    /opt/mendeleydesktop/plugins/qt/plugins/platforminputcontexts/</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux mint 18.3，基于 ubuntu 16.04</span></span><br></pre></td></tr></table></figure><p>参考 <a href="https://www.findhao.net/easycoding/2287#Ubuntu" target="_blank" rel="noopener">此文</a> （ubuntu），以及 <a href="https://www.zhihu.com/question/25517900" target="_blank" rel="noopener">知乎 链接</a> 。</p><p>拷贝  <code>libfcitxplatforminputcontextplugin.so</code> 到 mendeley 安装位置，debian和ubuntu的安装位置为：</p><p><code>/opt/mendeleydesktop/plugins/qt/plugins/platforminputcontexts/</code></p><p>重新启动mendeley即可发现中文可以输入了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">locate libfcitxplatforminputcontextplugin.so  </span><br><span class="line"><span class="comment">#找到系统中的libfcitxplatforminputcontextplugin.so</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制到 /opt/mendeleydesktop/plugins/qt/plugins/platforminputcontexts/ 目录下。</span></span><br></pre></td></tr></table></figure><div class="note success"><p>需要注意的是，在这之前，我使用新立得卸载了 ibus，不知怎么总是无法生效。</p><p>于是在<code>系统设置</code> –&gt; <code>输入法</code> 中 安装简体中文的语言支持，也就是同时装好 fcitx 和ibus 后，重启。</p><p>最后成功解决 fcitx 在 mengeley 中输入中文的问题。</p></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;自从使用了 mendeley 软件后各种不顺，万恶之源就是在 mendeley 中无法使用 fcitx 输入中文。&lt;/p&gt;
&lt;p&gt;一开始的解决办法是换用 ibus 输入法，万般无赖，离开了使用良久的 fcitx，转向 ibus。先是 ibus 的 sunpinyin 无法设置使用双拼，然后是升级 libpinyin ，最后是尝试升级 ibus 本身，最后以失败告终，白白浪费时间罢了。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="memdeley" scheme="http://rachpt.me/tags/memdeley/"/>
    
  </entry>
  
  <entry>
    <title>努比亚 Z11 mini 换电池</title>
    <link href="http://rachpt.me/2018/03/11/change-battery-for-nubiaZ11mini/"/>
    <id>http://rachpt.me/2018/03/11/change-battery-for-nubiaZ11mini/</id>
    <published>2018-03-11T15:00:00.000Z</published>
    <updated>2018-03-15T14:12:45.201Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>年前就想换电池了，听说小米7快发布了，于是没换等mi7。现在看来mi7要等上一段时间了。所已淘宝买个电池换换，再战个半年。</p></blockquote><a id="more"></a><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ol><li>淘宝买电池：</li></ol><p>随便找的 <a href="https://detail.tmall.com/item.htm?id=560780453117&amp;_u=blud0h0f3a1" target="_blank" rel="noopener">淘宝电池</a> ，41块大洋。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05gy1fp99vpnqm4j20o604xjs4.jpg" alt="pic1"></p><p>买来后东西挺多的，</p><p><img src="https://ww4.sinaimg.cn/large/675bda05ly1fp9axnshmyj20rs111wlm.jpg" alt="pic2"></p><ol><li>使用工具：</li></ol><p>只需要这三个工具 + 一个电吹风机。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05ly1fp9ay183i4j20rs111wlt.jpg" alt="pic3"></p><p>刀子用来翘壳和电池的，需要十字螺丝刀。</p><h1 id="拆后壳"><a href="#拆后壳" class="headerlink" title="拆后壳"></a>拆后壳</h1><p>由于只有一个手机，所以没拍图片，网上找的图片修的。</p><ol><li>使用吹风机加热后壳，变烫后直接用刀子在下面位置撬开小口。</li></ol><p><img src="https://ww3.sinaimg.cn/large/675bda05gy1fp9a475kezj20go0b4wf7.jpg" alt="pic5"></p><p>注意避开卡扣位置。</p><p><img src="https://ww1.sinaimg.cn/large/675bda05gy1fp9a7ftgjjj20df0b4q44.jpg" alt="pic7"></p><p><img src="https://ww1.sinaimg.cn/large/675bda05gy1fp9a6mjw00j20ar09vt9f.jpg" alt="pic6"></p><p>需要注意的是，有如下三个地方使用了胶，特别是指纹区域附近，用卡片从 <strong>右侧</strong> 顶开胶。</p><p><img src="https://ww1.sinaimg.cn/large/675bda05gy1fp9aaft1qoj20hs0dc40j.jpg" alt="pic8"></p><p>小心指纹排线。</p><p><img src="https://ww2.sinaimg.cn/large/675bda05gy1fp9aayqvvzj20hs0dc75u.jpg" alt="pic9"></p><h1 id="拆开上板"><a href="#拆开上板" class="headerlink" title="拆开上板"></a>拆开上板</h1><p>使用螺丝刀拆掉摄像头所在区域的金属盖板，注意 保存螺丝。</p><p><img src="https://ww1.sinaimg.cn/large/675bda05gy1fp9a7ftgjjj20df0b4q44.jpg" alt="pic7"></p><p>从摄像头红圈上面部分翘起 盖板。</p><h1 id="拆电池"><a href="#拆电池" class="headerlink" title="拆电池"></a>拆电池</h1><p>首先拆掉指纹排线 btb ，然后是电池的 btb。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05gy1fp9af3dzy6j20hs0dc40y.jpg" alt="pic10"></p><p>两块黄色区域就是固定电池的双面胶尾巴。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05gy1fp9aht5t1qj20x70np1kx.jpg" alt="pic11"></p><p>用刀子或者 塑料片拆解电池（图片来自 优酷）。用吹风机加热电池四周以方便将其取下。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05gy1fp9alnanplj20dc0dcq3z.jpg" alt="pic12"></p><p>如果使用刀子，注意电池后面的排线，别划到了。</p><p><strong>拆电池会使电池变形。</strong></p><h1 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h1><p>建议新电池先上排线 btb，开机测试，充电测试一下，没问题再关机装好还原。</p><p>最后，</p><p>附上拆下来的电池图。</p><p><img src="https://ww4.sinaimg.cn/large/675bda05ly1fp9aupqg2qj20rs111465.jpg" alt="pic-1"></p><p><img src="https://ww3.sinaimg.cn/large/675bda05ly1fp9av5shm8j20rs1117aa.jpg" alt="pic-2"></p><p>以及比较。</p><p><img src="https://ww3.sinaimg.cn/large/675bda05ly1fp9aw6w3x4j20k00zkq69.jpg" alt="pic-3"></p><p><img src="https://ww4.sinaimg.cn/large/675bda05ly1fp9awnvod9j20u01hcwj8.jpg" alt="piv-4"></p><p><img src="https://ww1.sinaimg.cn/large/675bda05ly1fp9awzto4ij20u01hc76e.jpg" alt="pic-5"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;年前就想换电池了，听说小米7快发布了，于是没换等mi7。现在看来mi7要等上一段时间了。所已淘宝买个电池换换，再战个半年。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="nubia" scheme="http://rachpt.me/tags/nubia/"/>
    
  </entry>
  
  <entry>
    <title>Linux 设置开机自动打开数字小键盘</title>
    <link href="http://rachpt.me/2018/03/11/linux-allow-numlock-on/"/>
    <id>http://rachpt.me/2018/03/11/linux-allow-numlock-on/</id>
    <published>2018-03-11T12:19:08.000Z</published>
    <updated>2018-03-11T12:40:17.136Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Linux mint 设置开机自动打开数字键盘锁 numlock。</p></blockquote><a id="more"></a><p>因为开机密码是用的数字，每次开机或者重起系统后输入密码前总是需要手动打开Numlock开关，很麻烦，还没有指示器。于是想到让其开机自动打开省事。</p><h1 id="linux-mint-设置"><a href="#linux-mint-设置" class="headerlink" title="linux mint 设置"></a>linux mint 设置</h1><p>对于linux mint ，在<code>系统设置</code>  –&gt; <code>登录窗口</code> –&gt; <code>设置</code> 中，有激活 numlock 开关，但是是不可用状态。</p><p>原因是需要安装一个软件： numlockx</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install numlockx <span class="comment">#安装好后，可能需要重起系统</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fp95h52f3zj20hu0fbmxt.jpg" alt="pic"></p><p>设置好后，重起即可看到效果。</p><p>或则编辑 lightdm 的配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/lightdm/lightdm.conf</span><br></pre></td></tr></table></figure><p>添加新行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Seat:*]</span><br><span class="line">allow-guest=<span class="literal">false</span> <span class="comment">#不允许访客登录系统</span></span><br><span class="line">greeter-show-manual-login=<span class="literal">false</span> <span class="comment">#可以自己输入登录用户名</span></span><br><span class="line">greeter-hide-users=<span class="literal">true</span> <span class="comment">#隐藏用户列表</span></span><br><span class="line"></span><br><span class="line">greeter-setup-script=/usr/bin/numlockx on <span class="comment">#这一行自己加的，其他是系统设置时自动加的</span></span><br></pre></td></tr></table></figure><p>这样等同于在设置中激活numlock 。</p><p><a href="http://blog.csdn.net/ldl22847/article/details/8552894" target="_blank" rel="noopener">参考博文</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Linux mint 设置开机自动打开数字键盘锁 numlock。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="numlock" scheme="http://rachpt.me/tags/numlock/"/>
    
  </entry>
  
  <entry>
    <title>几个关于 iBus 输入法的记录</title>
    <link href="http://rachpt.me/2018/03/10/notes-for-solve-ibus-error/"/>
    <id>http://rachpt.me/2018/03/10/notes-for-solve-ibus-error/</id>
    <published>2018-03-10T08:35:27.000Z</published>
    <updated>2018-03-10T16:27:36.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Mendely 的标注功能只支持 iBus 的中文输入，被迫从 Fcitx 改成 iBus。遇到一些问题，这里记录备忘。</p></blockquote><a id="more"></a><h1 id="Sunpinyin-无法打开首选项"><a href="#Sunpinyin-无法打开首选项" class="headerlink" title="Sunpinyin 无法打开首选项"></a>Sunpinyin 无法打开首选项</h1><p>Linux mint 切换输入法还是很简单的，Fictx 和 iBus 一键安装。<code>系统设置</code> –&gt; <code>语言</code> –&gt; <code>输入法</code> –&gt; <code>简体中文</code> 点击安装即可。切换需要重启系统。</p><p>在终端中输入 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus-setup <span class="comment">#设置 iBus</span></span><br></pre></td></tr></table></figure><p>点击 Sunpinyin 首选项，报错如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/share//ibus-sunpinyin/setup/main.py"</span>, line 42, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import ibus</span><br><span class="line">ImportError: No module named ibus</span><br></pre></td></tr></table></figure><p>提示没有 ibus 模块，网上搜到的解决办法如下：</p><p>从 <a href="https://ubuntu.pkgs.org/14.04/ubuntu-main-amd64/python-ibus_1.5.5-1ubuntu3_all.deb.html" target="_blank" rel="noopener">https://ubuntu.pkgs.org/14.04/ubuntu-main-amd64/python-ibus_1.5.5-1ubuntu3_all.deb.html</a> 下载deb安装即可。或则从 <a href="https://pan.lanzou.com/i0mhsqd" target="_blank" rel="noopener">这里</a> 下载。</p><div class="note default"><p>原地址:  <a href="http://forum.ubuntu.org.cn/viewtopic.php?f=86&amp;t=468324&amp;start=15" target="_blank" rel="noopener">ibus-setup-sunpinyin 无法打开设置</a> </p></div><h1 id="使用ibus-libpinyin"><a href="#使用ibus-libpinyin" class="headerlink" title="使用ibus-libpinyin"></a>使用ibus-libpinyin</h1><p>相比 ibus-pinyin ，ibus-libpinyin 更新一些。可能会更好。源码地址：</p><p><a href="https://github.com/libpinyin/ibus-libpinyin" target="_blank" rel="noopener">https://github.com/libpinyin/ibus-libpinyin</a> </p><p>安装很是费劲，最后更新到 <code>IBus 智能拼音 1.9.3</code> 后居然直接不能用来，使用 apt 安装的是1.7.3 （mint 18.3）。</p><p>安装参考 <a href="http://blog.csdn.net/u010053050/article/details/50246813" target="_blank" rel="noopener">在debian stretch上编译安装ibus-libpinyin(V1.7.3)过程记录</a> 。</p><div class="note success"><p>核心思想：</p><p>提示缺少啥依赖，就安装啥。</p><p>如 <code>name</code> 的依赖缺少，就找 <code>libname-dev</code> 的包。</p></div><p>其中 <code>libdb4.8-dev</code> 的部分 直接使用 <code>sudo apt install libdb5.3-dev</code>   解决的（mint 18.3）。</p><p>关于<strong>libpinyin</strong>， 在 <a href="https://github.com/libpinyin/libpinyin" target="_blank" rel="noopener">github</a> 上下源码编译 make 老是报错，最后直接 <a href="https://sourceforge.net/projects/libpinyin/files/" target="_blank" rel="noopener">在此</a> 下载现成的解决的。</p><p>libpinyin 使用<code>./autogen.sh --prefix=/usr</code> 加上路径安装。默认在 <code>/usr/local</code> 目录下，自带 share 。装错 直接 rm 删掉即可。</p><hr><p>好气，转好后居然不能用。</p><h1 id="软件能用坚决不要强行更新"><a href="#软件能用坚决不要强行更新" class="headerlink" title="软件能用坚决不要强行更新"></a>软件能用坚决不要强行更新</h1><p>ibus 有个下bug，不能一直显示输入法状态，于是想到更新软件版本解决，从源码编译，麻蛋，一个又一个的依赖缺失，最后make还是失败了。从deb安装，直接提示部分核心组件需要升级，😂，而核心组件的升级除非我升级底层系统。所以最后只好换回原来版本。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Mendely 的标注功能只支持 iBus 的中文输入，被迫从 Fcitx 改成 iBus。遇到一些问题，这里记录备忘。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ibus" scheme="http://rachpt.me/tags/ibus/"/>
    
  </entry>
  
  <entry>
    <title>next 主题设置</title>
    <link href="http://rachpt.me/2018/03/05/settings-for-next-theme/"/>
    <id>http://rachpt.me/2018/03/05/settings-for-next-theme/</id>
    <published>2018-03-05T11:37:08.000Z</published>
    <updated>2018-03-12T10:12:34.311Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录几个修改，方便以后升级主题后更新。</p></blockquote><p>目前 next 版本：<code>6.0.5</code> 。</p><a id="more"></a><h1 id="文章加密"><a href="#文章加密" class="headerlink" title="文章加密"></a>文章加密</h1><p>打开<code>themes-&gt;next-&gt;layout-&gt;_custom-&gt;head.swig</code>文件(默认路径)插入 JS 脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'&#123;&#123; page.password &#125;&#125;'</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (prompt(<span class="string">'请输入文章密码'</span>) !== <span class="string">'&#123;&#123; page.password &#125;&#125;'</span>)&#123;</span><br><span class="line">                alert(<span class="string">'密码错误！返回上页'</span>);</span><br><span class="line">                history.back();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05gy1fp26pa99bnj20fy062wex.jpg" alt=""></p><p>使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: </span><br><span class="line">date: 2018-03-05 19:37:08</span><br><span class="line">tags:</span><br><span class="line">categories:</span><br><span class="line">top: #顶置</span><br><span class="line">password: #密码</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p><p>没什么卵用，查看源码一切都暴露了。</p><h1 id="添加-DaoVoice"><a href="#添加-DaoVoice" class="headerlink" title="添加 DaoVoice"></a>添加 DaoVoice</h1><p>打开<code>themes-&gt;next-&gt;layout-&gt;_custom-&gt;head.swig</code>文件(默认路径)插入JS：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.daovoice %&#125;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">  (function(i,s,o,g,r,a,m)&#123;i[&quot;DaoVoiceObject&quot;]=r;i[r]=i[r]||function()&#123;(i[r].q=i[r].q||[]).push(arguments)&#125;,i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset=&quot;utf-8&quot;;m.parentNode.insertBefore(a,m)&#125;)(window,document,&quot;script&quot;,(&apos;https:&apos; == document.location.protocol ? &apos;https:&apos; : &apos;http:&apos;) + &quot;//widget.daovoice.io/widget/0f81ff2f.js&quot;,&quot;daovoice&quot;)</span><br><span class="line">  daovoice(&apos;init&apos;, &#123;</span><br><span class="line">      app_id: &quot;&#123;&#123;theme.daovoice_app_id&#125;&#125;&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">  daovoice(&apos;update&apos;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>首先在 <a href="https://account.daocloud.io/signin" target="_blank" rel="noopener">daovoice</a> 注册账号，<a href="http://dashboard.daovoice.io/get-started?invite_code=0f81ff2f" target="_blank" rel="noopener">邀请码</a>是<code>0f81ff2f</code>,注册完成后会得到一个 app_id ：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Online contact </span><br><span class="line">daovoice: true</span><br><span class="line">daovoice_app_id: &quot;刚才获得的 app_id&quot;</span><br></pre></td></tr></table></figure><h1 id="自定义css"><a href="#自定义css" class="headerlink" title="自定义css"></a>自定义css</h1><p>打开<code>themes/next/source/css/_custom/custom.styl</code> ：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">// Custom styles.</span><br><span class="line">// 主页文章添加阴影效果 （不利于移动端）</span><br><span class="line"><span class="comment">/* .post &#123;</span></span><br><span class="line"><span class="comment">   margin-top: 60px;</span></span><br><span class="line"><span class="comment">   margin-bottom: 60px;</span></span><br><span class="line"><span class="comment">   padding: 15px;</span></span><br><span class="line"><span class="comment">   -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);</span></span><br><span class="line"><span class="comment">   -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">// 鼠标样式</span><br><span class="line">  * &#123;</span><br><span class="line">      <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">"/images/sword2.ico"</span>),auto<span class="meta">!important</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">      <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">"/images/sword1.ico"</span>),auto<span class="meta">!important</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">// DaoVoice 图标透明</span><br><span class="line">  <span class="selector-class">.daodream-launcher-button</span>, <span class="selector-class">.daodream-launcher-maximized</span>, <span class="selector-class">.daodream-launcher-with-initials</span> &#123;</span><br><span class="line">      <span class="attribute">opacity</span>:<span class="number">0.3</span>;</span><br><span class="line">      <span class="attribute">-moz-opacity</span>:<span class="number">0.3</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.3</span>;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#daodream-launcher</span> &#123;</span><br><span class="line">      <span class="attribute">opacity</span>:<span class="number">0.1</span>;</span><br><span class="line">      <span class="attribute">-moz-opacity</span>:<span class="number">0.1</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.daodream-launcher-preview</span> &#123;</span><br><span class="line">      <span class="attribute">opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">-moz-opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-id">#daodream-launcher</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">-moz-opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.daodream-launcher-button</span><span class="selector-pseudo">:hover</span>, <span class="selector-class">.daodream-launcher-maximized</span><span class="selector-pseudo">:hover</span>, <span class="selector-class">.daodream-launcher-with-initials</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">-moz-opacity</span>:<span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.9</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">// Valine 和 algolia 和 DaoDream 去除 Powered By </span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.info</span>, <span class="selector-tag">span</span><span class="selector-class">.algolia-powered</span>, <span class="selector-tag">div</span><span class="selector-class">.daodream-powered-by</span> &#123;</span><br><span class="line">     <span class="attribute">visibility</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.txt-right</span>&#123;</span><br><span class="line">     <span class="attribute">visibility</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h1><h2 id="字数-amp-阅读时间"><a href="#字数-amp-阅读时间" class="headerlink" title="字数&amp;阅读时间"></a>字数&amp;阅读时间</h2><p>至hexo根目录，安装 <code>hexo-symbols-count-time</code> ：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-symbols-count-time --save</span><br></pre></td></tr></table></figure><p>至 hexo 的 <code>_config.yml</code> 添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">symbols_count_time:</span><br><span class="line">  symbols: true</span><br><span class="line">  time: true</span><br><span class="line">  total_symbols: true</span><br><span class="line">  total_time: true</span><br></pre></td></tr></table></figure><p>至 next 主题 的  <code>_config.yml</code> 修改：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">symbols_count_time:</span><br><span class="line">  separated_meta: &lt;span style=&quot;color: red&quot;&gt;true&lt;/span&gt;</span><br><span class="line">  item_text_post: true</span><br><span class="line">  item_text_total: false</span><br><span class="line">  awl: 5</span><br><span class="line">  wpm: 200</span><br></pre></td></tr></table></figure><p> <code>hexo-reading-time</code> 和 <code>hexo-worcount</code> 已经弃用。</p><h2 id="站点访问量"><a href="#站点访问量" class="headerlink" title="站点访问量"></a>站点访问量</h2><p>直接配置 next 主题：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">busuanzi_count:</span><br><span class="line">  enable: &lt;span style=&quot;color: red&quot;&gt;true&lt;?span&gt;</span><br><span class="line">  total_visitors: true</span><br><span class="line">  total_visitors_icon: user</span><br><span class="line">  total_views: true</span><br><span class="line">  total_views_icon: eye</span><br><span class="line">  post_views: true</span><br><span class="line">  post_views_icon: eye</span><br></pre></td></tr></table></figure><p>或者自己改文件：</p><p>在 <code>/home/rachpt/blog/themes/next/layout/_partials/footer.swig</code> 最后添加代码：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span>&gt;</span><br><span class="line">  &lt;i class="fa fa-user-md"&gt;&lt;/i&gt; </span><br><span class="line">  本站总访问量：&lt;span id="busuanzi_value_site_pv"&gt;&lt;/span&gt; &amp;nbsp;| &amp;nbsp;</span><br><span class="line">  &lt;i class="fa fa-eye"&gt;&lt;/i&gt; </span><br><span class="line">  本站访客数：&lt;span id="busuanzi_value_site_uv"&gt;&lt;/span&gt; </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="头像旋转"><a href="#头像旋转" class="headerlink" title="头像旋转"></a>头像旋转</h1><p>在<code>\themes\next\source\css\_common\components\sidebar\sidebar-author.styl</code>，里面添加如下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/* 鼠标经过头像旋转360度 */</span></span><br><span class="line">  <span class="selector-tag">-webkit-transition</span>: <span class="selector-tag">-webkit-transform</span> 1<span class="selector-class">.0s</span> <span class="selector-tag">ease-out</span>;</span><br><span class="line">  <span class="selector-tag">-moz-transition</span>: <span class="selector-tag">-moz-transform</span> 1<span class="selector-class">.0s</span> <span class="selector-tag">ease-out</span>;</span><br><span class="line">  <span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 1<span class="selector-class">.0s</span> <span class="selector-tag">ease-out</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标经过头像旋转360度 */</span></span><br><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotateZ</span>(360deg);</span><br><span class="line">  <span class="attribute">-moz-transform</span>: <span class="built_in">rotateZ</span>(360deg);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(360deg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Z 轴旋转动画 */</span></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> play &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotateZ</span>(0deg);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotateZ</span>(-360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@-<span class="keyword">moz</span>-<span class="keyword">keyframes</span> play &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">-moz-transform</span>: <span class="built_in">rotateZ</span>(0deg);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">-moz-transform</span>: <span class="built_in">rotateZ</span>(-360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">keyframes</span> play &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(0deg);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(-360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fp29t6t0eej20k40jpmzq.jpg" alt=""></p><h1 id="添加-“本文结束”"><a href="#添加-“本文结束”" class="headerlink" title="添加 “本文结束”"></a>添加 “本文结束”</h1><p>创建。在路径 <code>\themes\next\layout\_macro</code> 中新建 <code>post-end-tag.swig</code> 文件,并添加以下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% if not is_index %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center;color: #ccc;font-size:14px;"</span>&gt;</span>&#123;#</span><br><span class="line">          #&#125;&#123;&#123; __(theme.post_end_tag.contents) &#125;&#125;&#123;#</span><br><span class="line">        #&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改。接着打开<code>\themes\next\layout\_macro\post.swig</code>文件，在<code>post-body</code> 之后， <code>post-footer</code> 之前添加如下画红色部分代码</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fp28fd6w34j20g80bywg2.jpg" alt=""></p><p>参数。<code>主题配置文件</code>（<code>theme/next/_config.yml</code>)末尾添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post_end_tag:</span><br><span class="line">  enabled: true</span><br><span class="line">  contents: ---------本文结束&lt;i class=&quot;fa fa-paw&quot;&gt;&lt;/i&gt;感谢阅读---------</span><br></pre></td></tr></table></figure><p>内容可以自定义。本人参考 <a href="https://segmentfault.com/a/1190000009544924#articleHeader6" target="_blank" rel="noopener">hexo的next主题个性化配置教程</a> 修改。</p><h1 id="顶置"><a href="#顶置" class="headerlink" title="顶置"></a>顶置</h1><p>修改 <code>hero-generator-index</code> 插件，把文件：<code>node_modules/hexo-generator-index/lib/generator.js</code> 内的代码替换为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">var</span> pagination = <span class="built_in">require</span>(<span class="string">'hexo-pagination'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = <span class="keyword">this</span>.config;</span><br><span class="line">  <span class="keyword">var</span> posts = locals.posts;</span><br><span class="line">    posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a.top &amp;&amp; b.top) &#123; <span class="comment">// 两篇文章top都有定义</span></span><br><span class="line">            <span class="keyword">if</span>(a.top == b.top) <span class="keyword">return</span> b.date - a.date; <span class="comment">// 若top值一样则按照文章日期降序排</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> b.top - a.top; <span class="comment">// 否则按照top值降序排</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a.top &amp;&amp; !b.top) &#123; <span class="comment">// 以下是只有一篇文章top有定义，那么将有top的排在前面（这里用异或操作居然不行233）</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!a.top &amp;&amp; b.top) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> b.date - a.date; <span class="comment">// 都没定义按照文章日期降序排</span></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="keyword">var</span> paginationDir = config.pagination_dir || <span class="string">'page'</span>;</span><br><span class="line">  <span class="keyword">return</span> pagination(<span class="string">''</span>, posts, &#123;</span><br><span class="line">    perPage: config.index_generator.per_page,</span><br><span class="line">    layout: [<span class="string">'index'</span>, <span class="string">'archive'</span>],</span><br><span class="line">    format: paginationDir + <span class="string">'/%d/'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      __index: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用：（数值越大文章越靠前）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: </span><br><span class="line">date: 2018-03-05 19:37:08</span><br><span class="line">tags:</span><br><span class="line">categories:</span><br><span class="line">top: #顶置</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h1 id="添加侧边栏音乐播单"><a href="#添加侧边栏音乐播单" class="headerlink" title="添加侧边栏音乐播单"></a>添加侧边栏音乐播单</h1><ol><li><p>下载所需文件：</p><p>​    <a href="https://pan.lanzou.com/i0mylqd" target="_blank" rel="noopener">长显+连续播放+右键音量控制</a> OR</p><p>​    <a href="https://pan.lanzou.com/i0mylre" target="_blank" rel="noopener">长隐+连续播放</a> </p><p>​        备用下载<a href="http://pan.baidu.com/s/1slyR4yp" target="_blank" rel="noopener">播放器</a> 密码：oznd</p></li><li><p>设置 hexo 配置文件 <code>_config.yml</code> :</p></li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> </span><br><span class="line"><span class="bullet">    -</span> <span class="number">404.</span><span class="string">html</span>  <span class="comment">#跳过404页面</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">static/**</span> <span class="comment">#跳过static目录下的所有内容，注意是两个*号。</span></span><br></pre></td></tr></table></figure><p>先复制 下载文件中的 四个文件夹至 <code>source/static</code> 。然后将 <code>_my</code> 文件夹移动到 <code>/themes/next/layout</code> 。</p><ol><li>使所有页面都能播放，在 <code>/themes/next/layout/_layout.swig</code> 的 <code>&lt;/body&gt;</code> 前添加</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &apos;_my/audio.swig&apos; %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05gy1fpa6b0p565j20dp04674f.jpg" alt="pic-1"></p><ol><li>至<code>/themes/next/_config.yml</code> 主题配置文件末尾添加：</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># music</span></span><br><span class="line"><span class="attr">audio:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  sources:</span> <span class="string">[</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="attr">title:</span> <span class="string">'....'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    artist:</span> <span class="string">'....'</span><span class="string">,</span> </span><br><span class="line"><span class="attr">    mp3:</span> <span class="string">'......mp3'</span><span class="string">,</span> </span><br><span class="line"><span class="attr">    cover:</span> <span class="string">'.....jpg'</span> <span class="string">&#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&#123;</span> <span class="attr">title:</span> <span class="string">'.....'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    artist:</span> <span class="string">'......'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    mp3:</span> <span class="string">'.......mp3'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    cover:</span> <span class="string">'.....jpg'</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="string">]</span></span><br></pre></td></tr></table></figure><p>其他：</p><p>注释掉 <code>source/static/js/player.js</code>的<code>$(&quot;div.ssBtn&quot;).click()</code> ，播放器就不会一直弹出。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpa6te342gj20hr06mab1.jpg" alt="pic-2"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">source/<span class="keyword">static</span>/js/player.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> setProgress = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentSec = <span class="built_in">parseInt</span>(value % <span class="number">60</span>) &lt; <span class="number">10</span> ? <span class="string">'0'</span> + <span class="built_in">parseInt</span>(value % <span class="number">60</span>) : <span class="built_in">parseInt</span>(value % <span class="number">60</span>),</span><br><span class="line">        ratio = value / audio.duration * <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">'.timer'</span>).html(<span class="built_in">parseInt</span>(value / <span class="number">60</span>) + <span class="string">':'</span> + currentSec);</span><br><span class="line">+   localStorage.time = value <span class="comment">//储音乐的播放状态</span></span><br><span class="line">+   localStorage.song = currentTrack <span class="comment">//储音乐的播放状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>sessionStorage.autoPlay = &quot;true&quot;</code> 控制自动播放。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FirstLoad = <span class="function"><span class="keyword">function</span> (<span class="params">i, time</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        currentTrack = <span class="number">0</span></span><br><span class="line">        shuffleIndex = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    loadMusic(i)</span><br><span class="line">    <span class="keyword">if</span> (time) &#123;</span><br><span class="line">        audio.currentTime = time</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (localStorage.volume) &#123;</span><br><span class="line">        audio.volume = localStorage.volume</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sessionStorage.autoPlay == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        sessionStorage.autoPlay = <span class="string">"true"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置 <a href="http://saili.science/2017/04/02/github-for-win/#h5palyer" target="_blank" rel="noopener">参考</a> 。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录几个修改，方便以后升级主题后更新。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;目前 next 版本：&lt;code&gt;6.0.5&lt;/code&gt; 。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
