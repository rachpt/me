<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rachpt&#39;s Blog</title>
  
  <subtitle>时间总是追不上</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://rachpt.github.io/"/>
  <updated>2019-11-09T15:35:37.124Z</updated>
  <id>https://rachpt.github.io/</id>
  
  <author>
    <name>rachpt</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>solve-composting-broken</title>
    <link href="https://rachpt.github.io/2019/11/09/solve-composting-broken/"/>
    <id>https://rachpt.github.io/2019/11/09/solve-composting-broken/</id>
    <published>2019-11-09T15:12:11.000Z</published>
    <updated>2019-11-09T15:35:37.124Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>某次重启manjaro KDE后桌面透明效果丢失(无法透明)，刚开始以为是显卡驱动问题，最后发现是 混成器(composting)的问题。</p></blockquote><a id="more"></a><h1 id="问题表现"><a href="#问题表现" class="headerlink" title="问题表现"></a>问题表现</h1><p>以前正常的透明特效丢失，设置里面的 显示与监控 混成器 无法打开。</p><p>尝试更新显卡驱动无法解决该问题。</p><h1 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h1><p>必须要英语搜索啊。使用关键词 <code>KDE composting not work</code> 就找到解决办法。</p><p>解决办法<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 ~/.config/kwinrc 的 OpenGLIsUnsafe 值为 false</span></span><br><span class="line">grep <span class="string">"OpenGLIsUnsafe"</span> ~/.config/kwinrc</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'/OpenGLIsUnsafe/&#123;s/true/false/&#125;'</span> ~/.config/kwinrc</span><br></pre></td></tr></table></figure></p><p>参考 <a href="https://bbs.archlinux.org/viewtopic.php?pid=1721227#p1721227" target="_blank" rel="noopener">文档一</a>，<a href="https://bbs.archlinux.org/viewtopic.php?pid=1723539#p1723539" target="_blank" rel="noopener">文档二</a> 。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>XRender 透明开关快捷键 <code>Alt+Shift+F12</code>.</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;某次重启manjaro KDE后桌面透明效果丢失(无法透明)，刚开始以为是显卡驱动问题，最后发现是 混成器(composting)的问题。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="kde" scheme="https://rachpt.github.io/tags/kde/"/>
    
  </entry>
  
  <entry>
    <title>git-notes</title>
    <link href="https://rachpt.github.io/2019/11/04/git-notes/"/>
    <id>https://rachpt.github.io/2019/11/04/git-notes/</id>
    <published>2019-11-04T07:40:20.000Z</published>
    <updated>2019-11-04T07:56:47.047Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一些不是很常用的 git 使用操作笔记。</p></blockquote><a id="more"></a><h1 id="删除-github-上的一个分支"><a href="#删除-github-上的一个分支" class="headerlink" title="删除 github 上的一个分支"></a>删除 github 上的一个分支</h1><p>本地新建一个文件，初始化一个 git 空间，push 这个空目录至远程仓库的对应分支，就可以删掉该分支。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir new_folder</span><br><span class="line"><span class="built_in">cd</span> new_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@github.com:USER/reop.git</span><br><span class="line">git push -u origin the_branch_to_delete</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">rm -r new_folder</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;一些不是很常用的 git 使用操作笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>eclipse-notes</title>
    <link href="https://rachpt.github.io/2019/10/05/eclipse-notes/"/>
    <id>https://rachpt.github.io/2019/10/05/eclipse-notes/</id>
    <published>2019-10-05T13:46:37.000Z</published>
    <updated>2019-10-17T02:48:06.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>eclipse 使用笔记。</p></blockquote><a id="more"></a><h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><p><a href="https://www.iqiyi.com/v_19rrdgzjfc.html" target="_blank" rel="noopener">参考教学视频1</a>。</p><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>安装 CDT 以支持 C/C++：<br>  <code>Help --&gt; Eclipse Marketplace</code>，搜索 CDT，<code>Eclipse C/C++ IDE CDT x.x(xxxx-xx)</code> Install 即可。</p><h2 id="卸载模块"><a href="#卸载模块" class="headerlink" title="卸载模块"></a>卸载模块</h2><p>  普通可以在 marketplace 里面的 Installed 里面卸载。<br>  中文语言包卸载方法：<code>Help --&gt; About Eclipse IDE --&gt; Installation Details</code>，选中相关的插件 Uninstall 即可。</p><h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><ul><li><code>Alt + /</code> 智能补全，</li><li><code>Ctrl + /</code> 行 注释与取消注释，</li><li><code>Ctrl + Shift + /</code> 块注释选中内容，</li><li><code>Ctrl + Shift + \</code> 取消块注释选中内容，</li><li><code>Ctrl + Shift + F</code> 自动整理代码，</li><li><code>Ctrl + Shift + O</code> 自动导入包，</li><li><code>Alt + 上</code> 当前行上移，</li><li><code>Alt + 下</code> 当前行下移，</li><li><code>Ctrl + Alt + 上</code> 当前行向上复制一行，</li><li><code>Ctrl + Alt + 下</code> 当前行向下复制一行，</li><li><code>Ctrl + D</code> 删除当前行，</li><li><code>Shift + Enter</code> 光标行下面新建一行，并将光标移到那一行，</li><li><code>Ctrl + M</code> 编辑区最大化显示，</li><li><code>Ctrl + Shift + L</code> 显示快捷键列表。</li></ul><p><a href="https://www.iqiyi.com/v_19rrdgznbk.html" target="_blank" rel="noopener">参考教学视频2</a>。</p><p>缩放编辑区字体：</p><p>Ctrl + 鼠标滚轮无效，使用通用的 <code>Ctrl + -</code> 缩小，<code>Ctrl + +(shift + =)</code> 放大。</p><h1 id="Go-语言"><a href="#Go-语言" class="headerlink" title="Go 语言"></a>Go 语言</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><p>打开 <code>preference --&gt; Go</code>，配合 <code>whereis go</code> 填写对应路径即可。</p><p>包括 <code>Go installation Directory</code>，以及 <code>Tools</code>。<a href="https://www.cnblogs.com/xzlq/p/9947982.html" target="_blank" rel="noopener">参考文档1</a>。</p><p>其中 gocode、godef、guru 是一些自动工具，比如自动不全、拼写检查等。安装需要使用 go 自行编译。其中需要注意 <code>golang.org</code> 为 google 的网站，需要使用 github 找到相应进行 repo 编译安装，网上有较多教程，折腾几下就可以编译成功。archlinux 系可以使用 AUR 安装 <code>yay -S gocode-git</code>，旧版本会有不兼容现象。</p><p>编译 godef、guru<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译godef，以普通用户在家目录运行</span></span><br><span class="line">go get -u -v github.com/rogpeppe/godef</span><br><span class="line"><span class="comment"># 等待完成后，二进制文件构建在 ~/go/bin/godef</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译 guru 比较麻烦，因为 golang.org 被墙，需要自己造特殊文件夹</span></span><br><span class="line"></span><br><span class="line">mkdir -p ~/go/src/golang.org/x/</span><br><span class="line"><span class="built_in">cd</span>  ~/go/src/golang.org/x/</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/tools.git &amp;</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/net.git &amp;</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/sync.git &amp;</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/xerrors.git &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 GOPATH</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="string">'~/go'</span></span><br><span class="line"><span class="comment"># 等待所有下载完成后，使用按包编译命令</span></span><br><span class="line"><span class="built_in">cd</span> ~/go/src <span class="comment"># 该条貌似不必要</span></span><br><span class="line"><span class="comment"># 包名是相对 GOPATH 的 src 目录的</span></span><br><span class="line">go build golang.org/x/tools/cmd/guru/</span><br><span class="line"><span class="comment"># 二进制文件 就在当前目录下。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动到系统目录</span></span><br><span class="line"><span class="comment"># 使用 sudo cp 可以自动修改相应属性</span></span><br><span class="line"></span><br><span class="line">sudo cp guru ../bin/godef /usr/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后可以清理不需要的 源代码文件</span></span><br></pre></td></tr></table></figure></p><p>上面的方法好像比较傻，更简洁的做法是配置 <code>GOPROXY</code>，然后使用 <code>go get</code> 命令安装。</p><p>可以使用 <code>go env GOROOT</code> 获得 go 的安装路径。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 GO 环境变量</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># GO Settings</span></span><br><span class="line"><span class="built_in">export</span> GOROOT=/usr/lib/go</span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="string">"<span class="variable">$HOME</span>/go"</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="built_in">export</span> GO111MODULE=on</span><br><span class="line"><span class="comment">#export GOPROXY=https://goproxy.io</span></span><br><span class="line"><span class="built_in">export</span> GOPROXY=https://goproxy.cn</span><br><span class="line"><span class="comment">#export GOPROXY=https://mirrors.aliyun.com/goproxy/</span></span><br></pre></td></tr></table></figure><p>配置好后 source 一下 .bashrc 以生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go get -u -v github.com/nsf/gocode</span><br><span class="line">go get -u -v github.com/rogpeppe/godef</span><br><span class="line">go get -u -v golang.org/x/tools/cmd/guru <span class="comment"># 不能用阿里云代理</span></span><br></pre></td></tr></table></figure><p>以后直接使用上面三条命令就能升级 <code>gocode</code> <code>godef</code> <code>guru</code>。</p><h2 id="安装-Goclipse-插件支持-go-语言，可能会因为-运行-eclipse-的-JVM-不是版本8而报错："><a href="#安装-Goclipse-插件支持-go-语言，可能会因为-运行-eclipse-的-JVM-不是版本8而报错：" class="headerlink" title="安装 Goclipse 插件支持 go 语言，可能会因为 运行 eclipse 的 JVM 不是版本8而报错："></a>安装 Goclipse 插件支持 go 语言，可能会因为 运行 eclipse 的 JVM 不是版本8而报错：</h2><p><code>&quot;could not start goclipse because java version is 0，requare java 8&quot;</code>。<br>解决办法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">whereis eclipse  <span class="comment"># 找到安装路径(使用直接解压版请忽略)</span></span><br><span class="line"><span class="comment"># /usr/lib/eclipse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应该有文件 /usr/lib/eclipse/eclipse.ini</span></span><br><span class="line"></span><br><span class="line">sudo vim /usr/lib/eclipse/eclipse.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 -vmargs 上面一行修改 或者添加如下两行</span></span><br><span class="line"></span><br><span class="line">-vm</span><br><span class="line">/usr/lib/jvm/java-8-openjdk/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要自行验证 java8 路径，也可能是 java-8-jdk。</span></span><br></pre></td></tr></table></figure></p><p>每次更新升级 eclipse 后都需要改一下(除非只安装了jdk8)，<a href="https://www.cnblogs.com/kumata/p/10064386.html" target="_blank" rel="noopener">参考文档2</a>。</p><h1 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h1><p>第一次运行、以及切换项目、源文件时都需要设置 <code>Run configurations</code>。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/eclipse-notes-2019-10-7-15-0-29.png" alt="eclipse-notes-2019-10-7-15-0-29.png"></p><p>后面只需单击工具栏 绿圈箭头 即可重新构建并运行，或则使用快捷键 <code>Ctrl + F11</code>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;eclipse 使用笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="eclipse" scheme="https://rachpt.github.io/tags/eclipse/"/>
    
  </entry>
  
  <entry>
    <title>Interview-notes</title>
    <link href="https://rachpt.github.io/2019/09/18/Interview-notes/"/>
    <id>https://rachpt.github.io/2019/09/18/Interview-notes/</id>
    <published>2019-09-18T01:39:33.000Z</published>
    <updated>2019-09-23T03:39:47.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>面试笔记</p></blockquote><a id="more"></a><h1 id="cache-buffer-区别"><a href="#cache-buffer-区别" class="headerlink" title="cache buffer 区别"></a>cache buffer 区别</h1><p>cache 高速缓存区，提高度取命中率，速度较快，一般为RAM静态区域，buffer 缓冲区，将文件一次写入磁盘，减少写文件I/O压力。</p><h1 id="du-与-ls-查看文件大小区别"><a href="#du-与-ls-查看文件大小区别" class="headerlink" title="du 与 ls 查看文件大小区别"></a>du 与 ls 查看文件大小区别</h1><p>du 为 disk usage，显示的是文件占用磁盘的大小，而 ls -l 显示的是文件的实际大小，占用大小大于等于文件大小。</p><p>因为文件系统使用 块 block 作为最小单元管理磁盘，一般为 4K 一个block，所以 1K 大小的文件使用 du 查看占用一个 block，4K。</p><h1 id="load-大小"><a href="#load-大小" class="headerlink" title="load 大小"></a>load 大小</h1><p>load 与系统 CPU 核数有关，单核 CPU load 为 1 就表示满负载，对于多核，load 满负载时为 核心数。</p><p>三个值为 1、5、15分钟内平均负载。</p><p>查看 CPU 核心数<code>grep &#39;model name&#39; /proc/cpuinfo | wc -l</code></p><h1 id="301-与-302-跳转区别"><a href="#301-与-302-跳转区别" class="headerlink" title="301 与 302 跳转区别"></a>301 与 302 跳转区别</h1><p>301 为永久性的跳转，对搜索引擎友好，302 为暂时性的跳转。</p><h1 id="find"><a href="#find" class="headerlink" title="find"></a>find</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -exec 末尾  + 或者 \;</span></span><br><span class="line"><span class="comment">#  + 后面可以使用 管道</span></span><br><span class="line">find ../Public/ -<span class="built_in">type</span> f -<span class="built_in">exec</span> du -Sh &#123;&#125; +</span><br><span class="line">find ../Public/ -<span class="built_in">type</span> f -<span class="built_in">exec</span> du -Sh &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>列出最大的前10个文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -<span class="built_in">type</span> f -<span class="built_in">exec</span> du -Sh &#123;&#125; + | sort -rh | head -n 10</span><br></pre></td></tr></table></figure></p><p><a href="https://linux.cn/article-9495-1.html" target="_blank" rel="noopener">参考文档</a>。</p><p><code>-mtime +2</code> 大于2天，<code>-mmin -2</code> 两分钟之内，<code>-size -10M</code> 大小。</p><h1 id="HTTP-版本区别"><a href="#HTTP-版本区别" class="headerlink" title="HTTP 版本区别"></a>HTTP 版本区别</h1><p>HTTP/2采用二进制格式而非文本格式<br>HTTP/2是完全多路复用的，而非有序并阻塞的——只需一个连接即可实现并行<br>使用报头压缩，HTTP/2降低了开销<br>HTTP/2让服务器可以将响应主动“推送”到客户端缓存中</p><p><a href="https://blog.csdn.net/N1314N/article/details/91312173" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;面试笔记&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="面试" scheme="https://rachpt.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>proxy-to-subpath-with-nginx</title>
    <link href="https://rachpt.github.io/2019/08/09/proxy-to-subpath-with-nginx/"/>
    <id>https://rachpt.github.io/2019/08/09/proxy-to-subpath-with-nginx/</id>
    <published>2019-08-09T02:00:34.000Z</published>
    <updated>2019-09-23T09:17:17.684Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用nginx将网站反代值二级目录。</p></blockquote><a id="more"></a><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>现有一个不能增加二级域名的的网站，希望使用该域名完整代理其他一个网站到一个二级路径，同时保证现有的服务仍然可用。</p><p>同时还有一个问题，需要将 https 的内容反代到 http，(登录 cookie有secure flag)。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">unsecure_cookie *; # 这个需要自己编译附加模块</span><br><span class="line">location ^~ /hudbt &#123;</span><br><span class="line">  proxy_pass https://hudbt.hust.edu.cn/;</span><br><span class="line">  unsecure_cookie *;</span><br><span class="line">  proxy_cookie_path     /          /hudbt;</span><br><span class="line">  proxy_cookie_domain  hudbt.hust.edu.cn $host;</span><br><span class="line">  sub_filter      &quot;hudbt.hust.edu.cn&quot;   $host;</span><br><span class="line">  proxy_redirect https://$host/index.php http://$host/hudbt/index.php;</span><br><span class="line">  proxy_redirect https://$host/login.php http://$host/hudbt/login.php;</span><br><span class="line">  proxy_set_header Host            $host;</span><br><span class="line">  proxy_set_header X-Real-IP       $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  # 允许客户端请求的最大单文件字节数</span><br><span class="line">  client_max_body_size       10m;</span><br><span class="line">  # 缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">  client_body_buffer_size    128k;</span><br><span class="line">  # nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">  proxy_connect_timeout      300;</span><br><span class="line">  # 后端服务器数据回传时间(代理发送超时)</span><br><span class="line">  proxy_send_timeout         300;</span><br><span class="line">  # 连接成功后，后端服务器响应时间(代理接收      超时)</span><br><span class="line">  proxy_read_timeout         300;</span><br><span class="line">  # 设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">  proxy_buffer_size          4k;</span><br><span class="line">  #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">  proxy_buffers              4 32k;</span><br><span class="line">  #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">  proxy_busy_buffers_size    64k;</span><br><span class="line">  #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">  proxy_temp_file_write_size 64k;</span><br><span class="line">  # https to http</span><br><span class="line">  if ($scheme = https) &#123;</span><br><span class="line">    rewrite ^(.*)? http://$http_host$1 permanent;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">if ( $request_uri ~* ^/(cache|attachments|pic|styles)/ ) &#123;</span><br><span class="line">  rewrite ^/(cache|attachments|pic|styles)/(.*)$  /hudbt/$1/$2 permanent;</span><br><span class="line">&#125;</span><br><span class="line">if ( $request_uri ~* ^/([a-z0-9]+\.php[a-z0-9&amp;+?-_%@#=\.]*)$ )&#123;</span><br><span class="line">  rewrite ^/(.*)$ /hudbt/$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>unsecure_cookie *;</code> 为编译附加其他模块引入，后面会提到。</p><p><code>location</code> 用来将所有以<code>hudbt</code>开头的请求定向到反代域名<code>https://hudbt.hust.edu.cn/</code></p><p><code>proxy_cookie_path</code> 指定cookie有效链接范围，两个<code>proxy_redirect</code>用于修改登录后 301 跳转链接中的https，以及重定向至反代路径。</p><p>后面的 http to http 使用<code>rewrite</code>重定向至http链接，<code>permanent</code>flag表示地址栏也改成重定向后的链接。</p><p>后面两个 if 语句用于改写反代网站url至二级路径链接。第一个处理反代网站文件夹链接，第二个处理反代网站的所有php文件(包括含有参数的请求)，这就要求原本网站不能有直接裸露在更目录的php文件。只需使用其他二级路径放原本裸露的php就能避免和反代冲突。</p><h1 id="Secure-Flag"><a href="#Secure-Flag" class="headerlink" title="Secure Flag"></a>Secure Flag</h1><p>如果Cookie中有此flag，则表示这个cookie只有用在https请求中，如果改成http，那么cookie就会丢失。还在有人提供了这个模块，<a href="https://github.com/yumauri/nginx_unsecure_cookie_module" target="_blank" rel="noopener">nginx_unsecure_cookie_module</a>，自己编译nginx，得到这个可以去掉 proxy cookie中secure的feature。</p><p>编译需要把必要的需求模块参数都加上，否则可能会提示很多功能不能用。</p><p>这里我直接查看 arch 源里面nginx的编译参数，加上上面模块即可，编译完成后 直接 替换nginx二进制可执行文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">./config --prefix=/etc/nginx \</span><br><span class="line">  --conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">  --sbin-path=/usr/bin/nginx \</span><br><span class="line">  --pid-path=/run/nginx.pid \</span><br><span class="line">  --lock-path=/run/lock/nginx.lock \</span><br><span class="line">  --user=http \</span><br><span class="line">  --group=http \</span><br><span class="line">  --http-log-path=/var/log/nginx/access.log \</span><br><span class="line">  --error-log-path=stderr \</span><br><span class="line">  --http-client-body-temp-path=/var/lib/nginx/client-body \</span><br><span class="line">  --http-proxy-temp-path=/var/lib/nginx/proxy \</span><br><span class="line">  --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \</span><br><span class="line">  --http-scgi-temp-path=/var/lib/nginx/scgi \</span><br><span class="line">  --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \</span><br><span class="line">  --with-cc-opt=&apos;-march=x86-64 -mtune=generic -O2 -pipe -fno-plt -D_FORTIFY_SOURCE=2&apos; \</span><br><span class="line">  --with-ld-opt=-Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now \</span><br><span class="line">  --with-compat \</span><br><span class="line">  --with-debug \</span><br><span class="line">  --with-file-aio \</span><br><span class="line">  --with-http_addition_module \</span><br><span class="line">  --with-http_auth_request_module \</span><br><span class="line">  --with-http_dav_module \</span><br><span class="line">  --with-http_degradation_module \</span><br><span class="line">  --with-http_flv_module \</span><br><span class="line">  --with-http_geoip_module \</span><br><span class="line">  --with-http_gunzip_module \</span><br><span class="line">  --with-http_gzip_static_module \</span><br><span class="line">  --with-http_mp4_module \</span><br><span class="line">  --with-http_realip_module \</span><br><span class="line">  --with-http_secure_link_module \</span><br><span class="line">  --with-http_slice_module \</span><br><span class="line">  --with-http_ssl_module \</span><br><span class="line">  --with-http_stub_status_module \</span><br><span class="line">  --with-http_sub_module \</span><br><span class="line">  --with-http_v2_module \</span><br><span class="line">  --with-mail \</span><br><span class="line">  --with-mail_ssl_module \</span><br><span class="line">  --with-pcre-jit \</span><br><span class="line">  --with-stream \</span><br><span class="line">  --with-stream_geoip_module \</span><br><span class="line">  --with-stream_realip_module \</span><br><span class="line">  --with-stream_ssl_module \</span><br><span class="line">  --with-stream_ssl_preread_module \</span><br><span class="line">  --with-threads \</span><br><span class="line">  --add-module=nginx_unsecure_cookie_module</span><br></pre></td></tr></table></figure></p><p>后面的 <code>--add-module</code>即是额外的去除secure的模块。</p><p>如第二部分配置第一行所示，就可去除所有cookie中的额外 flag。</p><p>至此，使用http二级路径反代https网站成功。</p><p><a href="https://serverfault.com/a/963778" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用nginx将网站反代值二级目录。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="nginx" scheme="https://rachpt.github.io/tags/nginx/"/>
    
      <category term="proxy" scheme="https://rachpt.github.io/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>hexo-pit</title>
    <link href="https://rachpt.github.io/2019/07/21/hexo-pit/"/>
    <id>https://rachpt.github.io/2019/07/21/hexo-pit/</id>
    <published>2019-07-21T10:59:19.000Z</published>
    <updated>2019-09-23T03:40:38.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hexo 中遇到的坑</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br><span class="line">&#123;##&#125;</span><br><span class="line">&#123;%%&#125;</span><br></pre></td></tr></table></figure><p>这些东西如果出现在博文中需要放到<code>代码</code>里面，特别是对于不全的形式，需要使用代码块，行内形式都不行。</p><p>比如<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#abv&#125;</span></span><br></pre></td></tr></table></figure></p><p>如果直接使用 ` 包裹就会遇到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">Template render error: (unknown path)</span><br><span class="line">Error: expected end of comment, got end of file</span><br><span class="line">at Object._prettifyError (/home/rachpt/blog-old/node_modules/nunjucks/src/lib.js:36:11)</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p><p><a href="http://xcoding.tech/2018/08/08/hexo/%E5%A6%82%E4%BD%95%E4%BB%8E%E6%A0%B9%E6%9C%AC%E8%A7%A3%E5%86%B3hexo%E4%B8%8D%E5%85%BC%E5%AE%B9%7B%7B%7D%7D%E6%A0%87%E7%AD%BE%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">扩展阅读</a>。</p><h1 id="相对链接"><a href="#相对链接" class="headerlink" title="相对链接"></a>相对链接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% post_link markdown-learning-by-maxiang 点击这里查看这篇文章 %&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/iissnan/hexo-theme-next/issues/978#issuecomment-231634416" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;hexo 中遇到的坑&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://rachpt.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>digital-image-processing-notes</title>
    <link href="https://rachpt.github.io/2019/07/14/digital-image-processing-notes/"/>
    <id>https://rachpt.github.io/2019/07/14/digital-image-processing-notes/</id>
    <published>2019-07-14T14:33:43.000Z</published>
    <updated>2019-09-23T03:40:20.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>数字图像处理笔记。</p></blockquote><a id="more"></a><h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p>彩色转化成灰度图公式：</p><script type="math/tex; mode=display">gray = 0.2989 * R + 0.5870 * G + 0.1140 * B</script><h2 id="灰度内插"><a href="#灰度内插" class="headerlink" title="灰度内插"></a>灰度内插</h2><ul><li><p>最近邻内插法，简单，但是失真较严重，不常用。</p></li><li><p>双线性内插法： 使用四个近邻估计给定位置的灰度，比较常用。<br>公式 $v(x, y) = ax + by + cxy + d$，四个系数刚好使用四个近邻点给出。<br>本质是非线性变换。</p></li><li><p>双三次内插：使用16个近邻点确定给定位置的灰度。<br>公式： 计算量较大，效果更好。</p><script type="math/tex; mode=display">v(x, y) = \sum_{i=0}^3 \sum_{j=0}^3 a_{ij} x^i y^j</script></li></ul><h1 id="图像几何空间变换"><a href="#图像几何空间变换" class="headerlink" title="图像几何空间变换"></a>图像几何空间变换</h1><p>由两个基本操作组成： 1) 坐标空间变化；2) 灰度内插。</p><p>常用的<strong>空间变换</strong>——仿射变换如下：</p><script type="math/tex; mode=display">[x,y,1]=[v,w,1]T=[v,w,1]\begin{bmatrix} t_{11} & t_{12} & 0 \\ t_{21} & t_{22} & 0 \\ t_{31} & t_{32} & 1 \end{bmatrix} \label{gtrans}</script><p>不同的矩阵元T得到不同的效果，旋转、平移、偏移。</p><p>仿射变换</p><div class="table-container"><table><thead><tr><th style="text-align:center">变换</th><th style="text-align:center">仿射矩阵</th><th style="text-align:center">坐标公式</th></tr></thead><tbody><tr><td style="text-align:center">恒等变换</td><td style="text-align:center">$\begin{bmatrix} 1 &amp; 0 &amp; 0 \ 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=v \ y=w$</td></tr><tr><td style="text-align:center">缩放</td><td style="text-align:center">$\begin{bmatrix} c_x &amp; 0 &amp; 0 \ 0 &amp; c_y &amp; 0 \ 0 &amp; 0 &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=c_xv \ y=c_yw$</td></tr><tr><td style="text-align:center">旋转</td><td style="text-align:center">$\begin{bmatrix} \cos\theta &amp; \sin\theta &amp; 0 \ -\sin\theta &amp; \cos\theta &amp; 0 \ 0 &amp; 0 &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=v\cos\theta - w\sin\theta \ y=v\sin\theta+w\cos\theta$</td></tr><tr><td style="text-align:center">平移</td><td style="text-align:center">$\begin{bmatrix} 1 &amp; 0 &amp; 0 \ 0 &amp; 1 &amp; 0 \ t_x &amp; t_y &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=v+t_x \ y=w+t_y$</td></tr><tr><td style="text-align:center">偏移(垂直)</td><td style="text-align:center">$\begin{bmatrix} 1 &amp; 0 &amp; 0 \ s_v &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=v+s_vw \ y=w$</td></tr><tr><td style="text-align:center">偏移(水平)</td><td style="text-align:center">$\begin{bmatrix} 1 &amp; s_v &amp; 0 \ 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 1 \end{bmatrix}$</td><td style="text-align:center">$x=v \ y=w+s_vv$</td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/digital-image-processing-notes-2019-7-17-16-51-26.png" alt="digital-image-processing-notes-2019-7-17-16-51-26.png"></p><p>对应如上图。</p><p>有两种方法使用上 $\ref{gtrans}$ 式：前向映射；反向映射。前者可能出现多对一的情况，或者没有对应情况。后一种更高效。具体如下：</p><p>使用 $(v, w) = T^{-1}(x, y)$ 扫描输出像素位置，得到输入图像对应位置，然后在输入图像中使用插值得到需要的点的像素值。</p><h2 id="图像变换"><a href="#图像变换" class="headerlink" title="图像变换"></a>图像变换</h2><p>向量范数。</p><p>线性变换域一般方法：</p><p>$f(x,y)$ ——&gt; 变换  —$T(u,v)$—&gt; 运算 —$R[T(u,v)]$—&gt; 反变换 ——&gt; $g(x,y)$</p><p>除了傅里叶变换以为，还有：沃尔什变换、哈达玛变换、离散余弦变换、哈尔变换、斜变换。( Walsh,  Hadamard, discrete cosine, Haar, and slant transforms)</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;数字图像处理笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>notes-for-ffmpeg</title>
    <link href="https://rachpt.github.io/2019/06/02/notes-for-ffmpeg/"/>
    <id>https://rachpt.github.io/2019/06/02/notes-for-ffmpeg/</id>
    <published>2019-06-02T09:08:49.000Z</published>
    <updated>2019-09-23T09:46:12.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一些ffmpeg处理视频笔记。</p></blockquote><a id="more"></a><h1 id="裁剪黑边"><a href="#裁剪黑边" class="headerlink" title="裁剪黑边"></a>裁剪黑边</h1><p>主要使用 ffmpeg 的 <code>crop</code> 以及 <code>cropdetect</code> 参数。</p><p>视频左上角为坐标(0,0)，单位为像素。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -vf <span class="string">"cropdetect=24:16:0"</span> dummy.mp4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以得到如下所示信息</span></span><br><span class="line"><span class="comment"># [Parsed_cropdetect_0 @ 0x7fab586781c0] x1:36 x2:1883 y1:0 y2:1079 w:1840 h:1072 x:40 y:4 pts:3584 t:0.233333 crop=1840:1072:40:4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ctrl + C 停止，复制 crop=1840:1072:40:4 用于后面步骤</span></span><br><span class="line"><span class="comment"># 注意视频黑边 是否会变化，否则需取舍使用哪些参数。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用 ffplay 预览，不用'压制'即可得到 crop 信息。</span></span><br><span class="line">ffplay input.mp4 -vf cropdetect=24:16:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后面的参数 24 16 0 为默认值，更多请移步 [官方文档](https://www.ffmpeg.org/ffmpeg-filters.html#cropdetect)</span></span><br></pre></td></tr></table></figure><p>关于 crop，第一个 1840 表示裁剪出来的矩形长1840像素，宽1072像素，从(40,0)坐标处开始裁剪。<a href="https://www.ffmpeg.org/ffmpeg-filters.html#crop" target="_blank" rel="noopener">crop官方文档</a>。</p><p>除了使用 ffmpeg 的 cropdetect 参数外，可以截取一张视频图片，使用 GIMP 等图像工具，手动测量得到需要的参数。<br>以 GIMP 为例：</p><pre><code>1. 拉出参考线，Ctrl+鼠标滚轮放大，M 移动工具；2. Shift + M 换到测量工具，Ctrl 拉出水平垂直测量线。</code></pre><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-ffmpeg-2019-6-2-18-7-13.png" alt="notes-for-ffmpeg-2019-6-2-18-7-13.png"></p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-ffmpeg-2019-6-2-18-7-28.png" alt="notes-for-ffmpeg-2019-6-2-18-7-28.png"></p><h1 id="去水印"><a href="#去水印" class="headerlink" title="去水印"></a>去水印</h1><p>和裁剪黑边类似，使用 <code>delogo</code> 命令，<a href="https://www.ffmpeg.org/ffmpeg-filters.html#delogo" target="_blank" rel="noopener">官方文档</a>。</p><p>同样需要定位位置，使用上面提到的 GIMP 测量坐标。<br><code>delogo=x=1742:y=992:w=132:h=40</code>，如其意，x y坐标起点(左上角0、0)，w  h宽和高。<br>一次可以定义多个去水印位置，使用 <code>,</code> 分隔，放置在滤镜参数里面。例子如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ffmpeg -y -i in.mp4 -vf <span class="string">"delogo=x=1472:y=35:w=408:h=42,delogo=x=1742:y=992:w=132:h=40,crop=1840:1040:40:0"</span> \</span><br><span class="line">-metadata comment=<span class="string">'made by rachpt'</span> -max_muxing_queue_size 1024 out.mp4</span><br></pre></td></tr></table></figure></p><p>两个水印，加上裁剪黑边。</p><p>效果对比如下：</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-ffmpeg-2019-6-2-18-10-25.png" alt="notes-for-ffmpeg-2019-6-2-18-10-25.png"></p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-ffmpeg-2019-6-2-18-10-38.png" alt="notes-for-ffmpeg-2019-6-2-18-10-38.png"></p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-ffmpeg-2019-6-2-18-10-54.png" alt="notes-for-ffmpeg-2019-6-2-18-10-54.png"></p><h1 id="倍速"><a href="#倍速" class="headerlink" title="倍速"></a>倍速</h1><p>详见：<br><a href="https://github.com/rachpt/shell-scripts/blob/master/speed_up_video.sh" target="_blank" rel="noopener">https://github.com/rachpt/shell-scripts/blob/master/speed_up_video.sh</a></p><h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><p>1.7 倍速：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i <span class="string">"<span class="variable">$i</span>"</span> -r 30 -c:v libx264 -preset fast \</span><br><span class="line">-filter_complex <span class="string">"[0:v]setpts=10/17 *PTS[v];[0:a]atempo=1.7[a]"</span> \</span><br><span class="line">-map <span class="string">"[v]"</span> -map <span class="string">"[a]"</span> <span class="string">"../encode/<span class="variable">$i</span>"</span> -y</span><br></pre></td></tr></table></figure></p><h2 id="音频"><a href="#音频" class="headerlink" title="音频"></a>音频</h2><p>如上，<code>[0:a]atempo=1.7[a]</code>。</p><h2 id="字幕"><a href="#字幕" class="headerlink" title="字幕"></a>字幕</h2><p>使用shell来完成，<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `grep -Eo <span class="string">'([0-9]&#123;2&#125;:)&#123;2&#125;[0-9]&#123;2&#125;,[0-9]&#123;3&#125;'</span> <span class="string">"<span class="variable">$file</span>"</span>` ;<span class="keyword">do</span> </span><br><span class="line">  a=<span class="variable">$&#123;i:0:2&#125;</span>;</span><br><span class="line">  b=<span class="variable">$&#123;i:3:2&#125;</span>;</span><br><span class="line">  c=<span class="variable">$&#123;i:6:2&#125;</span>;</span><br><span class="line">  d=<span class="variable">$&#123;i:9:3&#125;</span>;</span><br><span class="line">  <span class="comment"># 匹配视频 1.7 倍速</span></span><br><span class="line">  total=`<span class="built_in">echo</span> <span class="string">"scale=0;(((<span class="variable">$a</span>*60+<span class="variable">$b</span>)*60+<span class="variable">$c</span>)*1000+<span class="variable">$d</span>)/1.7"</span>|bc`;</span><br><span class="line">  e=$((total % 1000));f=$((total / 1000));</span><br><span class="line">  g=$((f % 60));</span><br><span class="line">  h=$((f / 60));x=$((h % 60));</span><br><span class="line">  y=$((h / 60)) ;</span><br><span class="line">  j=`<span class="built_in">printf</span> <span class="string">"%02d:%02d:%02d,%03d\n"</span> <span class="variable">$y</span> <span class="variable">$x</span> <span class="variable">$g</span> <span class="variable">$e</span>`;</span><br><span class="line">  sed -i <span class="string">"s/<span class="variable">$i</span>/<span class="variable">$j</span>/"</span> <span class="string">"<span class="variable">$file</span>"</span>;</span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后封装在一起参数</span></span><br><span class="line">ffmpeg -i in.mp4 -i sub.srt -c:s mov_text -c:v copy -c:a copy out.mp4</span><br></pre></td></tr></table></figure></p><h1 id="音视频提取与合并"><a href="#音视频提取与合并" class="headerlink" title="音视频提取与合并"></a>音视频提取与合并</h1><h2 id="提取"><a href="#提取" class="headerlink" title="提取"></a>提取</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取视频</span></span><br><span class="line">ffmpeg -i input.mp4 -c:v copy -an video.mp4</span><br><span class="line"><span class="comment"># 提取音频</span></span><br><span class="line">ffmpeg -i input.mp4 -c:a copy -vn audio.m4a</span><br></pre></td></tr></table></figure><p>其中 v 视频，a 音频。</p><h2 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视频 音频 (字幕)分别单文件</span></span><br><span class="line">ffmpeg -i input.mp4 -i audio.m4a -i sub.srt -c:v copy -c:a copy -c:s mov_text output.mp4</span><br><span class="line"><span class="comment"># 视频里面有音轨，需要替换音轨</span></span><br><span class="line">ffmpeg -i input.mp4 -i audio.m4a -c:v copy -c:a copy -map 0:v:0 -map 1:a:0 output.mp4</span><br><span class="line"><span class="comment"># 追加音轨，再加一个  -map 0:a:0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装多字幕</span></span><br><span class="line">ffmpeg -i input.mp4 -i chs.srt -i eng.srt -c copy -map 0:0 -map 0:1 -map 1:0 -map 2:0 \</span><br><span class="line">-c:s mov_text -c:s mov_text output.mp4</span><br></pre></td></tr></table></figure><p><code>map</code> 参数第一个表示 输出文件，0 第一个，1 第二个，v/a 和上面提到的一样，表示视频 / 音频，最后面的数字表示输入文件里面的第几个视频 / 音频 轨道。通常一个视频 一个视频轨道一个音频轨道，这个需要自己看 <code>mediainfo</code>。</p><h1 id="删除压制信息"><a href="#删除压制信息" class="headerlink" title="删除压制信息"></a>删除压制信息</h1><p>删除视频文件 mediainfo 里面的 Writing library 和 Encoding settings，<br>添加如下参数<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x265</span></span><br><span class="line">-x265-params no-info=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># x264 (ffmpeg 4.0+)</span></span><br><span class="line">-bsf:v <span class="string">'filter_units=remove_types=6'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 General 里面的附加信息</span></span><br><span class="line">-map_metadata -1</span><br></pre></td></tr></table></figure></p><p>参考<a href="https://superuser.com/a/1218771" target="_blank" rel="noopener">文档一</a>，<a href="https://video.stackexchange.com/a/27617" target="_blank" rel="noopener">文档二</a>。</p><h1 id="停止播放"><a href="#停止播放" class="headerlink" title="停止播放"></a>停止播放</h1><p>ffplay 使用 <code>-t 时间</code> 可以只播放一小段，但是并不会到时间后退出播放，而是会处于等待状态。<br>添加 <code>-autoexit</code> 参数即可解决该问题。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ul><li>使用 -ss 0:0:0 -t 1:0:0 后可能会遇到下面的报错，</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Too many packets buffered <span class="keyword">for</span> output stream 0:1.</span><br></pre></td></tr></table></figure><p>只需要多加一个 <code>-max_muxing_queue_size 1024</code> 参数在其中即可解决，<a href="https://stackoverflow.com/q/49686244/11817844" target="_blank" rel="noopener">详见这里</a>。</p><ul><li>隐藏 版本信息编译参数</li></ul><p>添加参数 -hide_banner 即可。</p><ul><li>libx265 2pass 遇到如下错误，卡住不动<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cur_dts is invalid (this is harmless if it occurs once at the start per stream)</span><br><span class="line">在不同机器上，不同版本 ffmpeg 使用相同的压制命令却不会遇到这个问题。</span><br><span class="line">另外，换用 libx264 不会遇到此问题。</span><br></pre></td></tr></table></figure></li></ul><p>多番查证，可能是原视频某些信息不全所致。<br>最终发现是 使用的 缩放 (-s 1280x720 或者 滤镜 - vf scale=-2:720) 参数导致的，去掉缩放，2pass 不会遇到此问题。</p><p>最后曲线救国，先将原文件使用 ffmpeg -c copy 相同容器复制一份，使用新生成的文件成功缩放压制。 </p><ul><li>缩放警告 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[swscaler @ 0x558c475f32c0] Warning: data is not aligned! This can lead to a speed loss</span><br></pre></td></tr></table></figure></li></ul><p>修改 宽度 为 16 的倍数。<a href="https://blog.csdn.net/panda1234lee/article/details/53334254" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;一些ffmpeg处理视频笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="ffmpeg" scheme="https://rachpt.github.io/tags/ffmpeg/"/>
    
  </entry>
  
  <entry>
    <title>ssh-tunnel</title>
    <link href="https://rachpt.github.io/2019/05/29/ssh-tunnel/"/>
    <id>https://rachpt.github.io/2019/05/29/ssh-tunnel/</id>
    <published>2019-05-29T14:21:12.000Z</published>
    <updated>2019-09-23T03:41:44.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用 ssh 隧道使用外网访问 NAT 内网服务。</p></blockquote><a id="more"></a><h1 id="情景描述"><a href="#情景描述" class="headerlink" title="情景描述"></a>情景描述</h1><p>一台电脑能够 使用 ssh 连接到外部电脑，比如地址是 <code>115.115.115.1</code>，但是反过来不行，因为这台电脑得到的地址是 10 开头的 NAT 内网地址。</p><p>现在希望 外面的 115 地址的机器可以 ssh 到这台 10 地址的机器上，并且访问该机器上面的 web 服务(比如qbittorrent的webui)。</p><p>单独使用 ssh 方向透穿不稳定，因为 ssh 不活动一段时间过后这条连接就会被中断，然后你在外面的 115 那里是死活也每办法让 10 那里再重新 ssh到 115这里的啦。</p><p>于是 autossh 就被用来干这样一件事情，维持一条持续的 ssh 通道。</p><h1 id="反向穿透-ssh"><a href="#反向穿透-ssh" class="headerlink" title="反向穿透 ssh"></a>反向穿透 ssh</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 5678 -CNR 2333:localhost:22 rachpt@115.115.115.1 -p 22</span><br></pre></td></tr></table></figure><p>5678 是autossh的监听端口，2333 就是在外部 115 机器上访问 10 机器的端口号，第一个 22 表示 10 机器的 ssh 在22端口(默认值)，后面的表示 115 机器ssh端口在默认的22。</p><p>这样做有个问题，就是需要输入 115 机器的ssh密码，我们可以使用 ssh 的 pub key避免输入密码，就像我们使用github那样。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------</span></span><br><span class="line"><span class="comment"># 在 10 机器上</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="comment"># 生成公钥，自己记得给个名字</span></span><br><span class="line"></span><br><span class="line">cat ~/.ssh/你命的名.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------</span></span><br><span class="line"><span class="comment"># 复制到 115 的机器上面</span></span><br><span class="line"><span class="comment"># 比如放到 ~/.ssh/authorized_keys 里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑 /etc/ssh/sshd_config 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加或则修改</span></span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>这样就能实现 10 机器免密码 ssh 到 115 机器。</p><p>为了实现开机自动使用 autossh 反向透穿，使用 systemd，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/autossh.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=auto SSH</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">User=rachpt</span><br><span class="line">ExecStart=/usr/bin/autossh -M 5678 -CNR 2333:localhost:22 rachpt@115.156.156.1</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>一通 daemon-reload enable start就可以了。</p><p>记得kill掉占用端口的进程，不然gg…</p><h1 id="反向穿透-web-服务"><a href="#反向穿透-web-服务" class="headerlink" title="反向穿透 web 服务"></a>反向穿透 web 服务</h1><p>这里以 qbittorrent-nox webui 为例。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 5001 -CNR 10010:localhost:10010 rachpt@115.156.115.1</span><br></pre></td></tr></table></figure><p><strong><a href="https://github.com/qbittorrent/qBittorrent/issues/7274#issuecomment-362936393" target="_blank" rel="noopener">重要提示：远程端口和服务端口必须一致</a></strong>，我用的10010端口，否则401连不上。</p><p>当然 qbittorrent-nox 需要在 10010端口运行 webui(具体请使用 help)。</p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -t -i:10010</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看占用端口 10010 的进程</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用 ssh 隧道使用外网访问 NAT 内网服务。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="ssh" scheme="https://rachpt.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>substitute-sinaimg-with-githubimg-url</title>
    <link href="https://rachpt.github.io/2019/04/29/substitute-sinaimg-with-githubimg-url/"/>
    <id>https://rachpt.github.io/2019/04/29/substitute-sinaimg-with-githubimg-url/</id>
    <published>2019-04-29T04:16:12.000Z</published>
    <updated>2019-09-23T03:41:47.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最好的图床 新浪 已经禁止外链，图片迁移至 github。</p></blockquote><a id="more"></a><p>前些天，得知 新浪 图片禁止外链，就在想怎么解决图片问题，直接放在 github pages 里面又要改动很多。</p><p>恰好最近在使用 vs-code，试了一下 picgo 插件，感觉很棒，smsm图床我是不敢用，404了去找谁。</p><p>于是在github建一个 repo 专门存放图片，还能备份到坚果云一份。替换新浪图片链接为 github 链接。</p><p>先是在 vs-code 里面手动替换了几个，工作量太大，于是写了个bash脚本完成这件事。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Author: rachpt@126.com</span></span><br><span class="line"><span class="comment"># Date: 2019-04-29</span></span><br><span class="line"><span class="comment"># 批量下载 md 文件中的 新浪图片，重命名为 `文件名-数字` 格式</span></span><br><span class="line"><span class="comment"># 替换md文件中的 新浪图片地址</span></span><br><span class="line"><span class="comment"># 批量下载图片</span></span><br><span class="line"><span class="function"><span class="title">download_pic</span></span>() &#123;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `ls -1 *.md`; <span class="keyword">do</span></span><br><span class="line">lists=<span class="string">"<span class="variable">$(grep -Eio 'https?://ws..sinaimg.[-0-9a-z/]+.jpg' "$i")</span>"</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$lists</span> ]]; <span class="keyword">then</span> </span><br><span class="line">total=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$lists</span>"</span>|wc -l`; j=1</span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$j</span> -le <span class="variable">$total</span> ]]; <span class="keyword">do</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;i%.md&#125;</span>-<span class="variable">$j</span></span><br><span class="line">picurl=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$lists</span>"</span>|sed -n <span class="string">"<span class="variable">$j</span> p"</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$picurl</span></span><br><span class="line"><span class="comment"># 此处使用了 httpie，当然可以使用 crul wget 等工具</span></span><br><span class="line">http -d <span class="string">"<span class="variable">$picurl</span>"</span> -o <span class="string">"../pic/<span class="variable">$&#123;i%.md&#125;</span>-<span class="variable">$j</span>.jpg"</span></span><br><span class="line">((j++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 替换 url 地址。两条完全可以合在一起，为了减少意外错误，这里分开</span></span><br><span class="line"><span class="function"><span class="title">substitute_url</span></span>() &#123;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `ls -1 *.md`; <span class="keyword">do</span></span><br><span class="line">lists=<span class="string">"<span class="variable">$(grep -Eio 'https?://ws..sinaimg.[-0-9a-z/]+.jpg' "$i")</span>"</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$lists</span> ]]; <span class="keyword">then</span> </span><br><span class="line">total=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$lists</span>"</span>|wc -l`; j=1</span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$j</span> -le <span class="variable">$total</span> ]]; <span class="keyword">do</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;i%.md&#125;</span>-<span class="variable">$j</span></span><br><span class="line">picurl=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$lists</span>"</span>|sed -n <span class="string">"<span class="variable">$j</span> p"</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$picurl</span></span><br><span class="line"><span class="comment"># 说明：picurl 中包含'/'，因此使用\% 作为自定义正则标识符</span></span><br><span class="line"><span class="comment"># s 命令匹配部分 ![] 都需要转义，替换的不用，后一个 s 使用%分割而不是/</span></span><br><span class="line"><span class="comment"># 使用 &#123;&#125; 限定替换范围</span></span><br><span class="line">sed -Ei <span class="string">"\%<span class="variable">$picurl</span>% &#123; s/\!\[.*\]/![<span class="variable">$&#123;i%.md&#125;</span>-<span class="variable">$j</span>.jpg]/; s%<span class="variable">$picurl</span>%https://raw.githubusercontent.com/rachpt/imgs/master/<span class="variable">$&#123;i%.md&#125;</span>-<span class="variable">$j</span>.jpg%; &#125;"</span> <span class="string">"<span class="variable">$i</span>"</span></span><br><span class="line">((j++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">download_pic</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'若无问题 30 秒后开始替换'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Ctrl + C 强制取消替换'</span></span><br><span class="line">sleep 30</span><br><span class="line">substitute_url</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Done!'</span></span><br></pre></td></tr></table></figure><p>脚本在 <a href="https://github.com/rachpt/shell-scripts/blob/master/change-url.sh" target="_blank" rel="noopener">https://github.com/rachpt/shell-scripts/blob/master/change-url.sh</a> 。</p><p>这里记录一下。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;最好的图床 新浪 已经禁止外链，图片迁移至 github。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="shell" scheme="https://rachpt.github.io/categories/shell/"/>
    
    
      <category term="sinaimg" scheme="https://rachpt.github.io/tags/sinaimg/"/>
    
  </entry>
  
  <entry>
    <title>notes-for-gnuplot</title>
    <link href="https://rachpt.github.io/2019/04/19/notes-for-gnuplot/"/>
    <id>https://rachpt.github.io/2019/04/19/notes-for-gnuplot/</id>
    <published>2019-04-19T06:15:53.000Z</published>
    <updated>2019-09-23T03:41:09.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>gnuplot 画图笔记。</p></blockquote><a id="more"></a><h1 id="使用希腊字母"><a href="#使用希腊字母" class="headerlink" title="使用希腊字母"></a>使用希腊字母</h1><p>这个叫 Enhanced 文本模式，首先需要设置terminal enhanced。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set term qt enhanced</span><br></pre></td></tr></table></figure></p><p>term 是 terminal 的简写形式，我使用的 qt 模式。<br>比如我想将图例，也就是 key 中插入希腊字母，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot &apos;real-prop-vecpot.dat&apos; u (-$3):($2) w lp lw 2 title &apos;E(t)/&#123;/Symbol= \145&#125;&apos;</span><br></pre></td></tr></table></figure></p><p>这里指定了 线的title，<code>{/Symbol= \145}</code>，145是8进制数 表示 16进制 65。gnuplot 的 Symbol 表中 65 表示 omega。<br><img src="https://raw.githubusercontent.com/rachpt/imgs/master/guplot-show.jpg" alt="guplot-show.jpg"><br>(图片版权：我)</p><h1 id="设置字体大小"><a href="#设置字体大小" class="headerlink" title="设置字体大小"></a>设置字体大小</h1><p>通常情况gnuplot 字体小的看不见。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 设置 图例字体大小20</span><br><span class="line">set key font &apos;,20&apos;</span><br><span class="line"></span><br><span class="line"># 可以指定字体</span><br><span class="line">set key font &apos;字体名,20&apos;</span><br><span class="line"># 详情 help set key</span><br><span class="line"></span><br><span class="line"># 其他 xlabel xtics tics 一样</span><br><span class="line">set tics font &apos;,15&apos;</span><br></pre></td></tr></table></figure><h1 id="设置-x-y-轴间距"><a href="#设置-x-y-轴间距" class="headerlink" title="设置 x(y) 轴间距"></a>设置 x(y) 轴间距</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set xtics 0,2,20</span><br><span class="line"># x轴 0开始至20，间距2</span><br><span class="line"></span><br><span class="line"># 要指定显示形式，则需要使用 像列表一样的东西。</span><br></pre></td></tr></table></figure><h1 id="图片大小"><a href="#图片大小" class="headerlink" title="图片大小"></a>图片大小</h1><ol><li><p>圆形，也就是 x=y</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set size square</span><br></pre></td></tr></table></figure></li><li><p>其他…</p></li></ol><h1 id="设置plot"><a href="#设置plot" class="headerlink" title="设置plot"></a>设置plot</h1><p>plot 加上 with (简写 w) 有 linepoints(简写 lp)，linewidth(lw)，linecolor(lc)，pointtype(pt)，pointsize(ps) 等参数，后面紧跟数子值即可，可是使用 <code>test</code> 查看各种样式对应值。</p><h1 id="对数据列操作"><a href="#对数据列操作" class="headerlink" title="对数据列操作"></a>对数据列操作</h1><p>使用 <code>plot &#39;路径&#39; using 1:2  ...</code> 可以将路径里面 第一列作为 x 第二列作为 y 画图，using简写 u，使用<code>($列号)</code>对列操作，比如这样 <code>u ($1 /2):($2 ** 2)</code>。<code>**</code> 表示 次方。</p><h1 id="设置-xy-轴范围"><a href="#设置-xy-轴范围" class="headerlink" title="设置 xy 轴范围"></a>设置 xy 轴范围</h1><p>如下所示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set xrange[0:20]</span><br><span class="line">set yrange[0:10]</span><br></pre></td></tr></table></figure></p><h1 id="GUI-的一些快捷键"><a href="#GUI-的一些快捷键" class="headerlink" title="GUI 的一些快捷键"></a>GUI 的一些快捷键</h1><p>按住 <code>ctrl</code> 鼠标滚轮， 可以缩放。</p><p><code>r</code> 键，显示鼠标处 十字。xy 值可以在左下角显示。</p><p>其他以后写，现在忘记了…</p><p><a href="http://blog.sciencenet.cn/blog-373392-535918.html" target="_blank" rel="noopener">参考文档</a>。</p><h1 id="在-gnuplot-中调用-shell-命令"><a href="#在-gnuplot-中调用-shell-命令" class="headerlink" title="在 gnuplot 中调用 shell 命令"></a>在 gnuplot 中调用 shell 命令</h1><p>使用 <code>system</code> 函数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 打印当前路径</span><br><span class="line">system(&quot;pwd&quot;)</span><br><span class="line"></span><br><span class="line">path = system(&quot;pwd&quot;)</span><br><span class="line"></span><br><span class="line">print path</span><br><span class="line"></span><br><span class="line"># 当前文件夹名</span><br><span class="line">foldername=system(&quot;basename `pwd`&quot;)</span><br></pre></td></tr></table></figure><p><a href="https://stackoverflow.com/questions/12846717/using-awk-or-other-shell-command-inside-gnuplot-function" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;gnuplot 画图笔记。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="gnuplot" scheme="https://rachpt.github.io/tags/gnuplot/"/>
    
  </entry>
  
  <entry>
    <title>notes-for-flexget</title>
    <link href="https://rachpt.github.io/2019/04/15/notes-for-flexget/"/>
    <id>https://rachpt.github.io/2019/04/15/notes-for-flexget/</id>
    <published>2019-04-15T14:21:25.000Z</published>
    <updated>2019-09-23T03:41:08.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>之前一直使用最简单的if模块满足不了要求，探索使用新的模块。 </p></blockquote><a id="more"></a><h1 id="if与regexp"><a href="#if与regexp" class="headerlink" title="if与regexp"></a>if与regexp</h1><p>这两个都可以用来进行简单的逻辑过滤。主要用在title字段，应用在其他字段也是可以的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if:</span><br><span class="line">  - &quot;&apos;Complete&apos; in title&quot;: reject</span><br><span class="line">  - &quot;&apos;NYHD&apos; in title&quot;: reject</span><br><span class="line">  - &quot;&apos;-RS&apos; in title&quot;: reject</span><br><span class="line">  - &quot;&apos;Cinderella.Chef&apos; in title&quot;: accept</span><br><span class="line">  - &quot;&apos;Douro.Mainland&apos; in title&quot;: accept</span><br><span class="line">regexp:</span><br><span class="line">  accept:</span><br><span class="line">    - game.*of.*Thrones.*s08e.*-GoT</span><br><span class="line">  reject:</span><br><span class="line">    - .*-MT$</span><br><span class="line">    - .*-HDC$</span><br><span class="line">    - .*-MT$</span><br></pre></td></tr></table></figure><p>例子如上，if 区分大小写，而regexp不区分大小写，使用正则表达式(注意写全.*)。<br>写完记得 <code>flexget daemon reload-config</code> 才会生效，我是用的 daemon 模式运行的。<br>virtualenv 使用<code>/home/rachpt/.flexget/bin/python /home/rachpt/.flexget/bin/flexget daemon reload-config</code>，前面是virtualenv 中的python路径，这个可以用在 systemd 中实现开机自动启动。<br>使用 <code>/home/rachpt/.flexget/bin/python /home/rachpt/.flexget/bin/flexget execute --try-regexp --tasks my_test_task</code> 检测 my_test_task 的regexp 运行匹配情况(记得每次修改config.yml后reload-config)。</p><h1 id="daemon"><a href="#daemon" class="headerlink" title="daemon"></a>daemon</h1><p>官方文档很全，大部分都有讲。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">schedules:</span><br><span class="line">  - tasks: [&apos;hdchina&apos;, &apos;wiki&apos;, &apos;hdsky&apos;, &apos;byr_an&apos;, &apos;ipt_movies&apos;]</span><br><span class="line">    interval:</span><br><span class="line">      minutes: 3</span><br><span class="line">  - tasks: &apos;ipt_tvs&apos;</span><br><span class="line">    schedule:</span><br><span class="line">      day_of_week: mon</span><br><span class="line">      hour: 8-10</span><br><span class="line">      minute: &quot;*/1&quot;</span><br></pre></td></tr></table></figure><p>schedules是一个Top-Level Keys，有两种定时模式，interval 就是等时间间隔运行，以前的文档中有提到使用 seconds，现在好像不行了，也就是说，最小更新频率 1分钟一次(可能说的不对，使用 seconds，check不过)。tasks作用任务字典(一个就使用字符串，记得引号)。</p><p>另一种是和 cron 类似的模式，上面的例子，每周一 8-10点每 1分钟运行一次 task ipt-tvs。同样最小单位分钟。</p><p>systemd 设置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/systemd/system/flexget.service</span><br><span class="line"># 或则写到 /usr/lib/systemd/system/flexget.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Flexget Daemon</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">User=rachpt # 此处我没有使用 root 运行</span><br><span class="line">Type=simple</span><br><span class="line">WorkingDirectory=/home/rachpt/.flexget</span><br><span class="line">ExecStart=/home/rachpt/.flexget/bin/python /home/rachpt/.flexget/bin/flexget daemon start</span><br><span class="line">ExecStop=/home/rachpt/.flexget/bin/python /home/rachpt/.flexget/bin/flexget daemon stop</span><br><span class="line">ExecReload=/home/rachpt/.flexget/bin/python /home/rachpt/.flexget/bin/flexget daemon reload</span><br><span class="line">Nice=19</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p><p>systemctl reload-daemon &amp;&amp; systemctl enable flexget &amp;&amp; systemctl start flexget</p><h1 id="web-ui"><a href="#web-ui" class="headerlink" title="web-ui"></a>web-ui</h1><p>有两个 web-ui，使用v1就行了，区别就是v2还是半残品。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">web_server: </span><br><span class="line">  port: 9999</span><br><span class="line">  base_url: /</span><br><span class="line">  web_ui: yes</span><br><span class="line">  run_v2: true # 开启v2 webui，关闭注释即可</span><br></pre></td></tr></table></figure><p>访问地址不一样，vi: <a href="http://127.0.0.1:9999/" target="_blank" rel="noopener">http://127.0.0.1:9999/</a> ，v2: <a href="http://127.0.0.1:9999/v2/" target="_blank" rel="noopener">http://127.0.0.1:9999/v2/</a></p><p>需要设置密码，不能改用户名(flexget)，具体看官方文档。 <a href="https://flexget.com/Web-UI" target="_blank" rel="noopener">https://flexget.com/Web-UI</a> 。<br>效果图。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-flexget-1.jpg" alt="notes-for-flexget-1.jpg"></p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/notes-for-flexget-2.jpg" alt="notes-for-flexget-2.jpg"></p><h1 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h1><p>几个用于的过滤方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">size_movie:</span><br><span class="line">  content_size:</span><br><span class="line">    min: 512</span><br><span class="line">    max: 22480</span><br><span class="line">    strict: no</span><br></pre></td></tr></table></figure></p><p>按种子内容大小(体积)，单位MB。范围在 512M 至 22480M 之间的才 accept。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exists_movie:</span><br><span class="line">  path: /mnt/data/movies</span><br><span class="line">  allow_different_qualities: better</span><br></pre></td></tr></table></figure><p>如果path下已经有 1080p bluray版本资源，那么 720p bluary 就会被 reject掉。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quality:</span><br><span class="line">  - 720p bluray</span><br><span class="line">  - 1080p webdl</span><br></pre></td></tr></table></figure><p>按质量挑选，可以使用范围选择。<a href="https://flexget.com/Plugins/quality" target="_blank" rel="noopener">https://flexget.com/Plugins/quality</a> 。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>template 中不能使用 过滤规则，比如 if。</p><p>可以 自动解压 rar zip 分卷或单个文件，<a href="https://flexget.com/Plugins/decompress" target="_blank" rel="noopener">https://flexget.com/Plugins/decompress</a> ，<br><a href="https://flexget.com/Plugins/archives" target="_blank" rel="noopener">https://flexget.com/Plugins/archives</a> ，还有设置 transmission ratio等。</p><p>debug 模式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flexget -L debug --test execute --tasks my-test-task</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;之前一直使用最简单的if模块满足不了要求，探索使用新的模块。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="flexget" scheme="https://rachpt.github.io/tags/flexget/"/>
    
  </entry>
  
  <entry>
    <title>jupyter-notebook-cannot-work-with-the-same-base-name</title>
    <link href="https://rachpt.github.io/2019/04/10/jupyter-notebook-cannot-work-with-the-same-base-name/"/>
    <id>https://rachpt.github.io/2019/04/10/jupyter-notebook-cannot-work-with-the-same-base-name/</id>
    <published>2019-04-10T09:43:29.000Z</published>
    <updated>2019-09-23T03:40:43.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>.ipynb 死活连接不上kernel，但是单独放到其他目录又可以。</p></blockquote><a id="more"></a><p>使用 pycharm 以及 vs code编辑python 代码，但是运行时提示我的 matplotlib 有问题，因为我使用了 anaconda，同时有使用过 virtualenv，环境乱七八糟，但是我的 anaconda base环境里面使用我所用到的库的。由于代码也不多，于是想到直接使用jupyter notebook。</p><p>于是我创建了一个和刚才的 py 文件同名的 ipynb 文件。当然它们是在同一个文件夹下。下面就是我的遭遇：</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/jupyter-notebook-cannot-work-with-the-same-base-name-1.jpg" alt="jupyter-notebook-cannot-work-with-the-same-base-name-1.jpg"></p><p>我打开其他目录下的 ipynb 文件却是正常的，于是排除我的 jupyter 环境的问题。<br>经过一通复制粘贴重命名后，最终确定是那个 base name 一样的 py 文件导致的。改名问题解决。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/jupyter-notebook-cannot-work-with-the-same-base-name-2.jpg" alt="jupyter-notebook-cannot-work-with-the-same-base-name-2.jpg"></p><p>这里记录一下，希望有用。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;.ipynb 死活连接不上kernel，但是单独放到其他目录又可以。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="python" scheme="https://rachpt.github.io/categories/python/"/>
    
    
      <category term="jupyter, python" scheme="https://rachpt.github.io/tags/jupyter-python/"/>
    
  </entry>
  
  <entry>
    <title>notes-about-awstats</title>
    <link href="https://rachpt.github.io/2019/03/22/notes-about-awstats/"/>
    <id>https://rachpt.github.io/2019/03/22/notes-about-awstats/</id>
    <published>2019-03-22T03:41:20.000Z</published>
    <updated>2019-09-23T03:41:03.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用awstata分析nginx以及vsftp日志。</p></blockquote><a id="more"></a><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>可以使用相应平台的包管理器安装，也可以直接到<a href="https://awstats.sourceforge.io/#DOWNLOAD" target="_blank" rel="noopener">官网</a>下载归档文件，解压其中的 <code>wwwroot</code>放到nginx的根目录，或者在nginx config文件设置alias，可以参考 <a href="https://wiki.archlinux.org/index.php/awstats" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/awstats</a> 或者<code>tools/nginx/awstats-nginx.conf</code>文件。</p><p>另外，需要 perl，这个系统一般都带有。</p><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>这部分比较复杂，可以使用配套的tools 里面的 <code>awstats_configure.pl</code> 交互式生成配置文件，也可以修改 <code>/etc/awstats/awstats.model.conf</code>，包管理器安装才有的。</p><p>我是用的 <code>pacman</code> 安装的，所以直接复制修改该model文件，将<code>model</code>改成自己的任务名，比如<code>web</code>或则<code>ftp</code>啥的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">LogFile=&quot;/var/log/nginx/access.log&quot;</span><br><span class="line"></span><br><span class="line">LogType=W # 默认 web模式</span><br><span class="line"></span><br><span class="line">LogFormat=1</span><br><span class="line"></span><br><span class="line">SiteDomain=&quot;web-server&quot; # 改成你想显示的</span><br><span class="line"></span><br><span class="line">AllowToUpdateStatsFromBrowser=0  # 是否可以通过网页更新，具体好坏里面有说明</span><br><span class="line"></span><br><span class="line">DirIcons=&quot;/awstatsicons&quot; # 如果你修改了该路径</span><br><span class="line"></span><br><span class="line">UseFramesWhenCGI=0  # 是否开启侧边栏，0 不开</span><br><span class="line"></span><br><span class="line">ShowFlagLinks=&quot;en cn tw de jp&quot; # 显示语言切换按钮</span><br><span class="line"></span><br><span class="line">Logo=&quot;awstats_logo1.png&quot;  # logo 图片</span><br><span class="line">LogoLink=&quot;/&quot;   # logo 链接</span><br></pre></td></tr></table></figure><p>上面是 nginx 日志的，对于 vsftp 只有一点区别，就是需要自己定义 <code>LogFormat</code>，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LogFile=&quot;/var/log/vsftpd.log&quot; # vsftp 需要打开对应的日志开关！！！</span><br><span class="line"></span><br><span class="line">LogType=F  # ftp 模式</span><br><span class="line"></span><br><span class="line">LogFormat=&quot;%time3 %other %host %bytesd %url %other %other %method %other %logname %other %code %other %other&quot;  # 这个需要和你的 vsftp log 文件列匹配。</span><br><span class="line"></span><br><span class="line"># 其他类似</span><br></pre></td></tr></table></figure><p>需要注意文件权限问题，比如 wwwroot里面的 需要chown http(你的 nginx 运行用户)，log文件需要有读权限，否则你需要使用 root 运行下面家要说的生成命令。</p><h1 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h1><p>需要使用 crontab (cronie) 定时运行更新命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e # 创建 root 用户的定时任务</span><br><span class="line"># 每个 1 小时运行一次</span><br><span class="line">7 */1 * * * /usr/share/awstats/tools/awstats_updateall.pl now -awstatsprog=/usr/share/webapps/awstats/awstats/awstats.pl &gt; /home/awstatus.log</span><br><span class="line"># 因为配置文件在 etc 里面，所以上面没有指明路径。</span><br></pre></td></tr></table></figure><p>因为我是用的是nginx alias 方式，所以 -awstatsprog 路径就是安装默认路径。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>效果展示:</p><p><a href="http://mirrors.hust.edu.cn/visitor/" target="_blank" rel="noopener">http://mirrors.hust.edu.cn/visitor/</a></p><p><a href="http://rachpt.iok.la/awstats/awstats.pl?config=nginx" target="_blank" rel="noopener">http://rachpt.iok.la/awstats/awstats.pl?config=nginx</a></p><p><a href="http://rachpt.iok.la/awstats/awstats.pl?config=vsftp" target="_blank" rel="noopener">http://rachpt.iok.la/awstats/awstats.pl?config=vsftp</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用awstata分析nginx以及vsftp日志。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="awstats" scheme="https://rachpt.github.io/tags/awstats/"/>
    
  </entry>
  
  <entry>
    <title>amazing-sed-on-Linux</title>
    <link href="https://rachpt.github.io/2019/03/22/amazing-sed-on-Linux/"/>
    <id>https://rachpt.github.io/2019/03/22/amazing-sed-on-Linux/</id>
    <published>2019-03-22T01:26:57.000Z</published>
    <updated>2019-09-23T03:40:05.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录一些少有用到的sed使用技巧。</p></blockquote><a id="more"></a><h1 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h1><p>sed 默认情况使用基本正则表达式(BRE)，也就是有些元字符需要使用转义<code>\</code>，加上 <code>-E</code>或则<code>-r</code>参数后即可变成扩展正则表达a(ERE)式情况。</p><p>grep 可以使用 <code>-i</code> 参数忽略大小写，而 sed 的 <code>-i</code> 参数表示直接修改源文件而不是输出到标准输出 stdout，在替换模式下也是可以使用参数忽略大小写的，就是在 表示全部(g)的位置放置i。<code>sed &#39;s/旧的东西/新的东西/ig&#39; filename</code>。<code>g</code> 全部，<code>i</code>大小写不敏感。</p><p>sed 可以使用行号，范围或则正则表达式限定和面代码的作用范围，如<code>sed -n &#39;1,3 p&#39; filename</code> 只打印1到3行，如果有多个命令，则使用<code>;</code>分隔，<code>{}</code>裹起来。<code>sed -n &#39;1, /匹配这个/ {s/old/new/;s%ba/ba%la/la%}&#39; filename</code>，对于这个，使用正则表达式限定下界，普通情况我们使用两个<code>/</code>将正则表达式裹起来，可以看到后面替换模式中我们使用<code>%</code>而不是通常的<code>/</code>作为分隔符，这对于字段中包含<code>/</code>的情况会相当友好，不用使用<code>\</code>转义。所以前面正则表达式限定的地方有没有可能使用自定义符号而不是<code>/</code>？<strong>匹配网站链接、路径</strong>时需要注意，特别使用使用了变量的情况！！！有两种方式解决：</p><pre><code>1. 使用`\`对所有匹配内容中的`/`转义，2. 使用`\`转义你自己的第一个限定符。</code></pre><p><code>sed &#39;/abc\/def/ {do something}&#39; filename</code>，<code>sed &#39;\=abc/def= {do something}&#39; filename</code>。效果如下：</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/sed-amazimg-1.jpg" alt="sed-amazimg-1.jpg"></p><h1 id="追加多行"><a href="#追加多行" class="headerlink" title="追加多行"></a>追加多行</h1><p>通常我们使用 <code>a</code> 加上我们需要添加的内容 最佳到指定位置。但是我们找遇到了如下错误：</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/sed-amazimg-2.jpg" alt="sed-amazimg-2.jpg"></p><p>使用<code>\n</code>来表示换行如何，</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/sed-amazimg-3.jpg" alt="sed-amazimg-3.jpg"></p><p>这次我们成功了。那么我们只需要将包含多行的一个变量将 不可见的换行辅 替换成字符<code>\n</code>即可追加这个多行变量到指定位置。那么如何将一个包含多行的变量变成一个使用符号<code>\n</code>分隔的单行变量？<br><code>mult_lines=&quot;$(echo &quot;$mult_lines&quot;|sed &#39;:a;N;s/\n/\\n/;ta;&#39;)&quot;</code>，注意双引号的使用。这里使用<code>a</code> 作为自定义标示符(label)用于跳转，<code>N</code>追加到模式空间，<code>s</code>就是我们熟悉的替换，注意<code>\\n</code>的使用。<code>t</code>仅当最后一个替换命令修改了模式空间时才跳转到标签。如果未指定label，则跳转到脚本的末尾，<a href="https://www.thegeekstuff.com/2009/12/unix-sed-tutorial-6-examples-for-sed-branching-operation/" target="_blank" rel="noopener">扩展阅读</a>。<br>还有一个细节需要提一下，就是<code>$()</code>中我们使用<code>\\n</code>，如果是使用<code>` ` </code> ，那么需要使用<code>\\\n</code>，<a href="https://github.com/rachpt/AutoSeed/blob/208aa23b2155d0b98999bdb38341ac23e65e8d58/get_desc/generate.sh#L66" target="_blank" rel="noopener">一个应用例子</a>。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>还没有…</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录一些少有用到的sed使用技巧。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="sed" scheme="https://rachpt.github.io/tags/sed/"/>
    
  </entry>
  
  <entry>
    <title>Trouble-with-automatic-mouse-copy-function-under-linux</title>
    <link href="https://rachpt.github.io/2019/02/22/Trouble-with-automatic-mouse-copy-function-under-linux/"/>
    <id>https://rachpt.github.io/2019/02/22/Trouble-with-automatic-mouse-copy-function-under-linux/</id>
    <published>2019-02-22T03:37:03.000Z</published>
    <updated>2019-09-23T03:39:49.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>突然选中文本就自动复制到粘贴板了，怎么回事？</p></blockquote><a id="more"></a><p>这几天又安装了 goldendict，配合 translate-shell 直接使用 goolgle 翻译文献。不知道怎么回事一时间 <code>Ctrl + C + C</code> 无法使用，各种折腾之后终于能用了。这不是重点，重点是现在突然发现我选中任意地方的文本后，就自动被复制到张贴板了，这对于浏览器操作及其不便。</p><p>关闭词典以及其屏幕取词也无效。<br>网上搜索一下，发现 linux 竟然有 选中复制/鼠标中建粘贴，以及 ctrl + c /ctrl + v 两种粘贴板，默认情况下两种粘贴板互相独立。因为我的某种操作让两种内容混在一起了。</p><p>粘贴板学问详情可以看 <a href="http://forum.ubuntu.org.cn/viewtopic.php?f=48&amp;t=279535" target="_blank" rel="noopener">http://forum.ubuntu.org.cn/viewtopic.php?f=48&amp;t=279535</a> 。</p><p>具体的误操作在该出<br><img src="https://raw.githubusercontent.com/rachpt/imgs/master/Trouble-with-automatic-mouse-copy-function-under-linux-1.jpg" alt="Trouble-with-automatic-mouse-copy-function-under-linux-1.jpg"></p><p>应该关闭<strong>同步剪切粘贴板和选中内容</strong>。</p><p>第一次知道还有选中复制这种功能。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;突然选中文本就自动复制到粘贴板了，怎么回事？&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="linux, clipboard" scheme="https://rachpt.github.io/tags/linux-clipboard/"/>
    
  </entry>
  
  <entry>
    <title>latex-beamer-note</title>
    <link href="https://rachpt.github.io/2019/01/16/latex-beamer-note/"/>
    <id>https://rachpt.github.io/2019/01/16/latex-beamer-note/</id>
    <published>2019-01-16T06:24:19.000Z</published>
    <updated>2019-09-23T03:40:44.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录一些使用 LaTeX beamer 的技巧。</p></blockquote><a id="more"></a><h1 id="图片显示编号以及不显示编号"><a href="#图片显示编号以及不显示编号" class="headerlink" title="图片显示编号以及不显示编号"></a>图片显示编号以及不显示编号</h1><p>大部分模板图片都不会编号，只需在导言区加上如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\setbeamertemplate&#123;caption&#125;[numbered]</span><br></pre></td></tr></table></figure><p>即可显示图片编号。<br><a href="https://yihui.name/cn/2010/08/show-caption-numbers-in-beamer/" target="_blank" rel="noopener">参考文档</a>。</p><p>自定义编号，使用caption 宏包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\usepackage&#123;caption&#125;</span><br></pre></td></tr></table></figure><p>标签使用 <code>\caption*{}</code>。<br><a href="https://blog.csdn.net/ProgramChangesWorld/article/details/51553683" target="_blank" rel="noopener">参考文档</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录一些使用 LaTeX beamer 的技巧。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="latex" scheme="https://rachpt.github.io/categories/latex/"/>
    
    
      <category term="beamer" scheme="https://rachpt.github.io/tags/beamer/"/>
    
  </entry>
  
  <entry>
    <title>install-matlab-on-archlinux</title>
    <link href="https://rachpt.github.io/2018/12/31/install-matlab-on-archlinux/"/>
    <id>https://rachpt.github.io/2018/12/31/install-matlab-on-archlinux/</id>
    <published>2018-12-31T09:50:22.000Z</published>
    <updated>2019-09-23T03:40:42.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>由于archlinux 并不在matlab 官方支持的系统之列，之前使用不完整的matlab(无法使用实时脚本，帮助页面显示不正常)，一直觉得理所当然，居然是有解决办法的。</p></blockquote><a id="more"></a><h1 id="linux-上安装-matlab"><a href="#linux-上安装-matlab" class="headerlink" title="linux 上安装 matlab"></a>linux 上安装 matlab</h1><p>不同于windows，在linux安装iso封装的软件可能需要使用命令(mount)挂载先，然后运行安装程序，后面就是熟悉的点点点了。大体步骤如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/matlab</span><br><span class="line"></span><br><span class="line">sudo mount  -o loop /mnt/data/MATLAB_R2018b_Linux/R2018b_glnxa64_dvd1.iso  /tmp/matlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新开一个 terminal</span></span><br><span class="line"><span class="comment"># 使用普通账户运行！</span></span><br><span class="line">sudo /tmp/matlab/install  <span class="comment"># 如果安装到自己的家目录，不需要使用 sudo。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 后面会弹出一个安装界面，</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若全部安装，50% 时提示弹出 dvd1 插入 dvd2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 df 查看挂在的所有设备</span></span><br><span class="line">sudo umount -f /dev/loop0  <span class="comment"># 如果提示设备忙，可以稍微等几分钟，再试。</span></span><br><span class="line"></span><br><span class="line">sudo mount  -o loop /mnt/data/MATLAB_R2018b_Linux/R2018b_glnxa64_dvd2.iso  /tmp/matlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击安装界面的继续</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后  umount ，以及 rmdir /tmp/matlab</span></span><br></pre></td></tr></table></figure><p> 和windows的安装一样(挂载相同的盘符)，dvd2 的挂载点(路径)应与dvd1 一致。理论上相当于将两dvd解压到一个文件夹(挂载相当于允许你分两次解压)。</p><h1 id="matlab-支持的系统"><a href="#matlab-支持的系统" class="headerlink" title="matlab 支持的系统"></a>matlab 支持的系统</h1><p>如下图：<br><img src="https://raw.githubusercontent.com/rachpt/imgs/master/install-matlab-on-archlinux-1.jpg" alt="install-matlab-on-archlinux-1.jpg"></p><p><a href="https://ww2.mathworks.cn/support/sysreq.html" target="_blank" rel="noopener">https://ww2.mathworks.cn/support/sysreq.html</a></p><p>并没有 archlinux。archlinux wiki上如是说：<br><img src="https://raw.githubusercontent.com/rachpt/imgs/master/install-matlab-on-archlinux-2.jpg" alt="install-matlab-on-archlinux-2.jpg"></p><p><a href="https://wiki.archlinux.org/index.php/MATLAB" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/MATLAB</a></p><p>所以但我安装后遇到 matlab 无法使用试试脚本以及帮助文档不正常时，以为这就是不支持的代价。</p><p>我甚至已经使用systemd-nspawn 构建 ubuntu容器运行 matlab，但是容器中的matlab仍然有如上问题。<br>同样的matlab 版本，我在 ubuntu 系的linux上安装所有功能均表现正常。这甚至逼迫我更换系统发行版。</p><p>无意中发现通过下面的办法是可以解决archlinux 中matlab 部分功能受限的问题。</p><h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><ol><li>通过 dvd 安装好matlab 2018b后，</li><li>使用<code>yaourt matlab-r2017b</code> (这个时候最高只有2017b)安装依赖。<br>推荐使用 yay，yaourt已经没有继续维护了，现在(2019.7)已经有 matlab-r2018b了。</li><li>构建肯定是会失败的，但是依赖会被安装。</li></ol><p>也可以自己安装 如下图片中所示的依赖，使用 yaourt 比较省事。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/install-matlab-on-archlinux-3.jpg" alt="install-matlab-on-archlinux-3.jpg"></p><p>下面是matlab安装依赖前的报错情况。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/install-matlab-on-archlinux-4.jpg" alt="install-matlab-on-archlinux-4.jpg"></p><p>实时脚本、帮助文档正常图。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/install-matlab-on-archlinux-5.jpg" alt="install-matlab-on-archlinux-5.jpg"></p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>通过最近频繁更换linux 发行版，得出的结论就是，home 和系统分开，大软件安装到 home下user 外面，比如 matlab comsol crossover pycharm anaconda 等。</p><p>.desktop 文件使用绝对路径，添加到 ~/.local/share/applications/ 里面。<br>下面是我的 matlab.desktop。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry] </span><br><span class="line">Categories=Application;Development;</span><br><span class="line">Comment=Scientific computing environment</span><br><span class="line">Encoding=UTF-8</span><br><span class="line">Exec=/home/program/MATLAB/R2018b/bin/matlab -desktop</span><br><span class="line">Icon=/home/program/MATLAB/R2018b/toolbox/shared/dastudio/resources/MatlabIcon.png</span><br><span class="line">Name=MATLAB R2018b</span><br><span class="line">StartupNotify=<span class="literal">true</span> </span><br><span class="line">Terminal=<span class="literal">false</span></span><br><span class="line">Type=Application</span><br></pre></td></tr></table></figure><p>如果 命令行窗口 出现方块，只需要修改使用的字体以显示中文字符。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;由于archlinux 并不在matlab 官方支持的系统之列，之前使用不完整的matlab(无法使用实时脚本，帮助页面显示不正常)，一直觉得理所当然，居然是有解决办法的。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="matlab" scheme="https://rachpt.github.io/tags/matlab/"/>
    
  </entry>
  
  <entry>
    <title>something-difference-from-manjaro-back-to-ubuntu</title>
    <link href="https://rachpt.github.io/2018/12/18/something-difference-from-manjaro-back-to-ubuntu/"/>
    <id>https://rachpt.github.io/2018/12/18/something-difference-from-manjaro-back-to-ubuntu/</id>
    <published>2018-12-18T07:03:54.000Z</published>
    <updated>2019-09-23T03:41:43.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>qprop无法在软件较新的manjaro上编译运行，matlab实时脚本、帮助文档在arch-linux上有问题，mj更新系统很大概率遇到装不上。这三点因素使我做出再次更换系统的决定。</p></blockquote><a id="more"></a><h1 id="适合自己的linux发行版"><a href="#适合自己的linux发行版" class="headerlink" title="适合自己的linux发行版"></a>适合自己的linux发行版</h1><p>到目前为止，我已经完全使用linux系统一年了，所谓完全就是作为主力机器，能不用Windows坚决不用Windows。在这之前自认为对Windows的使用有一些自己的见解，对于配置出适合自己的Windows工作环境非常熟悉。清晰的知道Windows所不能给我提供的功能(或者实现困难)，我尝试过使用 ubuntu 以及ubuntu麒麟(大概14年，那时候原生的ubuntu配置中文比较费劲)，当时啥都不会，没多久就回到Windows10预览版了(那时候Windows8的开始屏可恶心死我了)，后面有试过几次，都没能领会到linux的精髓。</p><p>去年的大约这个时候，由于当时有一台闲置的pc用于 web 服务器，刚开始用的 Windows10，由于Windows总是自己坏掉，于是试了 Windows server 2016，稳定运行15天后再次死机，再加上当时我们需要连接超级计算机提交计算任务，于是了解了部分linux的脚本命令等，有理由相信我已经可以驾驭(使用)linux了，于是安装了ubuntu 16.04lts 到那台闲置的机器上。经过各种配置后，相当稳定，连续正常运行 93 天(后来需要升级系统才关机的)，在了解到各种软件的linux情况后，果断将工作电脑安装上 linux。</p><p>使用过好几个桌面系统，debian 系的、redhat 系的，最后选择了 linux mint，因为界面很适合从Windows转过来的用户，ubuntu的核心让我能够在网上找到较多的教程。用的相当舒适。直到后来从 18.3 升级到 19，有道词典用不了了(看文献屏幕取词翻译)。</p><p>我也试过回到就得 18.3，但是当时因为 python 的几个库的依赖相互冲突解决不了(可能是 3.5太老了，加上用过新的界面就回不去了)，最后我强行升级系统python直接将系统弄死了。</p><p>rpm的包看着好不友好，还有个莫名其妙的 iptable，对于我来说往往全全就是阻碍，centos 难用到死的 gnome桌面我打死不会再试，suse 由于当时试的 kde 版本，各种快捷键都不一样，最后被定义为难用。</p><p>先在笔记本装了 manjaro 的 cinnamon版本，一直也没啥问题。体验几乎和 mint 一致。<br>最后将 开机 没有任何窗口的mint 18.3 替换成manjaro kde版，毕竟ked试manjaro官方维护的，可能会好一些。</p><p>经过短暂而痛苦的学习习惯kde桌面后，配置后喜爱的工作环境，还行。</p><p>不知道什么原因，TensorFlow本来一条命令轻轻松松搞定，然而费了吃奶的力气才装上，MATLAB的安装更是气，先后试了 2017a 2018a 2018b，中午乱码，无法创建实时脚本，帮助页面显示有问题。忍着用！还有最近好几次遇到升级时提示 python的xxx已经存在，无法升级系统，长久考虑，以后可能会出大问题。</p><p>加上最近导师想要使用 <a href="https://github.com/jam31118/rigged-qprop" target="_blank" rel="noopener">qprop</a> 计算东西，刚开始怎么都编译不了，后面编译好后运行有问题。但是在个导师新装的 ubuntu 上编译后可以运行。</p><p>在虚拟机中测试 kubuntu 可以编译运行。于是重装系统至 kubuntu。</p><h1 id="matlab"><a href="#matlab" class="headerlink" title="matlab"></a>matlab</h1><p>刚开始时 实时脚本帮助文档都没问题，但是更换为原来的 home 后，又有问题了。<br>删除 ~/.matlab 后一切正常！</p><h1 id="搜狗乱码"><a href="#搜狗乱码" class="headerlink" title="搜狗乱码"></a>搜狗乱码</h1><p>貌似不需要 archlinux 的在 .xinputrc 里面加东西，其他<a href="https://blog.csdn.net/oncealong/article/details/79328930" target="_blank" rel="noopener">参考这里</a>。</p><h1 id="使用原home"><a href="#使用原home" class="headerlink" title="使用原home"></a>使用原home</h1><p>使用 fstab 挂载原来的 home，体验很糟糕，文件管理器中文乱码，全新配置不会。</p><p>使用 cp -axv /old/home/xxconf /new/home/dir 还原 .mozilla 等软件数据。</p><p>待续…</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;qprop无法在软件较新的manjaro上编译运行，matlab实时脚本、帮助文档在arch-linux上有问题，mj更新系统很大概率遇到装不上。这三点因素使我做出再次更换系统的决定。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="linux, ubuntu" scheme="https://rachpt.github.io/tags/linux-ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>dual-disk-install-dual-system</title>
    <link href="https://rachpt.github.io/2018/12/10/dual-disk-install-dual-system/"/>
    <id>https://rachpt.github.io/2018/12/10/dual-disk-install-dual-system/</id>
    <published>2018-12-10T06:46:25.000Z</published>
    <updated>2019-09-23T03:40:26.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>双 11 花了110元买了块 mstata 固态硬盘，完成多年的愿望。这里记录一下双硬盘独立安装 windows 和 Linux 系统。</p></blockquote><a id="more"></a><h1 id="现在的情况"><a href="#现在的情况" class="headerlink" title="现在的情况"></a>现在的情况</h1><p>一般网上都是单一硬盘安装双系统的，不管是 legacy 或是 uefi，双系统的引导文件都在一块硬盘里面，所以最多就是通过软件修复一下例外一个系统的引导即可。<br>现在的情况是两块固态硬盘，大小一样 120G，需要将 windows 安装到其中一块，而 Linux 安装到另外一块，并且希望在开机的时候提供一个友好的选择系统的界面。</p><p>比较容易实现的是，两块硬盘按照正常步骤分别安装到两硬盘，开机的时候 狂按 F12 (或者其他) 进入 boot manger 选择不同启动硬盘，就能进入不同的系统。但是操作很是不友好。</p><h1 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h1><p>win7 不支持 uefi + GPT 模式启动，只能使用传统的 legacy Bios + MBR 模式启动，缺点很明显，硬盘上线2.2T，启动速度也相对慢，多了 Bios 自检过程。<br><a href="https://zhuanlan.zhihu.com/p/36976698" target="_blank" rel="noopener">更多请看这里</a>，<a href="https://blog.csdn.net/u014712482/article/details/80686387" target="_blank" rel="noopener">或者这里</a>。</p><p>刚开始的时候，我的唯一的硬盘上面安装的是 manjaro Linux，加装硬盘后，我使用常规方法安装了 windows 10，然后我将 windows 盘作为默认启动硬盘，使用 easyBSD 创建 Linux 的引导，失败告终，windows 不能切换 Linux，只能改启动应到盘。</p><p>就在要绝望的时候，有人说 Fedora 可以双硬盘安装并解决双系统引导问题。于是开始准别全部重装。</p><h1 id="重装系统"><a href="#重装系统" class="headerlink" title="重装系统"></a>重装系统</h1><p>能用 uefi 的机器我当然不会使用 legacy 啦。</p><p>首先安装 windows 到 windows 认为的 disk 0，后来发现这个可有可无。<br>有几点需要注意，修改 windows 安装程序 默认的 efi 100m 的设置，因为我们想把 linux 的 efi 挂载到 windows 的 efi 分区。<br>时候证明，这一步可能不需要(在linux下看到 efi 使用量 35 m)。</p><p>系统版本选择界面后，按<code>Shift+F10</code>调出命令提示符，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">diskpart</span><br><span class="line">list disk</span><br><span class="line">select disk 0</span><br><span class="line">clean</span><br><span class="line">convert gpt</span><br><span class="line">create partition efi size=800</span><br><span class="line">create partition primary size=102400</span><br></pre></td></tr></table></figure><p>自定义 efi 分区大小， 其实 500m 可能就够了，保险起见，设了 800m。</p><p><a href="https://www.ithome.com/html/win10/224908.htm" target="_blank" rel="noopener">具体情况这个参考文档</a>。</p><p><strong>第一次</strong>尝试安装 Fedora cinnamon 版本，一切照旧，我只是选择了 安装到另外空的硬盘，分区使用自动。<br>装好后，自动将 Linux 盘作为了默认引导硬盘，greb 页面出了 Fedora 外还有 windows 的启动项，一切如愿。当然选择 windows 所在硬盘为默认引导盘 自然无法进入 Linux。</p><p>本来就此结束，但是那个引导界面实在是太丑了，还有 Fedora 用不习惯。</p><p>于是开始<strong>第二次</strong>尝试。<br>Linux 版本是 manjaro KDE 版本，windows 还是之前的不变，只是格式化 Fedora 的盘。<br>安装的时候 自己设置分区以及挂载点。<br>windows 的(/dev/sda) efi 分区挂载到 /boot/efi，不格式化， /dev/sdb 上8 G linuxswap，其余全部ext4 挂载点 / 。</p><p>装完后 一切和 Fedora 一致，引导界面漂亮了很多，很现代，还能记住上一次使用的引导选项。</p><p>在 linux 下可以看到 efi 里面有 windows 的引导文件夹。</p><p>有可能在windows下使用 efi 引导修复工具可以将 Linux 引导选项加入到 windows 引导列表里面，这样每个硬盘都能引导双系统(未测试)。</p><p><img src="https://raw.githubusercontent.com/rachpt/imgs/master/dual-disk-install-dual-system-1.jpg" alt="dual-disk-install-dual-system-1.jpg">。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;双 11 花了110元买了块 mstata 固态硬盘，完成多年的愿望。这里记录一下双硬盘独立安装 windows 和 Linux 系统。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://rachpt.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://rachpt.github.io/tags/linux/"/>
    
      <category term="windows" scheme="https://rachpt.github.io/tags/windows/"/>
    
  </entry>
  
</feed>
