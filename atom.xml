<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rachpt&#39;s Blog</title>
  
  <subtitle>时间总是追不上</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://rachpt.me/"/>
  <updated>2018-12-11T13:05:32.179Z</updated>
  <id>http://rachpt.me/</id>
  
  <author>
    <name>rachpt</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>dual-disk-install-dual-system</title>
    <link href="http://rachpt.me/2018/12/10/dual-disk-install-dual-system/"/>
    <id>http://rachpt.me/2018/12/10/dual-disk-install-dual-system/</id>
    <published>2018-12-10T06:46:25.000Z</published>
    <updated>2018-12-11T13:05:32.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>双 11 花了110元买了块 mstata 固态硬盘，完成多年的愿望。这里记录一下双硬盘独立安装 windows 和 Linux 系统。</p></blockquote><a id="more"></a><h1 id="现在的情况"><a href="#现在的情况" class="headerlink" title="现在的情况"></a>现在的情况</h1><p>一般网上都是单一硬盘安装双系统的，不管是 legacy 或是 uefi，双系统的引导文件都在一块硬盘里面，所以最多就是通过软件修复一下例外一个系统的引导即可。<br>现在的情况是两块固态硬盘，大小一样 120G，需要将 windows 安装到其中一块，而 Linux 安装到另外一块，并且希望在开机的时候提供一个友好的选择系统的界面。</p><p>比较容易实现的是，两块硬盘按照正常步骤分别安装到两硬盘，开机的时候 狂按 F12 (或者其他) 进入 boot manger 选择不同启动硬盘，就能进入不同的系统。但是操作很是不友好。</p><h1 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h1><p>win7 不支持 uefi + GPT 模式启动，只能使用传统的 legacy Bios + MBR 模式启动，缺点很明显，硬盘上线2.2T，启动速度也相对慢，多了 Bios 自检过程。<br><a href="https://zhuanlan.zhihu.com/p/36976698" target="_blank" rel="noopener">更多请看这里</a>，<a href="https://blog.csdn.net/u014712482/article/details/80686387" target="_blank" rel="noopener">或者这里</a>。</p><p>刚开始的时候，我的唯一的硬盘上面安装的是 manjaro Linux，加装硬盘后，我使用常规方法安装了 windows 10，然后我将 windows 盘作为默认启动硬盘，使用 easyBSD 创建 Linux 的引导，失败告终，windows 不能切换 Linux，只能改启动应到盘。</p><p>就在要绝望的时候，有人说 Fedora 可以双硬盘安装并解决双系统引导问题。于是开始准别全部重装。</p><h1 id="重装系统"><a href="#重装系统" class="headerlink" title="重装系统"></a>重装系统</h1><p>能用 uefi 的机器我当然不会使用 legacy 啦。</p><p>首先安装 windows 到 windows 认为的 disk 0，后来发现这个可有可无。<br>有几点需要注意，修改 windows 安装程序 默认的 efi 100m 的设置，因为我们想把 linux 的 efi 挂载到 windows 的 efi 分区。<br>时候证明，这一步可能不需要(在linux下看到 efi 使用量 35 m)。</p><p>系统版本选择界面后，按<code>Shift+F10</code>调出命令提示符，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">diskpart</span><br><span class="line">list disk</span><br><span class="line">select disk 0</span><br><span class="line">clean</span><br><span class="line">convert gpt</span><br><span class="line">create partition efi size=800</span><br><span class="line">create partition primary size=102400</span><br></pre></td></tr></table></figure><p>自定义 efi 分区大小， 其实 500m 可能就够了，保险起见，设了 800m。</p><p><a href="https://www.ithome.com/html/win10/224908.htm" target="_blank" rel="noopener">具体情况这个参考文档</a>。</p><p><strong>第一次</strong>尝试安装 Fedora cinnamon 版本，一切照旧，我只是选择了 安装到另外空的硬盘，分区使用自动。<br>装好后，自动将 Linux 盘作为了默认引导硬盘，greb 页面出了 Fedora 外还有 windows 的启动项，一切如愿。当然选择 windows 所在硬盘为默认引导盘 自然无法进入 Linux。</p><p>本来就此结束，但是那个引导界面实在是太丑了，还有 Fedora 用不习惯。</p><p>于是开始<strong>第二次</strong>尝试。<br>Linux 版本是 manjaro KDE 版本，windows 还是之前的不变，只是格式化 Fedora 的盘。<br>安装的时候 自己设置分区以及挂载点。<br>windows 的(/dev/sda) efi 分区挂载到 /boot/efi，不格式化， /dev/sdb 上8 G linuxswap，其余全部ext4 挂载点 / 。</p><p>装完后 一切和 Fedora 一致，引导界面漂亮了很多，很现代，还能记住上一次使用的引导选项。</p><p>在 linux 下可以看到 efi 里面有 windows 的引导文件夹。</p><p>有可能在windows下使用 efi 引导修复工具可以将 Linux 引导选项加入到 windows 引导列表里面，这样每个硬盘都能引导双系统(未测试)。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fy33x044fyj21400u0b2d.jpg" alt="">。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;双 11 花了110元买了块 mstata 固态硬盘，完成多年的愿望。这里记录一下双硬盘独立安装 windows 和 Linux 系统。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="linux, windows" scheme="http://rachpt.me/tags/linux-windows/"/>
    
  </entry>
  
  <entry>
    <title>change-to-use-archlinux</title>
    <link href="http://rachpt.me/2018/12/01/change-to-use-archlinux/"/>
    <id>http://rachpt.me/2018/12/01/change-to-use-archlinux/</id>
    <published>2018-12-01T12:59:54.000Z</published>
    <updated>2018-12-01T13:30:09.591Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>因为python版本的原因，从linuxmint 19 换回mint18.3，最后尝试使用基于archlinux的manjaro。这里记录几个刚开始比较头疼的问题。</p></blockquote><a id="more"></a><h1 id="KED"><a href="#KED" class="headerlink" title="KED"></a>KED</h1><p>之前习惯了类windows的cinnamon，也想过直接使用manjaro的cinnamon版本，但是考虑到 mint19 上比较容易出现的xwindow卡死，于是决定尝试使用manjaro官方支持的kde版本，之前体验过一小段时间，当时感觉是初始设置反人类，设置麻烦。<br>经过一两周的使用，现在基本上能把kde配置成方便自己习惯了。</p><ol><li>文件双击打开，</li><li>桌面显示desktop文件夹内容，</li><li>任务栏调成类 windows，</li><li>开机自动启用小键盘，</li><li>安装 tim，kde connect配合安卓手机太棒了！<br>…</li></ol><h1 id="Tinyproxy"><a href="#Tinyproxy" class="headerlink" title="Tinyproxy"></a>Tinyproxy</h1><p>安装好后啥配置对没改，使用 systemctl 启动不了，提示啥 <code>/run/tinyproxy/tinyproxy.pid</code> 无法创建。</p><p>解决办法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PidFile: Write the PID of the main tinyproxy thread to this file so it</span></span><br><span class="line"><span class="comment"># can be used for signalling purposes.</span></span><br><span class="line"><span class="comment"># If not specified, no pidfile will be written.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#PidFile "/run/tinyproxy/tinyproxy.pid"</span></span><br></pre></td></tr></table></figure></p><p>取消 <code>/etc/tinyproxy/tinyproxy.conf</code> 如上的注释行。<br><a href="https://github.com/StreisandEffect/streisand/issues/1381" target="_blank" rel="noopener">参考文档</a>。</p><h1 id="vsftpd"><a href="#vsftpd" class="headerlink" title="vsftpd"></a>vsftpd</h1><p>vsftpd 的匿名模式路径一片空白，使用shell的ftp也连接不了。<br>解决办法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd.conf</span><br><span class="line"><span class="comment"># 添加下面一行</span></span><br><span class="line">seccomp_sandbox=NO</span><br></pre></td></tr></table></figure></p><p><a href="https://wiki.archlinux.org/index.php/Very_Secure_FTP_Daemon" target="_blank" rel="noopener">参考文档</a>。</p><p>例外，vsftpd 不支持使用 ln -s 软连接，使用 mount –band /old /new 可解。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 /etc/fstab 中添加如下行，以便开机自动bind。</span></span><br><span class="line">/mnt/data/pub                             /srv/ftp/pub       none  <span class="built_in">bind</span>    0 0</span><br></pre></td></tr></table></figure></p><h1 id="swapfie"><a href="#swapfie" class="headerlink" title="swapfie"></a>swapfie</h1><p>使用<code>sudo fallocate -l 20G /swapfile</code> 快速创建大体积swapfile 文件。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo fallocate -l 20G /swapfile</span><br><span class="line"><span class="comment"># 为了安全</span></span><br><span class="line">sudo chown root:root /swapfile</span><br><span class="line"></span><br><span class="line">sudo chmod 0600 /swapfile</span><br><span class="line"></span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line"><span class="comment"># 开</span></span><br><span class="line">sudo swapon /swapfile</span><br><span class="line"><span class="comment"># 关</span></span><br><span class="line">sudo swapoff /swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加开机自动挂载</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line">/swapfile      none       swap    sw 0 0</span><br></pre></td></tr></table></figure></p><p>/etc/fstab 会在启动的时候执行. 若文件有误那么会启动失败！！！</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;因为python版本的原因，从linuxmint 19 换回mint18.3，最后尝试使用基于archlinux的manjaro。这里记录几个刚开始比较头疼的问题。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://rachpt.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>an-error-in-mpv-player</title>
    <link href="http://rachpt.me/2018/10/28/an-error-in-mpv-player/"/>
    <id>http://rachpt.me/2018/10/28/an-error-in-mpv-player/</id>
    <published>2018-10-28T08:29:17.000Z</published>
    <updated>2018-10-28T08:37:38.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近 mpv 突然打不开，终端运行提示 libtalloc 版本有问题。</p></blockquote><a id="more"></a><p>使用终端运行错误提示如下，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mpv  </span><br><span class="line">mpv: relocation error: /usr/lib/x86_64-linux-gnu/libldb.so.1: symbol talloc_strdup_append_buffer version TALLOC_2.0.2 not defined <span class="keyword">in</span> file libtalloc.so.2 with link time reference</span><br></pre></td></tr></table></figure><p>百度一番，有类似的问题的解决记录。</p><p><a href="http://blog.chinaunix.net/uid-27057175-id-5747280.html" target="_blank" rel="noopener">文档1</a>，<a href="https://answers.launchpad.net/ubuntu/+question/291448" target="_blank" rel="noopener">文档2</a>.</p><p>经比较，应该是 libtalloc 有问题。</p><p>解决：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install --reinstall libtevent0 libtalloc2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可能只要最后的 libtalloc2 即可</span></span><br></pre></td></tr></table></figure><p>小记。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;最近 mpv 突然打不开，终端运行提示 libtalloc 版本有问题。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://rachpt.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>change-the-resolution-of-the-console</title>
    <link href="http://rachpt.me/2018/09/20/change-the-resolution-of-the-console/"/>
    <id>http://rachpt.me/2018/09/20/change-the-resolution-of-the-console/</id>
    <published>2018-09-20T12:52:51.000Z</published>
    <updated>2018-09-26T03:09:02.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>周末花了一个下午搞定了 Linux 字符界面分辨率与中文环境。</p></blockquote><a id="more"></a><h1 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h1><p>一般有图形界面的 Linux 发行版通过 <code>Ctrl + Alt + F[1-6]</code> 进入(切换)到字符界面(控制台 字符哑终端) console.<code>C + A + F7</code> 返回 x-window。</p><p>临时切换至字符界面能过在不影响后台计算进程的前提下处理轻量文本任务、查看系统状态等操作。</p><p>但是有两个问题，一是分辨率，二是中文支持。</p><h1 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h1><p>由于之前图方便，直接使用的 VGA 接口，字符界面分辨率特别难受，后来查看才得知 1080p 的显示器一直使用的 800x600 分辨率模式，各种模糊、显示不清，甚至让我怀疑 linux 版本的问题。Google 百度来来回回一个下午找到一些修改 vga 模式下分辨率的方法。</p><p>对于 ubuntu / Linux mint，修改 grub 配置文件 <code>/etc/default/grub</code>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加</span></span><br><span class="line">GRUB_GFXMODE=1600x1200x32</span><br><span class="line">GRUB_GFXPAYLOAD_LINUX=keep</span><br></pre></td></tr></table></figure><p>之前一直坑在这里面，就是自以为 分辨率以及 色深自己根据显示器随便写就是。<br>后面才发现需要在开机选择引导时，按 <code>c</code> 进入 grub 界面，使用 <code>vbeinfo</code> 查看系统支持的分辨率和色深。</p><p>写非法的分辨率以及色深会导致 console 进不去。</p><p>鉴于 vga 模式下的分辨率没有和显示器匹配的。于是不得不改用 DVI接口，渣渣显卡没有 HDMI 接口，否则就不存在这些问题。</p><p>dvi 可以粗略理解为 HDMI 接口的缩水版，dvi 和 HDMI 接口都是数字信号传输的，直接匹配显示器分辨率。</p><p><strong>所以最终的解决办法是 使用 DVI/HDMI 接口代替 VGA 接口</strong></p><h1 id="中文"><a href="#中文" class="headerlink" title="中文"></a>中文</h1><ol><li><p>使用英文作为系统语言，添加中文支持，这样欢迎等信息都是英文。</p></li><li><p>安装 <code>sudo apt install zhcon</code></p></li></ol><p>使用 <code>zhcon --utf8</code> 进入中文环境。</p><h1 id="鼠标"><a href="#鼠标" class="headerlink" title="鼠标"></a>鼠标</h1><p>使用 <code>GPM</code> 实现.<br>安装:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gpm</span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> gpm.service</span><br><span class="line"></span><br><span class="line">sudo systemctl start gpm.service</span><br><span class="line"></span><br><span class="line">sudo systemctl status gpm.service</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;周末花了一个下午搞定了 Linux 字符界面分辨率与中文环境。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="console" scheme="http://rachpt.me/tags/console/"/>
    
  </entry>
  
  <entry>
    <title>vim-set-working-directory-to-the-current-file</title>
    <link href="http://rachpt.me/2018/08/22/vim-set-working-directory-to-the-current-file/"/>
    <id>http://rachpt.me/2018/08/22/vim-set-working-directory-to-the-current-file/</id>
    <published>2018-08-22T01:47:54.000Z</published>
    <updated>2018-08-22T02:12:38.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>vim自动进入打开文件所在目录,原谅我无耻地 copy。</p></blockquote><a id="more"></a><p>如果装了插件 NERDTree，使用 <code>:NERDTreeFind</code> 可以扩展到打开文件所在目录。不自动有点麻烦。</p><p>百度了一圈，找到的答案是使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;在.vimrc 中加入</span><br><span class="line">execute &quot;cd&quot; expand(&quot;%:h&quot;)</span><br></pre></td></tr></table></figure><p>缺点是如果目录路径中有特殊字符可能报错。比如：<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1fui8tvgh0ej20pp0avdhk.jpg" alt=""></p><p>使用 Google 查找关键词 <code>vimrc execute cd expand</code>，找到 vim 官方解决办法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set autochdir</span><br><span class="line"></span><br><span class="line">autocmd BufEnter * silent! lcd %:p:h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">autocmd BufEnter * if expand(&quot;%:p:h&quot;) !~ &apos;^/tmp&apos; | silent! lcd %:p:h | endif</span><br></pre></td></tr></table></figure><p>第一种，可能和某些插件有冲突，本人测试刚才有特殊字符的文件正常。<br>后面两个兼容性更好，最后一个加了判断，<code>/tmp</code> 中的文件不切换到改路径去。此法最好。</p><p>参考<a href="https://www.douban.com/note/543140992/" target="_blank" rel="noopener">文档1</a>，<a href="http://vim.wikia.com/wiki/Set_working_directory_to_the_current_file" target="_blank" rel="noopener">文档2-wiki</a>.</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;vim自动进入打开文件所在目录,原谅我无耻地 copy。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="vim" scheme="http://rachpt.me/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>service-systemctl-and-daemon</title>
    <link href="http://rachpt.me/2018/07/28/service-systemctl-and-daemon/"/>
    <id>http://rachpt.me/2018/07/28/service-systemctl-and-daemon/</id>
    <published>2018-07-27T16:43:38.000Z</published>
    <updated>2018-07-28T05:33:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>前面说到了使用原码编译 <code>transmission-daemon</code> <code>qbittorrent-nox</code> <code>nginx</code> ，但是需要自己配置启动脚本。</p></blockquote><a id="more"></a><h1 id="transmission-daemon"><a href="#transmission-daemon" class="headerlink" title="transmission-daemon"></a>transmission-daemon</h1><p>之前使用 apt 安装的 tr-d ，虽然很容易可以使用 <code>sudo systemctl enable|start|stop|status transmission-daemon</code>，但是不得不忍受一个很长很傻的运行用户名，而且修改起来特别麻烦，文件权限也是乱的很。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/init.d/transmission-daemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加下面的脚本，并给执行权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          transmission-daemon</span></span><br><span class="line"><span class="comment"># Required-Start:    $local_fs $remote_fs $network</span></span><br><span class="line"><span class="comment"># Required-Stop:     $local_fs $remote_fs $network</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: Start or stop the transmission-daemon.</span></span><br><span class="line"><span class="comment"># Description:       Enable service provided by transmission-daemon.</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line">NAME=transmission-daemon</span><br><span class="line">DAEMON=/usr/bin/<span class="variable">$NAME</span></span><br><span class="line">USER=rachpt</span><br><span class="line">STOP_TIMEOUT=30</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$&#123;PATH:+$PATH:&#125;</span>/sbin"</span></span><br><span class="line"></span><br><span class="line">[ -x <span class="variable">$DAEMON</span> ] || <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">[ -e /etc/default/<span class="variable">$NAME</span> ] &amp;&amp; . /etc/default/<span class="variable">$NAME</span></span><br><span class="line"></span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_daemon</span></span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$ENABLE_DAEMON</span> != 1 ]; <span class="keyword">then</span></span><br><span class="line">        log_progress_msg <span class="string">"(disabled)"</span></span><br><span class="line">    log_end_msg 255 || <span class="literal">true</span></span><br><span class="line">    <span class="keyword">else</span>    </span><br><span class="line">        start-stop-daemon --start \</span><br><span class="line">        --chuid <span class="variable">$USER</span> \</span><br><span class="line"><span class="variable">$START_STOP_OPTIONS</span> \</span><br><span class="line">        --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> -- <span class="variable">$OPTIONS</span> || log_end_msg $?</span><br><span class="line">log_end_msg 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        log_daemon_msg <span class="string">"Starting bittorrent daemon"</span> <span class="string">"<span class="variable">$NAME</span>"</span></span><br><span class="line">        start_daemon</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        log_daemon_msg <span class="string">"Stopping bittorrent daemon"</span> <span class="string">"<span class="variable">$NAME</span>"</span></span><br><span class="line">        start-stop-daemon --stop --quiet \</span><br><span class="line">            --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> --retry <span class="variable">$STOP_TIMEOUT</span> \</span><br><span class="line">            --oknodo || log_end_msg $?</span><br><span class="line">        log_end_msg 0</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        log_daemon_msg <span class="string">"Reloading bittorrent daemon"</span> <span class="string">"<span class="variable">$NAME</span>"</span></span><br><span class="line">        start-stop-daemon --stop --quiet \</span><br><span class="line">            --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> \</span><br><span class="line">            --oknodo --signal 1 || log_end_msg $?</span><br><span class="line">        log_end_msg 0</span><br><span class="line">        ;;</span><br><span class="line">    restart|force-reload)</span><br><span class="line">        log_daemon_msg <span class="string">"Restarting bittorrent daemon"</span> <span class="string">"<span class="variable">$NAME</span>"</span></span><br><span class="line">        start-stop-daemon --stop --quiet \</span><br><span class="line">            --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> --retry <span class="variable">$STOP_TIMEOUT</span> \</span><br><span class="line">            --oknodo || log_end_msg $?</span><br><span class="line">        start_daemon</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status_of_proc <span class="string">"<span class="variable">$DAEMON</span>"</span> <span class="string">"<span class="variable">$NAME</span>"</span> &amp;&amp; <span class="built_in">exit</span> 0 || <span class="built_in">exit</span> $?</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        log_action_msg <span class="string">"Usage: /etc/init.d/<span class="variable">$NAME</span> &#123;start|stop|reload|force-reload|restart|status&#125;"</span> || <span class="literal">true</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>文件的开头 ### 部分为LSB tags，格式比较固定，可以参考其他的修改，如果没有会有如下类似报错：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh.service is not a native service, redirecting to systemd-sysv-install</span><br><span class="line">Executing /lib/systemd/systemd-sysv-install <span class="built_in">enable</span> ssh</span><br><span class="line">insserv: warning: script <span class="string">'ssh'</span> missing LSB tags and overrides</span><br><span class="line">update-rc.d: error: ssh Default-Start contains no runlevels, aborting.</span><br></pre></td></tr></table></figure><p>[参考文档tps://my.oschina.net/apis/blog/1647729?p=1)。</p><p>使用命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo update-rc.d transmission-daemon defaults</span><br></pre></td></tr></table></figure><p>更新 system 脚本。</p><p>至此不出意外就可以使用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service transmission-daemon stop|start|status</span><br></pre></td></tr></table></figure><h1 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h1><p>前面的 service 可以一系统服务的方式启动 daemon，而且可以指定运行的用户名，但会不能开机自启动。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/systmd/system</span><br><span class="line"></span><br><span class="line">vim transmission-daemion.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填入</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Transmission BitTorrent Daemon</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=rachpt</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/transmission-daemon -f --<span class="built_in">log</span>-error --logfile /var/<span class="built_in">log</span>/transmission-daemon.log</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>在这里卡了半天，无法成功，<code>-f</code> 好像很重要，删除后无法运行，无法设置开机运行。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> transmission-daemon</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查考所有服务</span></span><br><span class="line">sudo systemctl list-unit-files</span><br></pre></td></tr></table></figure><p><strong>记得备份所有 <code>transmission-daemon</code> 目录下的 resume 和 torrent 等文件目录。</strong> 血的教训。</p><h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><p>service 脚本参考 <a href="http://rachpt.github.io/2018/07/25/compile-nginx-1-14/" target="_blank" rel="noopener">此文</a> 。</p><p>开机启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接复制官方的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/systemd/system/nginx.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stop dance for nginx</span></span><br><span class="line"><span class="comment"># =======================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ExecStop sends SIGSTOP (graceful stop) to the nginx process.</span></span><br><span class="line"><span class="comment"># If, after 5s (--retry QUIT/5) nginx is still running, systemd takes control</span></span><br><span class="line"><span class="comment"># and sends SIGTERM (fast shutdown) to the main process.</span></span><br><span class="line"><span class="comment"># After another 5s (TimeoutStopSec=5), and if nginx is alive, systemd sends</span></span><br><span class="line"><span class="comment"># SIGKILL to all the remaining processes in the process group (KillMode=mixed).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nginx signals reference doc:</span></span><br><span class="line"><span class="comment"># http://nginx.org/en/docs/control.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=A high performance web server and a reverse proxy server</span><br><span class="line">Documentation=man:nginx(8)</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/sbin/nginx -t -q -g <span class="string">'daemon on; master_process on;'</span></span><br><span class="line">ExecStart=/usr/sbin/nginx -g <span class="string">'daemon on; master_process on;'</span></span><br><span class="line">ExecReload=/usr/sbin/nginx -g <span class="string">'daemon on; master_process on;'</span> -s reload</span><br><span class="line">ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid</span><br><span class="line">TimeoutStopSec=5</span><br><span class="line">KillMode=mixed</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>注意路径，其他和 transmission-daemon 一样。</p><h1 id="qbittorrent"><a href="#qbittorrent" class="headerlink" title="qbittorrent"></a>qbittorrent</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim /etc/systemd/system/qbittorrent.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=qBittorrent Daemon Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=rachpt</span><br><span class="line">ExecStart=/usr/bin/qbittorrent-nox</span><br><span class="line">ExecStop=/usr/bin/killall -w qbittorrent-nox</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>好像不用 <code>init.d</code>  里面运行脚本。</p><h1 id="flexget"><a href="#flexget" class="headerlink" title="flexget"></a>flexget</h1><p>这东西也可以 开机自动已 daemon 运行。</p><p><a href="https://flexget.com/InstallWizard/Linux/AutoStart" target="_blank" rel="noopener">参考文档</a></p><p>在此 copy 过来。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个配置文件</span></span><br><span class="line"></span><br><span class="line">sudo vim /etc/default/flexget</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configuration for /etc/init.d/flexget</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User to run flexget as.</span></span><br><span class="line"><span class="comment"># Daemon will not start if left empty.</span></span><br><span class="line">FGUSER=<span class="string">"rachpt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Full path to the flexget config.yml file to use.</span></span><br><span class="line"><span class="comment"># Defaults to FGUSER $HOME/.flexget/config.yml</span></span><br><span class="line">CONFIG=<span class="string">"/home/rachpt/.config/flexget/config.yml"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the directory where flexget should log. Do not add trailing slash.</span></span><br><span class="line"><span class="comment"># Defaults to the FGUSER $HOME/.flexget directory</span></span><br><span class="line">LOG=<span class="string">"/home/rachpt/.config/flexget"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log verbosity </span></span><br><span class="line"><span class="comment"># Available options : none critical error warning info verbose debug trace</span></span><br><span class="line"><span class="comment"># Defaults to info</span></span><br><span class="line">LEVEL=<span class="string">"info"</span></span><br></pre></td></tr></table></figure><p>建运行脚本 <code>/etc/init.d/flexget</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          flexget</span></span><br><span class="line"><span class="comment"># Required-Start:    $network $remote_fs</span></span><br><span class="line"><span class="comment"># Required-Stop:     $network $remote_fs</span></span><br><span class="line"><span class="comment"># Should-Start:      </span></span><br><span class="line"><span class="comment"># Should-Stop:       </span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: Flexget</span></span><br><span class="line"><span class="comment"># Description:       FlexGet is a multipurpose automation tool </span></span><br><span class="line"><span class="comment">#                    for content like torrents, nzbs, podcasts,</span></span><br><span class="line"><span class="comment">#                    comics, series, movies, etc.</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: Antoine Joubert, 19/01/2014</span></span><br><span class="line"></span><br><span class="line">NAME=<span class="string">"flexget"</span></span><br><span class="line">DAEMON=<span class="string">"/usr/local/bin/flexget"</span></span><br><span class="line">SETTINGS=<span class="string">"/etc/default/<span class="variable">$NAME</span>"</span></span><br><span class="line"></span><br><span class="line">DESC=<span class="string">"Flexget"</span></span><br><span class="line">PIDFILE=<span class="string">"/var/run/<span class="variable">$NAME</span>.pid"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> FGUSER CONFIG LOG LEVEL</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exit if flexget not installed</span></span><br><span class="line"><span class="keyword">if</span> [ ! -x <span class="string">"<span class="variable">$DAEMON</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        log_action_msg <span class="string">"<span class="variable">$DESC</span>: Could not find flexget executable. Exiting."</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read configuration variables</span></span><br><span class="line"><span class="keyword">if</span> [ -r /etc/default/<span class="variable">$NAME</span> ]; <span class="keyword">then</span></span><br><span class="line">        . /etc/default/<span class="variable">$NAME</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        log_action_msg <span class="string">"<span class="variable">$DESC</span>: /etc/default/<span class="variable">$NAME</span> not found. Exiting."</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Exit if FGUSER has not been set in /etc/default/flexget</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$FGUSER</span> ]; <span class="keyword">then</span></span><br><span class="line">        log_action_msg <span class="string">"<span class="variable">$DESC</span>: FGUSER not set in /etc/default/<span class="variable">$NAME</span>. Exiting."</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to verify if flexget is already running</span></span><br><span class="line"><span class="function"><span class="title">run_check</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [ -e <span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></span><br><span class="line">               status_of_proc -p <span class="variable">$PIDFILE</span> <span class="variable">$DAEMON</span> <span class="variable">$NAME</span> &gt; /dev/null &amp;&amp; RETVAL=0 || RETVAL=<span class="string">"$?"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                RETVAL=<span class="string">"2"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">end_log</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$RETVAL</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">                log_end_msg 0</span><br><span class="line">                <span class="built_in">return</span> 0</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                log_end_msg 1</span><br><span class="line">                <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to define config file, log file and log level</span></span><br><span class="line"><span class="function"><span class="title">conf_check</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$CONFIG</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                OPTIONS=<span class="string">"<span class="variable">$OPTIONS</span>"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                OPTIONS=<span class="string">"-c <span class="variable">$CONFIG</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$LOG</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                OPTIONS=<span class="string">"<span class="variable">$OPTIONS</span>"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                OPTIONS=<span class="string">"<span class="variable">$OPTIONS</span> -l <span class="variable">$LOG</span>/flexget.log"</span></span><br><span class="line">                <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$LOG</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">                        mkdir -p -m 750 <span class="variable">$LOG</span></span><br><span class="line">                        chown <span class="variable">$FGUSER</span> <span class="variable">$LOG</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="variable">$LEVEL</span> ]; <span class="keyword">then</span></span><br><span class="line">                OPTIONS=<span class="string">"<span class="variable">$OPTIONS</span>"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                OPTIONS=<span class="string">"<span class="variable">$OPTIONS</span> -L <span class="variable">$LEVEL</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_flexget</span></span>() &#123;</span><br><span class="line">        run_check</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$RETVAL</span> = 0 ]; <span class="keyword">then</span></span><br><span class="line">                log_action_msg <span class="string">"<span class="variable">$DESC</span>: Already running with PID <span class="variable">$(cat $PIDFILE)</span>. Aborting."</span></span><br><span class="line">                <span class="built_in">exit</span> 2</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                conf_check</span><br><span class="line">                log_daemon_msg <span class="string">"<span class="variable">$DESC</span>: Starting the daemon."</span></span><br><span class="line">                start-stop-daemon --start --background --quiet --pidfile <span class="variable">$PIDFILE</span> --make-pidfile --chuid <span class="variable">$FGUSER</span> \</span><br><span class="line">                --user <span class="variable">$FGUSER</span> --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> -- <span class="variable">$OPTIONS</span> daemon start</span><br><span class="line">                RETVAL=$?</span><br><span class="line">                end_log</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop_flexget</span></span>() &#123;</span><br><span class="line">        run_check</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$RETVAL</span> = 0 ]; <span class="keyword">then</span></span><br><span class="line">                log_daemon_msg <span class="string">"<span class="variable">$DESC</span>: Stopping the daemon."</span></span><br><span class="line">                start-stop-daemon --stop --quiet --chuid <span class="string">"<span class="variable">$FGUSER</span>"</span> --pidfile <span class="string">"<span class="variable">$PIDFILE</span>"</span> --retry 30</span><br><span class="line">                RETVAL=$?</span><br><span class="line">                [ -e <span class="string">"<span class="variable">$PIDFILE</span>"</span> ] &amp;&amp; rm -f <span class="string">"<span class="variable">$PIDFILE</span>"</span></span><br><span class="line">                end_log</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                log_action_msg <span class="string">"<span class="variable">$DESC</span>: Not currently running. Aborting."</span></span><br><span class="line">                <span class="built_in">exit</span> 2</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status_flexget</span></span>() &#123;</span><br><span class="line">        run_check</span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$RETVAL</span> = 0 ]; <span class="keyword">then</span></span><br><span class="line">                log_action_msg <span class="string">"<span class="variable">$DESC</span>: Currently running with PID <span class="variable">$(cat $PIDFILE)</span>."</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                log_action_msg <span class="string">"<span class="variable">$DESC</span>: Not currently running."</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">                start_flexget</span><br><span class="line">        ;;</span><br><span class="line">        stop)</span><br><span class="line">                stop_flexget</span><br><span class="line">        ;;</span><br><span class="line">        restart)</span><br><span class="line">                stop_flexget &amp;&amp; sleep 2 &amp;&amp; start_flexget</span><br><span class="line">        ;;</span><br><span class="line">        status)</span><br><span class="line">                status_flexget</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart|status&#125;"</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>记得加执行权限。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-rc.d flexget defaults</span><br></pre></td></tr></table></figure><p>建立 <code>flexget.service</code> 文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/flexget.service </span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Flexget Daemon</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=rachpt</span><br><span class="line">Type=simple</span><br><span class="line">WorkingDirectory=/home/rachpt/.config/flexget</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/flexget daemon start</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/bin/flexget daemon stop</span><br><span class="line">ExecReload=/usr/<span class="built_in">local</span>/bin/flexget daemon reload</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>其他和前面一样，不再重复。</p><p>使用 <code>pidtree</code> 可以看到所有进程的父进程。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;前面说到了使用原码编译 &lt;code&gt;transmission-daemon&lt;/code&gt; &lt;code&gt;qbittorrent-nox&lt;/code&gt; &lt;code&gt;nginx&lt;/code&gt; ，但是需要自己配置启动脚本。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="daemon" scheme="http://rachpt.me/tags/daemon/"/>
    
  </entry>
  
  <entry>
    <title>use-expect-to-ssh-and-solve-a-problem</title>
    <link href="http://rachpt.me/2018/07/26/use-expect-to-ssh-and-solve-a-problem/"/>
    <id>http://rachpt.me/2018/07/26/use-expect-to-ssh-and-solve-a-problem/</id>
    <published>2018-07-26T08:24:18.000Z</published>
    <updated>2018-07-26T09:26:57.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用 expect 实现一个简单命来使用 ssh 连上远程主机，并解决一个恼火的问题。</p></blockquote><a id="more"></a><p>正常的远程连接主机的方法是<code>ssh user@ip -p port</code>，根据提示输入密码，很是繁琐。<br>expect 能过实现交互式的脚本命令。</p><h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><p>expect 一般需要自己额外安装，ubuntu为例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install expect</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建脚本</span></span><br><span class="line">vim auto_ssh.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="built_in">set</span> timeout 10 <span class="comment"># 脚本超时时间</span></span><br><span class="line">spawn ssh rachpt@115.156.156.156</span><br><span class="line">expect <span class="string">"rachpt@115.156.156.156's password: "</span></span><br><span class="line">send <span class="string">"mypassword\r"</span> <span class="comment"># 密码</span></span><br><span class="line"></span><br><span class="line">expect <span class="string">"rachpt@pc:*"</span> <span class="comment"># 远程主机名 pc</span></span><br><span class="line"></span><br><span class="line">send <span class="string">"clear\r"</span> <span class="comment"># 清屏</span></span><br><span class="line"></span><br><span class="line">interact <span class="comment"># 退出脚本，控制交给用户</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个别名</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> as=<span class="string">'/path/auto_ssh.sh'</span></span><br></pre></td></tr></table></figure><p>之前一直用这个脚本，开始时很是爽，只需 as 一下，就自动连接。</p><p>但是我不得不忍受下面的情形：<br><img src="https://ws1.sinaimg.cn/large/675bda05gy1ftncuwrxyaj20md0katbx.jpg" alt=""></p><p>连上后如果改变 terminal 大小，远程的大小不会随着变。</p><p>后来发现不是我一个人遇到这问题。</p><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>使用下面的脚本代替：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="comment">#trap sigwinch spawned</span></span><br><span class="line"><span class="built_in">trap</span> &#123;</span><br><span class="line"> <span class="built_in">set</span> rows [stty rows]</span><br><span class="line"> <span class="built_in">set</span> cols [stty columns]</span><br><span class="line"> stty rows <span class="variable">$rows</span> columns <span class="variable">$cols</span> &lt; <span class="variable">$spawn_out</span>(slave,name)</span><br><span class="line">&#125; WINCH</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line">spawn ssh rachpt@115.156.156.156</span><br><span class="line">expect <span class="string">"rachpt@115.156.156.156's password: "</span></span><br><span class="line">send <span class="string">"mypassword\r"</span></span><br><span class="line"></span><br><span class="line">expect <span class="string">"rachpt@pc:*"</span></span><br><span class="line"></span><br><span class="line">send <span class="string">"clear\r"</span></span><br><span class="line"></span><br><span class="line">interact</span><br></pre></td></tr></table></figure><p>原因是没有传输窗口改变信号，加一个 trap在前面即可。</p><p><a href="https://blog.csdn.net/ownfire/article/details/8364039" target="_blank" rel="noopener">参考文档1</a>，<a href="https://blog.csdn.net/achejq/article/details/77882741" target="_blank" rel="noopener">文档2</a>，<a href="https://ubuntuforums.org/showthread.php?t=865420" target="_blank" rel="noopener">文档3</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用 expect 实现一个简单命来使用 ssh 连上远程主机，并解决一个恼火的问题。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ssh" scheme="http://rachpt.me/tags/ssh/"/>
    
      <category term="expect" scheme="http://rachpt.me/tags/expect/"/>
    
  </entry>
  
  <entry>
    <title>compile-nginx-1.14</title>
    <link href="http://rachpt.me/2018/07/25/compile-nginx-1-14/"/>
    <id>http://rachpt.me/2018/07/25/compile-nginx-1-14/</id>
    <published>2018-07-25T14:58:31.000Z</published>
    <updated>2018-07-27T11:28:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>魔改编译安装 nginx。</p></blockquote><a id="more"></a><h1 id="要做啥"><a href="#要做啥" class="headerlink" title="要做啥"></a>要做啥</h1><p>如图所示：<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftmi6tdbu4j20bu06n746.jpg" alt=""></p><p>希望将 nginx 默认的 错误页面自定义加入一个 返回的超链接。</p><h1 id="改源码"><a href="#改源码" class="headerlink" title="改源码"></a>改源码</h1><ol><li><p>下载源码，<br><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a><br>选择 Stable version，    nginx-1.14.0。</p></li><li><p>修改源码：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">vim nginx-1.14.0/src/http/ngx_http_special_response.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大约 109 行开始</span></span><br><span class="line"></span><br><span class="line">static char ngx_http_error_401_page[] =</span><br><span class="line"><span class="string">"&lt;html&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;body bgcolor=\"white\"&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h2&gt;&lt;a href=\"/index.html\"&gt;返回首页&lt;/a&gt;&lt;/h2&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static char ngx_http_error_402_page[] =</span><br><span class="line"><span class="string">"&lt;html&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;&lt;title&gt;402 Payment Required&lt;/title&gt;&lt;/head&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;body bgcolor=\"white\"&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h1&gt;402 Payment Required&lt;/h1&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h2&gt;&lt;a href=\"/index.html\"&gt;返回首页&lt;/a&gt;&lt;/h2&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static char ngx_http_error_403_page[] =</span><br><span class="line"><span class="string">"&lt;html&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;body bgcolor=\"white\"&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line"><span class="string">"&lt;center&gt;&lt;h2&gt;&lt;a href=\"/index.html\"&gt;返回首页&lt;/a&gt;&lt;/h2&gt;&lt;/center&gt;"</span> CRLF</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></table></figure></li></ol><p>按自己需求修改，其中，包含中文不要指定 utf-8 编码。</p><h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nginx-1.14.0</span><br><span class="line"></span><br><span class="line">./configure --with-select_module --with-poll_module \</span><br><span class="line">--with-threads --with-file-aio --with-http_ssl_module \</span><br><span class="line">--with-http_v2_module --with-http_realip_module \</span><br><span class="line">--with-http_addition_module --with-http_xslt_module \</span><br><span class="line">--with-http_xslt_module --with-http_image_filter_module \</span><br><span class="line">--with-http_image_filter_module --with-http_geoip_module \</span><br><span class="line">--with-http_geoip_module --with-http_sub_module \</span><br><span class="line">--with-http_dav_module --with-http_flv_module \</span><br><span class="line">--with-http_mp4_module --with-http_gunzip_module \</span><br><span class="line">--with-http_gzip_static_module --with-http_auth_request_module \</span><br><span class="line">--with-http_random_index_module --with-http_secure_link_module \</span><br><span class="line">--with-http_degradation_module --with-http_slice_module \</span><br><span class="line">--with-http_stub_status_module --with-http_perl_module \</span><br><span class="line">--with-mail --with-mail_ssl_module --with-stream --with-stream \</span><br><span class="line">--with-stream_ssl_module --with-google_perftools_module \</span><br><span class="line">--with-cpp_test_module --with-pcre --with-libatomic \</span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/nginx --sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log \</span><br><span class="line">--http-log-path=/var/<span class="built_in">log</span>/nginx/access.log \</span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid --lock-path=/var/lock/nginx.lock</span><br><span class="line"></span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>各个模块具体用处，请参看以下文章。</p><p><a href="https://www.cnblogs.com/dtiove/p/5924385.html" target="_blank" rel="noopener">参考文档1</a>，<a href="https://blog.csdn.net/likelxl/article/details/789167050" target="_blank" rel="noopener">参考文档2</a>。</p><h1 id="添加-service"><a href="#添加-service" class="headerlink" title="添加 service"></a>添加 service</h1><p>系统 mint, 对 ubuntu 应该都有效.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          nginx</span></span><br><span class="line"><span class="comment"># Required-Start:    $remote_fs $syslog</span></span><br><span class="line"><span class="comment"># Required-Stop:     $remote_fs $syslog</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: starts the nginx web server</span></span><br><span class="line"><span class="comment"># Description:       starts nginx using start-stop-daemon</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                               Functions</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                               Consts</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">DAEMON=/usr/sbin/nginx</span><br><span class="line"></span><br><span class="line">PS=<span class="string">"nginx"</span></span><br><span class="line">PIDNAME=<span class="string">"nginx"</span>                         <span class="comment">#lets you do $PS-slave</span></span><br><span class="line">PIDFILE=<span class="variable">$PIDNAME</span>.pid                    <span class="comment">#pid file</span></span><br><span class="line">PIDSPATH=/run                           <span class="comment">#pid path</span></span><br><span class="line"></span><br><span class="line">DESCRIPTION=<span class="string">"Nginx Server..."</span></span><br><span class="line"></span><br><span class="line">RUNAS=root                              <span class="comment">#user to run as</span></span><br><span class="line"></span><br><span class="line">SCRIPT_OK=0                             <span class="comment">#ala error codes</span></span><br><span class="line">SCRIPT_ERROR=1                          <span class="comment">#ala error codes</span></span><br><span class="line">TRUE=1                                  <span class="comment">#boolean</span></span><br><span class="line">FALSE=0                                 <span class="comment">#boolean</span></span><br><span class="line"></span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line">NGINX_CONF_FILE=<span class="string">"/etc/nginx/nginx.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                               Simple Tests</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#test if nginx is a file and executable</span></span><br><span class="line"><span class="built_in">test</span> -x <span class="variable">$DAEMON</span> || <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Include nginx defaults if available</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/default/nginx ] ; <span class="keyword">then</span></span><br><span class="line">        . /etc/default/nginx</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                               Functions</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">setFilePerms</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></span><br><span class="line">        chmod 400 <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configtest</span></span>() &#123;</span><br><span class="line">    <span class="variable">$DAEMON</span> -t -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">getPSCount</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> `pgrep -f <span class="variable">$PS</span> | wc -l`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">isRunning</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">        pidof_daemon <span class="variable">$1</span></span><br><span class="line">        PID=$?</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$PID</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">return</span> 0</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pidof_daemon</span><br><span class="line">        PID=$?</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$PID</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">return</span> 0</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#courtesy of php-fpm</span></span><br><span class="line"><span class="function"><span class="title">wait_for_pid</span></span> () &#123;</span><br><span class="line">    try=0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">test</span> <span class="variable">$try</span> -lt 35 ; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">            <span class="string">'created'</span>)</span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="string">"<span class="variable">$2</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">                try=<span class="string">''</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line"></span><br><span class="line">            <span class="string">'removed'</span>)</span><br><span class="line">            <span class="keyword">if</span> [ ! -f <span class="string">"<span class="variable">$2</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">                try=<span class="string">''</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">        try=`expr <span class="variable">$try</span> + 1`</span><br><span class="line">        sleep 1</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">    isRunning</span><br><span class="line">    isAlive=$?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;isAlive&#125;</span>"</span> -eq <span class="variable">$TRUE</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDNAME</span> found running with processes:  `pidof <span class="variable">$PS</span>`"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"<span class="variable">$PIDNAME</span> is NOT running."</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">removePIDFile</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">                 rm -f <span class="variable">$1</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="comment">#Do default removal</span></span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></span><br><span class="line">                 rm -f <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    log_daemon_msg <span class="string">"Starting <span class="variable">$DESCRIPTION</span>"</span></span><br><span class="line">    isRunning</span><br><span class="line">    isAlive=$?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;isAlive&#125;</span>"</span> -eq <span class="variable">$TRUE</span> ]; <span class="keyword">then</span></span><br><span class="line">        log_end_msg <span class="variable">$SCRIPT_ERROR</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        start-stop-daemon --start --quiet --chuid <span class="variable">$RUNAS</span> --pidfile <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span> --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> \</span><br><span class="line">        -- -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">        setFilePerms</span><br><span class="line">        log_end_msg <span class="variable">$SCRIPT_OK</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">    log_daemon_msg <span class="string">"Stopping <span class="variable">$DESCRIPTION</span>"</span></span><br><span class="line"></span><br><span class="line">    isRunning</span><br><span class="line">    isAlive=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;isAlive&#125;</span>"</span> -eq <span class="variable">$TRUE</span> ]; <span class="keyword">then</span></span><br><span class="line">         start-stop-daemon --stop --quiet --pidfile <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span></span><br><span class="line">         wait_for_pid <span class="string">'removed'</span> <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span></span><br><span class="line">         <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$try</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">             log_end_msg <span class="variable">$SCRIPT_ERROR</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             removePIDFile</span><br><span class="line">             log_end_msg <span class="variable">$SCRIPT_OK</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">         log_end_msg <span class="variable">$SCRIPT_ERROR</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    log_daemon_msg <span class="string">"Reloading (via HUP) <span class="variable">$DESCRIPTION</span>"</span></span><br><span class="line">    isRunning</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq <span class="variable">$TRUE</span> ]; <span class="keyword">then</span></span><br><span class="line">        `killall -HUP <span class="variable">$PS</span>` <span class="comment">#to be safe</span></span><br><span class="line">        log_end_msg <span class="variable">$SCRIPT_OK</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        log_end_msg <span class="variable">$SCRIPT_ERROR</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">terminate</span></span>() &#123;</span><br><span class="line">    log_daemon_msg <span class="string">"Force terminating (via KILL) <span class="variable">$DESCRIPTION</span>"</span></span><br><span class="line"></span><br><span class="line">    PIDS=`pidof <span class="variable">$PS</span>` || <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    [ -e <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span> ] &amp;&amp; PIDS2=`cat <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span>`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$PIDS</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"<span class="variable">$PIDS2</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">kill</span> <span class="variable">$i</span></span><br><span class="line">            wait_for_pid <span class="string">'removed'</span> <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span></span><br><span class="line">            removePIDFile</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    log_end_msg <span class="variable">$SCRIPT_OK</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">destroy</span></span>() &#123;</span><br><span class="line">    log_daemon_msg <span class="string">"Force terminating and may include self (via KILLALL) <span class="variable">$DESCRIPTION</span>"</span></span><br><span class="line">    killall <span class="variable">$PS</span> -q &gt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">    log_end_msg <span class="variable">$SCRIPT_OK</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pidof_daemon</span></span>() &#123;</span><br><span class="line">    PIDS=`pidof <span class="variable">$PS</span>` || <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    [ -e <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span> ] &amp;&amp; PIDS2=`cat <span class="variable">$PIDSPATH</span>/<span class="variable">$PIDFILE</span>`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$PIDS</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"<span class="variable">$PIDS2</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">    restart|force-reload)</span><br><span class="line">        stop</span><br><span class="line">        sleep 3</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    configtest)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    terminate)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    destroy)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        FULLPATH=/etc/init.d/<span class="variable">$PS</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$FULLPATH</span> &#123;start|stop|restart|force-reload|status|configtest|terminate|destroy&#125;"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"       The 'destroy' command should only be used as a last resort."</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>记得改权限.<br>上面的 nginx 路径需要改成自己编译时候写的,或者 <code>which nginx</code>.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo update-rc.d nginx defaults</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fton0r8ilyj20sc0sdjyg.jpg" alt=""></p><p><a href="https://segmentfault.com/q/1010000005987075" target="_blank" rel="noopener">参考文档</a>.</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;魔改编译安装 nginx。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="nginx" scheme="http://rachpt.me/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>run-matlab-in-a-terminal</title>
    <link href="http://rachpt.me/2018/07/25/run-matlab-in-a-terminal/"/>
    <id>http://rachpt.me/2018/07/25/run-matlab-in-a-terminal/</id>
    <published>2018-07-25T12:39:59.000Z</published>
    <updated>2018-07-25T13:19:07.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>直接在 termianl 中运行 matlab，输入命令，执行脚本。</p></blockquote><a id="more"></a><p>matlab 绝对是一个超级强大的 脚本工具，当然不仅仅是。对于使用 linux 日常来说，程序提供 cli，就意味着可以集成并协同工作。在一个 shell  脚本种一个程序(命令)只做一件事，程序的输出作为另一个程序的输入，配合 Linux 的管道机制，一切皆有可能。<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftmeutjlz7j20em0ixwgk.jpg" alt="Keep calm and open a terminal."><br><blockquote class="blockquote-center"><p>Keep calm and open a terminal.</p></blockquote></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>使用 mount 先挂载 dvd1,图形界面直接双击挂载。<br><strong>一定要在挂载路径之外 使用 <code>sudo install</code></strong><br>后面按提示弹出 dvd1,挂载 dvd2.<br> 安装路径 建议软件默认位置，选择创建 <code>/usr/local/bin/matlab</code>。</p><h1 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h1><p>hust 买了正版授权，注意一个学号只能授权一台设备一个版本，可以取消已经授权了的设备。</p><h1 id="终端运行"><a href="#终端运行" class="headerlink" title="终端运行"></a>终端运行</h1><p>打开 terminal， <code>matlab -help</code></p><p>可以看到帮助文档。</p><p>使用 <code>matlab -nodesktop</code> 在 terminal 中运行 matlab，但是会闪过 matlab 的版权信息UI。</p><p>使用 <code>matlab -nojvm</code> 关闭 matlab 的 java 虚拟机，所有与 GUI 相关的都用不了，不会有图形界面。</p><p>使用 <code>matlab -nosplash</code> 关闭版权信息页面。</p><p>使用 <code>matlab -nodesktop -nosplash -r script/PATH</code> 运行 m 脚本，(不要 .m 后缀)。</p><p>使用 alias:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> matlab=<span class="string">'matlab -nojvm -nodesktop -nosplash'</span></span><br></pre></td></tr></table></figure><p>退出 使用 <code>quit</code> 或者 <code>exit</code>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;直接在 termianl 中运行 matlab，输入命令，执行脚本。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="matlab" scheme="http://rachpt.me/tags/matlab/"/>
    
  </entry>
  
  <entry>
    <title>make-transmission2.94-from-source-code</title>
    <link href="http://rachpt.me/2018/07/24/make-transmission2-94-from-source-code/"/>
    <id>http://rachpt.me/2018/07/24/make-transmission2-94-from-source-code/</id>
    <published>2018-07-24T02:47:46.000Z</published>
    <updated>2018-07-24T04:41:07.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>重源代码编译安装 transmission， 以支持跳过校验以及自定义部分 webUI 特性。环境 ubuntu 系。</p></blockquote><a id="more"></a><h1 id="编译环境"><a href="#编译环境" class="headerlink" title="编译环境"></a>编译环境</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential automake \</span><br><span class="line">     autoconf libtool pkg-config intltool \</span><br><span class="line">     libcurl4-openssl-dev libglib2.0-dev \</span><br><span class="line">     libevent-dev libminiupnpc-dev libgtk-3-dev libappindicator3-dev</span><br></pre></td></tr></table></figure><p><a href="https://github.com/transmission/transmission/wiki/Building-Transmission#on-unix" target="_blank" rel="noopener">官方参考文档</a> 。</p><h1 id="魔改"><a href="#魔改" class="headerlink" title="魔改"></a>魔改</h1><ol><li><p>跳过校验</p><p><a href="https://github.com/superlukia/transmission-2.92_skiphashcheck/commit/56e327d1dacb5b3453954b76a6d0edd30edb7a34" target="_blank" rel="noopener">请参考这里</a>。</p><p><a href="https://tieba.baidu.com/p/4839039900" target="_blank" rel="noopener">以及这里</a>。</p></li><li><p>自定义 webUI 界面。</p><p>效果如下图：<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftks3hh5bpj20im076js1.jpg" alt=""></p><p>在工具栏上添加一个跳转到自定义路径的按钮。</p></li></ol><ul><li>修改1：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim web/index.html</span><br><span class="line"></span><br><span class="line"># 第 50 行附近添加</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;toolbar-pause-all&quot; title=&quot;Pause All Torrents&quot;&gt;&lt;/div&gt;</span><br><span class="line">+&lt;div id=&quot;toolbar-separator&quot;&gt;&lt;/div&gt;</span><br><span class="line">+&lt;a href=&quot;/index.html&quot; title=&quot;返回首页&quot;&gt;&lt;div style=&quot;margin-right: 10px; margin-top: 6px&quot;&gt;&lt;img src=&quot;./images/home.png&quot; /&gt;&lt;/div&gt;&lt;/a&gt;</span><br><span class="line">+&lt;div id=&quot;toolbar-separator&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;toolbar-inspector&quot; title=&quot;Toggle Inspector&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>  为此需要添加一枚 home.png 图标 到 <code>web/images/home.png</code>.<br>  同时修改 该文件夹 的 <code>Makefile.am</code> 和 <code>Makefile.in</code>，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim web/images/Makefile.am</span><br><span class="line"></span><br><span class="line"># 改成如下</span><br><span class="line"></span><br><span class="line">datadir = $&#123;datarootdir&#125;/$&#123;PACKAGE_NAME&#125;/$&#123;subdir&#125;</span><br><span class="line">dist_data_DATA = \</span><br><span class="line">  favicon.ico \</span><br><span class="line">  favicon.png \</span><br><span class="line">  webclip-icon.png \</span><br><span class="line">  home.png</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim web/images/Makefile.in</span><br><span class="line"></span><br><span class="line"># 大约在 365 行附近，如下修改</span><br><span class="line"></span><br><span class="line">disti\_data\_DATA = \</span><br><span class="line">  favicon.ico \</span><br><span class="line">  favicon.png \</span><br><span class="line">+  webclip-icon.png \</span><br><span class="line">+  home.png</span><br><span class="line"></span><br><span class="line">all: all-am</span><br></pre></td></tr></table></figure><p>  自此 自定义的 webUI 就算是好啦。</p><ul><li><p>修改2：</p><p>魔改 401 界面，效果如下：<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftksonthx2j20b805k0sn.jpg" alt=""></p><p>首先使用了命令 <code>cd transmission-2.94 &amp;&amp; find . | xargs grep &#39;&lt;h1&gt;&#39;</code> 查找包含 <code>&lt;h1&gt;</code> 的源代码位置。<br>结果为 <code>./libtransmission/rpc-server.c:  evbuffer_add_printf (body, &quot;&lt;h1&gt;%d: %s&lt;/h1&gt;&quot;, code, code_text);</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim ./libtransmission/rpc-server.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大约在 128 行</span></span><br><span class="line"></span><br><span class="line">  evbuffer_add_printf (body, <span class="string">"&lt;h1&gt;%d: %s&lt;/h1&gt;"</span>, code, code_text);</span><br><span class="line">  <span class="keyword">if</span> (text)</span><br><span class="line">+    evbuffer_add_printf (body, <span class="string">"%s&lt;br /&gt;&lt;br /&gt;&lt;a href=\"/index.html\"&gt;Click to Homepage&lt;/a&gt;"</span>, text);</span><br><span class="line">  evhttp_send_reply (req, code, code_text, body);</span><br></pre></td></tr></table></figure><p>  修改如上，在 <code>%s</code> 后面加上了一个 a 标签。</p><h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure -q &amp;&amp; make -s</span><br><span class="line"></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>  安装会自动覆盖掉以前的版本。</p><p>  详见：<br>i<a href="https://github.com/rachpt/transmission-skiphashcheck-mod-webUI" target="_blank" rel="noopener">https://github.com/rachpt/transmission-skiphashcheck-mod-webUI</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;重源代码编译安装 transmission， 以支持跳过校验以及自定义部分 webUI 特性。环境 ubuntu 系。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="transmission" scheme="http://rachpt.me/tags/transmission/"/>
    
  </entry>
  
  <entry>
    <title>make-qbittorrent-from-source-code</title>
    <link href="http://rachpt.me/2018/07/21/make-qbittorrent-from-source-code/"/>
    <id>http://rachpt.me/2018/07/21/make-qbittorrent-from-source-code/</id>
    <published>2018-07-21T13:21:34.000Z</published>
    <updated>2018-07-27T05:43:50.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>从源码编译安装旧版本 qbittorrent，别问我为什么要安装旧版。<br><a id="more"></a><br><div class="note default"><p>以下内容转载至:<br><a href="https://www.cnblogs.com/shuochen/p/8533712.html" target="_blank" rel="noopener">https://www.cnblogs.com/shuochen/p/8533712.html</a> （仅作为备份）。<br>英文原版:<br><a href="https://github.com/qbittorrent/qBittorrent/wiki/Compiling-qBittorrent-on-Debian-and-Ubuntu" target="_blank" rel="noopener">https://github.com/qbittorrent/qBittorrent/wiki/Compiling-qBittorrent-on-Debian-and-Ubuntu</a> 。</p></div></p></blockquote><h1 id="一、安装依赖环境"><a href="#一、安装依赖环境" class="headerlink" title="一、安装依赖环境"></a>一、安装依赖环境</h1><h2 id="①安装一般依赖包"><a href="#①安装一般依赖包" class="headerlink" title="①安装一般依赖包"></a>①安装一般依赖包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libboost-dev libboost-system-dev build-essential \</span><br><span class="line">     libboost-chrono-dev libboost-random-dev libssl-dev libgeoip-dev \</span><br><span class="line">     git pkg-config automake libtool</span><br></pre></td></tr></table></figure><h2 id="②安装Qt5库"><a href="#②安装Qt5库" class="headerlink" title="②安装Qt5库"></a>②安装Qt5库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qtbase5-dev qttools5-dev-tools</span><br></pre></td></tr></table></figure><h2 id="③安装python和GeoIP数据库"><a href="#③安装python和GeoIP数据库" class="headerlink" title="③安装python和GeoIP数据库"></a>③安装python和GeoIP数据库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python geoip-database</span><br></pre></td></tr></table></figure><h1 id="二、安装Libtorrent"><a href="#二、安装Libtorrent" class="headerlink" title="二、安装Libtorrent"></a>二、安装Libtorrent</h1><h2 id="①下载Libtorrent包并打开"><a href="#①下载Libtorrent包并打开" class="headerlink" title="①下载Libtorrent包并打开"></a>①下载Libtorrent包并打开</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git <span class="built_in">clone</span> https://github.com/arvidn/libtorrent.git</span><br><span class="line"><span class="built_in">cd</span> libtorrent</span><br></pre></td></tr></table></figure><h2 id="②选择1-0-分支编译安装"><a href="#②选择1-0-分支编译安装" class="headerlink" title="②选择1.0.*分支编译安装"></a>②选择1.0.*分支编译安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout RC_1_0</span><br><span class="line">./autotool.sh</span><br><span class="line">./configure --<span class="built_in">disable</span>-debug --<span class="built_in">enable</span>-encryption --prefix=/usr --with-libgeoip=system</span><br><span class="line">make clean &amp;&amp; make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h1 id="三、编辑安装qBittorrent"><a href="#三、编辑安装qBittorrent" class="headerlink" title="三、编辑安装qBittorrent"></a>三、编辑安装qBittorrent</h1><h2 id="①从github下载对应版本的QB安装包"><a href="#①从github下载对应版本的QB安装包" class="headerlink" title="①从github下载对应版本的QB安装包"></a>①从github下载对应版本的QB安装包</h2><p>QB历史版本下载：<a href="https://github.com/qbittorrent/qBittorrent/releases" target="_blank" rel="noopener">https://github.com/qbittorrent/qBittorrent/releases</a></p><p>如编译安装3.3.11版本的QB</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/qbittorrent/qBittorrent/archive/release-3.3.11.tar.gz</span><br><span class="line">tar -xzvf release-3.3.11.tar.gz</span><br><span class="line"><span class="built_in">cd</span> qBittorrent-release-3.3.11</span><br></pre></td></tr></table></figure><h2 id="②编译qBittorrent"><a href="#②编译qBittorrent" class="headerlink" title="②编译qBittorrent"></a>②编译qBittorrent</h2><p>需要GUI则可以取消后面的disable参数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr --<span class="built_in">disable</span>-gui</span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>这里编译的时候如果提示错误 缺少 zlib 运行以下命令即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zlib1g-dev</span><br></pre></td></tr></table></figure><h1 id="四、运行qBittorrent"><a href="#四、运行qBittorrent" class="headerlink" title="四、运行qBittorrent"></a>四、运行qBittorrent</h1><h2 id="①初始化QB-设置中文"><a href="#①初始化QB-设置中文" class="headerlink" title="①初始化QB(设置中文)"></a>①初始化QB(设置中文)</h2><p>运行以下命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox  <span class="comment"># 无 GUI</span></span><br><span class="line">qbittorrent      <span class="comment"># 有 GUI</span></span><br></pre></td></tr></table></figure><p>运行后会提示输入,输入y，然后回车即可，这时打开第③步中的地址，进入后打开设置，在WEBUI里将语言改成中文，然后Ctrl+C 结束，再次输入命令运行QB，这是刷新网页就是中文了，意思就是设置完需要重启下客户端才能使语言修改生效，其它设置类似。</p><h2 id="②在后台运行qBittorrent"><a href="#②在后台运行qBittorrent" class="headerlink" title="②在后台运行qBittorrent"></a>②在后台运行qBittorrent</h2><p>因为直接运行QB，退出shell窗口的话就会关闭，所以我们可以用nohup的方式运行QB</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup qbittorrent-nox &amp;</span><br></pre></td></tr></table></figure><p>这样QB就已经稳定在后台运行了，即使你关闭shell也不会结束的。</p><h2 id="③访问qBittorrent的Web-UI"><a href="#③访问qBittorrent的Web-UI" class="headerlink" title="③访问qBittorrent的Web-UI"></a>③访问qBittorrent的Web-UI</h2><p>默认地址: <a href="http://IP地址:8080" target="_blank" rel="noopener">http://IP地址:8080</a><br>默认用户名: admin<br>默认密码: adminadmin</p><hr><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="魔改"><a href="#魔改" class="headerlink" title="魔改"></a>魔改</h2><p>效果如下:<br><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftocq1d522j20bi02gq2z.jpg" alt=""></p><ol><li>在 web UI 上添加一个返回的超链接 “首页”.</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim qBittorrent-release-3.3.9/src/webui/www/private/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索 help-about ,大约在 79 行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                            &lt;li&gt;&lt;a id=<span class="string">"aboutLink"</span>&gt;&lt;img class=<span class="string">"MyMenuIcon"</span> src=<span class="string">"theme/help-about"</span> alt=<span class="string">"QBT_TR(&amp;About)QBT_TR"</span> width=<span class="string">"16"</span> height=<span class="string">"16"</span> onload=<span class="string">"fixPNG(this)"</span>/&gt;QBT_TR(&amp;About)QBT_TR&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                  + &lt;li&gt;</span><br><span class="line">                  +     &lt;a href=<span class="string">"/index.html"</span>&gt;首页&lt;/a&gt;</span><br><span class="line">                  + &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br></pre></td></tr></table></figure><p>如上 添加 li 和一个 a 标签即可.</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1ftocwg57h9j20t00el0uy.jpg" alt=""></p><ol><li>登录界面</li></ol><p>1<a href="https://ws1.sinaimg.cn/large/675bda05ly1ftocxybpz6j20ec09x0u9.jpg" target="_blank" rel="noopener"></a><br>加一个 返回按钮,同时添加一行移动端适配代码.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim qBittorrent-release-3.3.9/src/webui/www/private/login.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 移动端适配代码,</span></span><br><span class="line"><span class="comment"># 在 head 中添加</span></span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span><br><span class="line">+   &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"</span> /&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"IE=8"</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改末尾 submit 按钮</span></span><br><span class="line"></span><br><span class="line">&lt;div class=<span class="string">"row"</span>&gt;&lt;label <span class="keyword">for</span>=<span class="string">"password"</span>&gt;QBT_TR(Password)QBT_TR&lt;/label&gt;&lt;br /&gt;&lt;input <span class="built_in">type</span>=<span class="string">"password"</span> id=<span class="string">"password"</span> name=<span class="string">"password"</span> /&gt;&lt;/div&gt;</span><br><span class="line">+&lt;div class=<span class="string">"row"</span>&gt;&lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> id=<span class="string">"login"</span> value=<span class="string">"QBT_TR(Login)QBT_TR"</span> /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> value=<span class="string">"返回首页"</span> onclick=<span class="string">"javascript:location.href='/index.html'"</span> /&gt;&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>推荐使用 –disable-gui 不要 GUI, 使用 daemon 运行.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/qbittorrent.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入一下内容</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=qBittorrent Daemon Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=rachpt</span><br><span class="line">ExecStart=/usr/bin/qbittorrent-nox</span><br><span class="line">ExecStop=/usr/bin/killall -w qbittorrent-nox</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重载 daemon</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">sudo systemctl start qbittorrent</span><br><span class="line"><span class="comment"># 状态</span></span><br><span class="line">sudo systemctl status qbittorrent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行开机自启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> qbittorrent</span><br></pre></td></tr></table></figure><p><a href="https://github.com/qbittorrent/qBittorrent/wiki/Setting-up-qBittorrent-on-Ubuntu-server-as-daemon-with-Web-interface-%2815.04-and-newer%29" target="_blank" rel="noopener">参考文档</a>.</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;从源码编译安装旧版本 qbittorrent，别问我为什么要安装旧版。&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="linux" scheme="http://rachpt.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>compile-vim-with-clipboard-supported</title>
    <link href="http://rachpt.me/2018/07/20/compile-vim-with-clipboard-supported/"/>
    <id>http://rachpt.me/2018/07/20/compile-vim-with-clipboard-supported/</id>
    <published>2018-07-20T08:11:00.000Z</published>
    <updated>2018-07-30T09:13:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>从源码编译 vim，以支持使用系统粘贴板。</p></blockquote><a id="more"></a><h1 id="why"><a href="#why" class="headerlink" title="why"></a>why</h1><p><code>&quot; + Y</code> <code>&quot; + P</code> 这两组组合键可以实现 vim 与系统粘贴板之间的共享数据。重要性可想而知，至少有时还是需要和外部交换粘贴板的。</p><p>如果不自己编译源码，唯一的办法就是额外安装GUI版本的 vim。很蠢，不是吗?</p><h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><ol><li><p>下载源代码,<br><a href="https://github.com/vim/vim" target="_blank" rel="noopener">https://github.com/vim/vim</a><br> 使用 git <code>git clone https://github.com/vim/vim.git</code></p></li><li><p>安装依赖<br><code>sudo apt-get install xorg-dev</code>  # <a href="https://blog.csdn.net/atomicfox/article/details/7525398" target="_blank" rel="noopener">参考文档</a><br><code>sudo apt-get install libncurses5-dev</code>  # <a href="https://blog.csdn.net/jdsjlzx/article/details/12883359" target="_blank" rel="noopener">参考文档</a></p></li><li><p>编译<br><code>cd vim</code><br><code>./configure --with-features=huge</code>  # <a href="https://blog.csdn.net/atomicfox/article/details/7525398" target="_blank" rel="noopener">参考文档</a><br><code>cd src/</code><br><code>make &amp;&amp; sudo make install</code></p></li></ol><h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><p><code>vim --version | grep &quot;clipboard&quot;</code><br>看到 +clipboard  即是成功了。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>安装 YouCompleteMe 直接参考官方文档，先安装依赖。<br><a href="http://valloric.github.io/YouCompleteMe/#ubuntu-linux-x64" target="_blank" rel="noopener">http://valloric.github.io/YouCompleteMe/#ubuntu-linux-x64</a></p><p>如果出现下面错误(一定会)：<br><code>YouCompleteMe unavailable: requires Vim compiled with Python (2.7.1 or 3.4 )</code><br>需要在编译 vim 时加入支持 python 的参数。<br><code>--enable-pythoninterp=yes --enable-python3interp=yes</code> # 前面的时 python2 的后面是3的。<br><a href="https://blog.csdn.net/northeastsqure/article/details/72847259" target="_blank" rel="noopener">参考文档1</a> ，<a href="https://blog.csdn.net/u012675539/article/details/51489957" target="_blank" rel="noopener">参考文档2</a>。<br>使用 <code>checkinstall</code> 构建 deb 包。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install checkinstall</span><br><span class="line"><span class="built_in">cd</span> ~/vim</span><br><span class="line">sudo checkinstall</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/Valloric/YouCompleteMe/wiki/Building-Vim-from-source" target="_blank" rel="noopener">参考文档</a>。</p><h1 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h1><p>创建图标添加到右键列表。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.<span class="built_in">local</span>/share/applications/vim.desktop </span><br><span class="line"></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Encoding=UTF-8</span><br><span class="line">Name=Vim Text Editor (Console)</span><br><span class="line">Comment=Edit text files <span class="keyword">in</span> a console using Vim</span><br><span class="line">Exec=vim %u</span><br><span class="line">Terminal=<span class="literal">true</span></span><br><span class="line">Type=Application</span><br><span class="line">Icon=/usr/share/pixmaps/vim.png <span class="comment"># 此处设置图标路径 </span></span><br><span class="line"><span class="comment"># 可以下载这个 http://pixelwhip.github.io/svg-flavors/img/logos/vim.png</span></span><br><span class="line">Categories=Application;Utility;TextEditor;</span><br><span class="line">StartupNotify=<span class="literal">true</span></span><br><span class="line">MimeType=text/plain;</span><br><span class="line">NoDisplay=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p><a href="https://askubuntu.com/questions/72535/creating-desktop-files-to-use-on-the-open-with-other-application-tab" target="_blank" rel="noopener">参考文档</a>.<br>Set vim as your default editor with <code>update-alternatives</code>.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/editor editor /usr/<span class="built_in">local</span>/bin/vim 1</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> editor /usr/<span class="built_in">local</span>/bin/vim</span><br><span class="line">sudo update-alternatives --install /usr/bin/vi vi /usr/<span class="built_in">local</span>/bin/vim 1</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> vi /usr/<span class="built_in">local</span>/bin/vim</span><br></pre></td></tr></table></figure></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>vim 编译主要命令：</p><ol><li><code>./configure --with-features=hug --enable-pythoninterp=yes --enable-python3interp=yes --enable-rubyinterp --enable-luainterp --enable-perlinterp --enable-multibyte=true --enable-cscope=true --prefix=/usr</code>,<br><code>--enable-gui=no</code> GUI相关 <code>--enable-gui=gtk2</code>;</li><li><code>cd src</code>;</li><li><code>make &amp;&amp; sudo make install</code>.</li></ol><p>最后关于卸载以及 清理，(在源代码路径下)<br>使用 <code>make clean</code> 清理之间编译完成的；<br>使用 <code>sudo make uninstall</code> 卸载使用 make 安装的软件。<br>实在不行，先 <code>whereis vim</code>，使用 rm -rf 删掉文件即可。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;从源码编译 vim，以支持使用系统粘贴板。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="linux" scheme="http://rachpt.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>adb-linux-and-mi8</title>
    <link href="http://rachpt.me/2018/07/06/adb-linux-and-mi8/"/>
    <id>http://rachpt.me/2018/07/06/adb-linux-and-mi8/</id>
    <published>2018-07-06T03:37:15.000Z</published>
    <updated>2018-09-07T12:28:50.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>记录几个在 Linux 上通过 adb 工具控制 MI8 的操作。以及无电脑卡刷 TWRP。</p></blockquote><a id="more"></a><h1 id="ADB"><a href="#ADB" class="headerlink" title="ADB"></a>ADB</h1><p>安装命令（ubuntu系列）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:nilarimogard/webupd8</span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment"># 直接试下面的，不行在加 ppa</span></span><br><span class="line">sudo apt-get install android-tools-adb</span><br><span class="line"></span><br><span class="line">adb --version <span class="comment"># 检查是否安装</span></span><br></pre></td></tr></table></figure><h1 id="fastboot"><a href="#fastboot" class="headerlink" title="fastboot"></a>fastboot</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">sudo apt-get install android-tools-fastboot</span><br></pre></td></tr></table></figure><p>fastboot 授权： <a href="https://developer.android.com/studio/run/device" target="_blank" rel="noopener">https://developer.android.com/studio/run/device</a></p><h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开usb 调试，连上 linux，列出所有 usb 设备。</span></span><br><span class="line">lsusb</span><br><span class="line"></span><br><span class="line">rachpt@pc ~ $ lsusb</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 004: ID 0b95:1790 ASIX Electronics Corp. AX88179 Gigabit Ethernet</span><br><span class="line">Bus 001 Device 002: ID 2109:2812 VIA Labs, Inc. VL812 Hub</span><br><span class="line">Bus 001 Device 071: ID 046d:c534 Logitech, Inc. Unifying Receiver</span><br><span class="line">Bus 001 Device 088: ID 2717:ff48  </span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure><p>可以通过对比连接前后变化得知哪个是手机的 ID 和idProduct 。</p><p><code>Bus 001 Device 088: ID 2717:ff48</code> 这条即是。新手机有可能带有 Google 字样。</p><p>其中ID号：2717，idProduct号：ff48。</p><p>参考网上教程，需要建两个文件用于授权。</p><ol><li>第一个文件：</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先切换目录</span></span><br><span class="line"><span class="built_in">cd</span> /etc/udev/rules.d/ &amp;&amp; ls</span><br><span class="line"><span class="comment"># 新建一个叫 imx-android.rules 的文件。</span></span><br><span class="line"><span class="comment"># 也有说是叫 51-android.rules，等等</span></span><br><span class="line">sudo vim imx-android.rules</span><br><span class="line"><span class="comment"># 填入一下内容</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTRS&#123;idVendor&#125;==<span class="string">"填ID号"</span>, ATTRS&#123;idProduct&#125;==<span class="string">"填idProduct号"</span>,MODE=<span class="string">"0777"</span></span><br><span class="line"><span class="comment"># 后面的 0777 是因为我需要可执行权限。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后加可执行权限</span></span><br><span class="line">sudo chmod +x imx-android.rules</span><br></pre></td></tr></table></figure><ol><li>第二个文件：</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.android</span><br><span class="line">vim ~/.android/adb_usb.ini</span><br><span class="line"><span class="comment"># 添加ID号，16进制，0x+ID号</span></span><br><span class="line">0x2717</span><br></pre></td></tr></table></figure><p>重启adb。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb <span class="built_in">kill</span>-server</span><br><span class="line"><span class="comment"># 可能需要 重新插拔一下 usb 线。</span></span><br><span class="line">adb start-server</span><br></pre></td></tr></table></figure><h1 id="黑域"><a href="#黑域" class="headerlink" title="黑域"></a>黑域</h1><p>开启黑域服务：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -d shell sh /data/data/me.piebridge.brevent/brevent.sh</span><br></pre></td></tr></table></figure><h1 id="MIUI-广告"><a href="#MIUI-广告" class="headerlink" title="MIUI 广告"></a>MIUI 广告</h1><p>通过 adb 冻结 msa：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm <span class="built_in">disable</span>-user --user 0 com.miui.systemAdSolution <span class="comment"># 国内版</span></span><br><span class="line"></span><br><span class="line">adb shell pm <span class="built_in">disable</span>-user --user 0 com.miui.msa.global <span class="comment"># 国际版</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable 换成 enable 可解除冻结，当然也可以直接在手机上解除。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他命令参考</span></span><br><span class="line">adb shell pm</span><br></pre></td></tr></table></figure><p><a href="http://www.miui.com/thread-15991867-1-1.html" target="_blank" rel="noopener">其他常见广告关闭方法</a> 。</p><h1 id="刷-TWRP"><a href="#刷-TWRP" class="headerlink" title="刷 TWRP"></a>刷 TWRP</h1><p>由于没有使用 windows，手边没有数据线，已经解锁的米8如何刷第三方 rec TWRP呢？</p><p>刷开发版，使用自带的 root，授权 本地终端，替换 recovery，然后卡刷 zip，搞定。</p><p>下载 <a href="https://www.miui.com/thread-15306132-1-1.html" target="_blank" rel="noopener">原贴链接</a>.</p><p>下载地址：<br>链接: <a href="https://pan.baidu.com/s/1cD_ya9pwDIFqrBuglHhNnw" target="_blank" rel="noopener">https://pan.baidu.com/s/1cD_ya9pwDIFqrBuglHhNnw</a> 密码: qc1s</p><p>这里记录一下。</p><ol><li><p>需要一个终端模拟器。<br>有个比较老的 超级终端，网上有汉化版，但是不能使用 方向键，各种不爽。</p><p>推荐使用 <a href="https://juicessh.com/" target="_blank" rel="noopener">juicessh</a>，免费版就够用了，这个可以使用本地终端模拟，记得给 root 权限，首次使用输入 <code>su</code> 获取。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line"></span><br><span class="line">cd /dev/block/platform/soc/</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"># 找一下类似的文件夹，可能不是下面这个。</span><br><span class="line">cd 1d84000.ufshc/by-name</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line"># 可以看到 recovery这个链接文件。</span><br><span class="line"></span><br><span class="line"># 自己下载第三方 rec 的 img 文件到sd卡根目录</span><br><span class="line"></span><br><span class="line">dd if=/sdcard/recovery.img of=recovery</span><br><span class="line"></span><br><span class="line"># 成功后，使用 reboot 重启</span><br><span class="line"></span><br><span class="line">reboot recovery</span><br></pre></td></tr></table></figure><ol><li>卡刷 zip<br>由于上面改的只是临时rec文件，以后重启失效，需要从上面进入的 rec 卡刷 zip 包。<br>重点就是 那个 <code>dd</code> 命令。</li></ol><p><a href="http://www.miui.com/thread-11619860-1-1.html" target="_blank" rel="noopener">参考文档1</a>，<a href="https://www.cnblogs.com/shangdawei/p/4457607.html" target="_blank" rel="noopener">文档2</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;记录几个在 Linux 上通过 adb 工具控制 MI8 的操作。以及无电脑卡刷 TWRP。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="mi8" scheme="http://rachpt.me/tags/mi8/"/>
    
  </entry>
  
  <entry>
    <title>zip-and-upload-to-baidupcs</title>
    <link href="http://rachpt.me/2018/07/02/zip-and-upload-to-baidupcs/"/>
    <id>http://rachpt.me/2018/07/02/zip-and-upload-to-baidupcs/</id>
    <published>2018-07-02T13:03:10.000Z</published>
    <updated>2018-07-02T13:34:59.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>文件批量使用 zip 打包并上传 百度网盘备份。</p></blockquote><a id="more"></a><h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author: rachpt@126.com</span></span><br><span class="line"><span class="comment"># version: 2.0</span></span><br><span class="line"><span class="comment">#------settings--------#</span></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">password=<span class="string">'password@baidu.com'</span></span><br><span class="line"><span class="comment"># 标识</span></span><br><span class="line">pass=<span class="string">"locked"</span></span><br><span class="line"><span class="comment"># 百度网盘路径</span></span><br><span class="line">uplaodPath=<span class="string">"/zip/path/"</span></span><br><span class="line"><span class="comment"># 获取但前脚本的绝对路径</span></span><br><span class="line">ROOT_PATH=<span class="string">"<span class="variable">$(dirname "$(readlink -f "$0")</span>"</span>)<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#--------zip and upload-----------#</span></span><br><span class="line"><span class="string"># 压缩与上传文件列表，不递归子目录</span></span><br><span class="line"><span class="string">zip_file_list=<span class="variable">$(find "$ROOT_PATH" -maxdepth 1 -iname "*my.file")</span></span></span><br><span class="line"><span class="string"># 设置 IFS，防止路径中有空格</span></span><br><span class="line"><span class="string">IFS_OLD=<span class="variable">$IFS</span></span></span><br><span class="line"><span class="string">IFS=$'\n'</span></span><br><span class="line"><span class="string"># 循环</span></span><br><span class="line"><span class="string">for filename in <span class="variable">$zip_file_list</span></span></span><br><span class="line"><span class="string">do</span></span><br><span class="line"><span class="string">zipPath=<span class="variable">$&#123;filename%.*&#125;</span>_<span class="variable">$&#123;pass&#125;</span>.zip # zip 路径</span></span><br><span class="line"><span class="string">zip -rjqP "</span><span class="variable">$password</span><span class="string">" "</span><span class="variable">$zipPath</span><span class="string">" "</span><span class="variable">$filename</span><span class="string">" # 压缩</span></span><br><span class="line"><span class="string">    [ ! -d "</span><span class="variable">$&#123;filename%/*&#125;</span>/<span class="keyword">done</span><span class="string">" ] &amp;&amp; mkdir "</span><span class="variable">$&#123;filename%/*&#125;</span>/<span class="keyword">done</span><span class="string">" # 移动路径</span></span><br><span class="line"><span class="string">    mv "</span><span class="variable">$filename</span><span class="string">" "</span><span class="variable">$&#123;filename%/*&#125;</span>/<span class="keyword">done</span>/<span class="variable">$&#123;filename##*/&#125;</span><span class="string">" # 移动</span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IFS=<span class="variable">$IFS_OLD</span></span></span><br><span class="line"><span class="string"># 上传百度网盘</span></span><br><span class="line"><span class="string">/opt/baidupcs/baidupcs upload "</span>*_<span class="variable">$&#123;pass&#125;</span>.zip<span class="string">" "</span><span class="variable">$uplaodPath</span><span class="string">"</span></span><br></pre></td></tr></table></figure><h1 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h1><p><code>zip -rjqP</code> ，r 递归所有子文件，j 不保留文件目录结构， q 安静模式， P 设置密码，其后跟密码。</p><p><code>find &quot;$ROOT_PATH&quot; -maxdepth 1 -iname &quot;*my.file&quot;</code>， <code>-maxdepth 1</code> 最大递归深度1，参数放置位置紧跟在 find 路径后。</p><p><code>/opt/baidupcs/baidupcs</code> 为 <a href="https://github.com/iikira/BaiduPCS-Go" target="_blank" rel="noopener">BaiduPCS-Go</a> 客户端。具体可以看其说明文档。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;文件批量使用 zip 打包并上传 百度网盘备份。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>a-simple-script-to-count-ABC</title>
    <link href="http://rachpt.me/2018/06/21/a-simple-script-to-count-ABC/"/>
    <id>http://rachpt.me/2018/06/21/a-simple-script-to-count-ABC/</id>
    <published>2018-06-20T17:09:03.000Z</published>
    <updated>2018-06-20T17:26:43.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一份规整的 excel 表格，需要统计每一行所有 ABC 的个数,求和放到最后一行。</p></blockquote><a id="more"></a><p>我是不会手工数的，当然是写个小程序或者说是脚本更准确。</p><p>代码如下：<br>可以先 <code>wc -l</code> 看一下 csv 文件行数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> &#123;1..72&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    count=`cat data.csv|sed -n <span class="string">"<span class="variable">$&#123;n&#125;</span> p"</span>|egrep -o <span class="string">'A|B|C'</span>|wc -l`</span><br><span class="line">    sed -i <span class="string">"<span class="variable">$n</span> s/$/,<span class="variable">$count</span>/"</span> data.csv</span><br><span class="line">    count=0</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>当然开始前（与windows有文件交换）使用 <code>dos2unix</code> 转换一下，结束后 <code>unix2dos</code> 换回来。</p><p>这里记录一下。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;一份规整的 excel 表格，需要统计每一行所有 ABC 的个数,求和放到最后一行。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>install-CAJViewer-on-Linux</title>
    <link href="http://rachpt.me/2018/06/05/install-CAJViewer-on-Linux/"/>
    <id>http://rachpt.me/2018/06/05/install-CAJViewer-on-Linux/</id>
    <published>2018-06-05T06:36:35.000Z</published>
    <updated>2018-06-05T12:14:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在安装 Linux 上安装 <em>CAJViewer</em> 阅读 caj 文件。使用 crossover 容器安装。</p></blockquote><a id="more"></a><h1 id="crossover"><a href="#crossover" class="headerlink" title="crossover"></a>crossover</h1><p>crossover 运行在 linux 和 mac 上的用以安装 windows 软件的一个兼容层，商业软件，可以试用几天。为何不用免费开源的 wine？因为目前使用 wine 安装的 Tim 有致命 bug，及其容易卡死软件，而使用 crossover 安装的 Tim 几乎完美（有几个小 bug，传文件OK），安装 crossover 可以参考：</p><blockquote><p>可以在此下载 <a href="https://www.newasp.net/soft/423534.html" target="_blank" rel="noopener">https://www.newasp.net/soft/423534.html</a> 。</p><p><a href="https://jingyan.baidu.com/article/e3c78d649c67dd3c4c85f533.html" target="_blank" rel="noopener">永久试用教程</a> 。 </p><p>补丁： <a href="https://pan.baidu.com/s/1eSgLS6u" target="_blank" rel="noopener">https://pan.baidu.com/s/1eSgLS6u</a> ，或者 <a href="https://pan.baidu.com/s/1kVTeir1" target="_blank" rel="noopener">https://pan.baidu.com/s/1kVTeir1</a> 密码：bov7  。</p></blockquote><p><img src="https://imagizer.imageshack.com/img921/2637/4k67Gn.png" alt="picture"></p><p>如果使用的是 英文界面，可能会有较为严重的中文支持问题。这里打包了 win10 中文默认字体。</p><p>蓝奏云 <a href="https://www.lanzous.com/i15vvsb" target="_blank" rel="noopener">https://www.lanzous.com/i15vvsb</a> ，注意使用的 xz 压缩， 改成7z后缀方便上传用。</p><p>如下图所示，在软件容器中放入字体文件就能解决中文乱码问题。</p><p><img src="https://imagizer.imageshack.com/img921/7375/VwZ3zR.png" alt="picture"></p><h1 id="CAJViewer"><a href="#CAJViewer" class="headerlink" title="CAJViewer"></a>CAJViewer</h1><p> 直接去 <a href="https://www.newasp.net/soft/423534.html" target="_blank" rel="noopener">CNKI</a> 下载 <em>CAJViewer 7.2</em> ，也可以直接在 crossover 里面下载，也是 7.2 版。</p><p> 直接 使用 软件建议的 xp 兼容层安装。</p><p><img src="https://imagizer.imageshack.com/img921/9374/ZXzwtu.png" alt="picture"></p><p>至此，可能觉得已经万事大吉，不然，当运行软件时，会提示：</p><p><code>MSXML not regester</code> ，然后软件闪退。</p><p>原因可能是没有必要的运行库。</p><p>对于 xp 兼容层，安装 运行库 2010，如下图示。注意 安装到 CAJViewer 的容器里面。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fs0bry2y7dj20tl0kktc1.jpg" alt="pic"></p><p>最后提示，别忘了复制中文字体到 CAJViewer 容器字体文件夹。</p><p>CAJViewer 运行图。</p><p><img src="https://imagizer.imageshack.com/img921/8148/ez0tsu.png" alt="picture"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在安装 Linux 上安装 &lt;em&gt;CAJViewer&lt;/em&gt; 阅读 caj 文件。使用 crossover 容器安装。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="CAJViewer" scheme="http://rachpt.me/tags/CAJViewer/"/>
    
  </entry>
  
  <entry>
    <title>upgrade-ubuntu-stepped-pit</title>
    <link href="http://rachpt.me/2018/05/07/upgrade-ubuntu-stepped-pit/"/>
    <id>http://rachpt.me/2018/05/07/upgrade-ubuntu-stepped-pit/</id>
    <published>2018-05-07T12:31:19.000Z</published>
    <updated>2018-05-10T01:58:37.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>日常干活用的 mint，特殊情况换到 ubuntu 上干活，一直很烦 窗口关闭按钮一会儿在左边一会儿在右边，考虑到娱乐用的 windows 也在右边，所以看到 ubuntu 18.04 lts 的关闭按钮在右侧，于是有了将 16.04 lts （unity 好像没法设置按钮）升级的想法。</p></blockquote><a id="more"></a><h1 id="换更新源"><a href="#换更新源" class="headerlink" title="换更新源"></a>换更新源</h1><p>之前一直用的 清华的源，毕竟同一个局域网速度快。前几天，大概 5月4日，一直检测不到新版本，于是换了个 阿里云 的，一下检测到新的版本，载了一个多小时，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">do</span>-release-upgrade -d</span><br></pre></td></tr></table></figure><p><a href="https://www.appinn.com/ubuntu-16-04-to-ubuntu-18-04-lts/" target="_blank" rel="noopener">参考内容。</a></p><p>期间不能跑，需要选择配置。因为不想继续使用 unity ，所示选择安装 GNOME 3。</p><p>重启后，以前的 <code>ctrl + alt + f7</code> 变成了 <code>ctrl + alt + f1</code> 。</p><p>差点吓傻了我，屏幕被放得很大，找了下，发现是 无障碍模式某个都系被打开了，这可能是之前开了大小写指示器的原因所致。</p><h1 id="python3-6"><a href="#python3-6" class="headerlink" title="python3.6"></a>python3.6</h1><p>python3.5 被升级至 3.6 版本。为什么我关心python版本，应为之前安装 flexget ，官方说是不支援 py3.6，因为2.7还在，所以先 用 pip2 重新安装了 flexget 。正在愁以后是不是要装个虚拟环境 装 3.5，某天再看 flexget 的主页，居然支持 3.6了，balabala……</p><p>问题就是 pip 还是 pip3.5 ，而非 3.6 ，</p><p>没办法了，一个一个改，使用 find 搜了一下所有 python3.5 的残留相关文件，cd 过去 cat 看看能不能删。最主要的就是 pip3.5 这个也得干掉（sudo apt remove pip3.5），将python 的脚本文件夹<code>/usr/local/lib/python3.5/dist-packages/</code> 改到3.6，我可不想再一个一个 pip 重装。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo apt remove pip3.5</span><br><span class="line"></span><br><span class="line">sudo rm /usr/share/app-install/desktop/python3.5:python3.5.desktop</span><br><span class="line">sudo rm -f/usr/share/app-install/desktop/idle-python3.5:idle-python3.5.desktop</span><br><span class="line">sudo rm -f /usr/share/app-install/desktop/idle-python3.5:idle-python3.5.desktop</span><br><span class="line"></span><br><span class="line">sudo rm -r python3.5</span><br><span class="line">sudo rm  /var/lib/dpkg/info/python3.5-minimal.list</span><br><span class="line">sudo rm /var/lib/dpkg/info/libpython3.5-minimal:amd64.list</span><br><span class="line"></span><br><span class="line">sudo rm -r /usr/<span class="built_in">local</span>/lib/python3.6 <span class="comment">#先看下里面的东西</span></span><br><span class="line">sudo mv /usr/<span class="built_in">local</span>/lib/python3.5 /usr/<span class="built_in">local</span>/lib/python3.6</span><br><span class="line">sudo rm /var/lib/dpkg/info/libpython3.5-minimal:amd64.postrm</span><br><span class="line">sudo rm /var/lib/dpkg/info/python3.5-minimal.postrm</span><br><span class="line"><span class="comment">#/home/[username]/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/JediHTTP/vendor/parso/test/normalizer_issue_files/</span></span><br><span class="line"><span class="comment"># 上面这个不要 remove</span></span><br><span class="line"></span><br><span class="line">sudo apt install python3-pip</span><br><span class="line">sudo pip3 install --upgrade pip</span><br></pre></td></tr></table></figure><p>附上 修改 pip 源。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.pip/pip.conf </span><br><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">extra-index-url= https://pypi.doubanio.com/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure><p>需要自己创建该文件。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;日常干活用的 mint，特殊情况换到 ubuntu 上干活，一直很烦 窗口关闭按钮一会儿在左边一会儿在右边，考虑到娱乐用的 windows 也在右边，所以看到 ubuntu 18.04 lts 的关闭按钮在右侧，于是有了将 16.04 lts （unity 好像没法设置按钮）升级的想法。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ubuntu" scheme="http://rachpt.me/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>extra-shell-note</title>
    <link href="http://rachpt.me/2018/05/07/extra-shell-note/"/>
    <id>http://rachpt.me/2018/05/07/extra-shell-note/</id>
    <published>2018-05-07T06:31:04.000Z</published>
    <updated>2018-09-06T03:23:49.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>自学收集的一些有用的 shell 奇淫妙技。</p></blockquote><a id="more"></a><h1 id="unset"><a href="#unset" class="headerlink" title="unset"></a>unset</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> 变量名</span><br><span class="line"><span class="built_in">unset</span> .f 函数名</span><br></pre></td></tr></table></figure><p><code>.f</code> 前后有空格。用于删除定义了的变量与函数。</p><h1 id="包含文件"><a href="#包含文件" class="headerlink" title="包含文件"></a>包含文件</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. filePath</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> filePath</span><br></pre></td></tr></table></figure><p><code>.</code>  后面有一空格。</p><h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>shell 没有块注释，可以使用一对<code>花括号</code>将需要注释的内容包起来，定义成一个函数，但是后面不使用改函数，从而曲线救国。</p><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><p><a href="http://c.biancheng.net/cpp/view/7001.html" target="_blank" rel="noopener">获取字符串长度</a> </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string=<span class="string">"abcd"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#string&#125;</span> <span class="comment">#输出 4</span></span><br></pre></td></tr></table></figure><p>提取子字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string=&quot;alibaba is a great company&quot;</span><br><span class="line">echo $&#123;string:1:4&#125; #输出liba</span><br></pre></td></tr></table></figure><p>查找子字符串</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string=<span class="string">"alibaba is a great company"</span></span><br><span class="line"><span class="built_in">echo</span> `expr index <span class="string">"<span class="variable">$string</span>"</span> is` <span class="comment"># 查找 i s 在变量中的位置</span></span><br></pre></td></tr></table></figure><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>之前一直不会用，get 到技能，这里记录一下。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">    </span><br><span class="line">NAME[0]=<span class="string">"Zara"</span></span><br><span class="line">NAME[1]=<span class="string">"Qadir"</span></span><br><span class="line">NAME[2]=<span class="string">"Mahnaz"</span></span><br><span class="line">NAME[3]=<span class="string">"Ayan"</span></span><br><span class="line">NAME[4]=<span class="string">"Daisy"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"First Index: <span class="variable">$&#123;NAME[0]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Second Index: <span class="variable">$&#123;NAME[*]&#125;</span>"</span> </span><br><span class="line"><span class="comment"># * 与 @ 效果一样，显示全部</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;NAME[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NAME[$i]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量修改</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;NAME[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">NAME[<span class="variable">$i</span>]=`expr <span class="variable">$i</span> + 5 `</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NAME[$i]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>其他赋值方式</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array=(var1 var2)</span><br><span class="line">array=([0]=var1 [1]=var2)</span><br><span class="line">array[0]=var1</span><br></pre></td></tr></table></figure><p><strong>计算数组元素个数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#array[@]&#125;</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="variable">$&#123;#array[*]&#125;</span></span><br></pre></td></tr></table></figure><p><strong>遍历</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i = 0; i &lt; <span class="variable">$&#123;#array[@]&#125;</span>; i++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;array[$i]&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/Lockey23/article/details/74625744?locationNum=9&amp;fps=1" target="_blank" rel="noopener">参考内容1</a>, <a href="https://chenjx.cn/write-bash-script/" target="_blank" rel="noopener">内容2</a>. </p><h1 id="无限循环"><a href="#无限循环" class="headerlink" title="无限循环"></a>无限循环</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    somescripts;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    somescripts;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="取最后一行"><a href="#取最后一行" class="headerlink" title="取最后一行"></a>取最后一行</h1><p>获取最后一行数据。</p><p>法一，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$varibles</span> | tail -1</span><br></pre></td></tr></table></figure><p>法二，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$varibles</span> | awk <span class="string">'END&#123;print&#125;'</span></span><br></pre></td></tr></table></figure><p>法三，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$varibles</span> | sed -n <span class="string">'$p'</span></span><br></pre></td></tr></table></figure><p>其他，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'$!N;$!D'</span></span><br><span class="line"><span class="comment"># 获取最后两行</span></span><br><span class="line"><span class="comment"># 一样的效果</span></span><br><span class="line">awk <span class="string">'&#123;b=a"\n"$0;a=$0&#125;END&#123;print b&#125;'</span></span><br></pre></td></tr></table></figure><p><a href="http://bbs.51cto.com/viewthread.php?tid=961661&amp;page=1&amp;authorid=1170427" target="_blank" rel="noopener">参考资料</a> 。</p><h1 id="不让别名生效"><a href="#不让别名生效" class="headerlink" title="不让别名生效"></a>不让别名生效</h1><p>在 <code>.bashrc</code> 或者 <code>.profile</code> 里面定义 <code>alias</code> 可以简化命令输入，但有时想用非别名命令，可以在前面加一个 <code>\\</code> ，如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\grep something filename</span><br></pre></td></tr></table></figure><h1 id="ps-命令"><a href="#ps-命令" class="headerlink" title="ps 命令"></a>ps 命令</h1><p><code>ps</code> 命令的参数有：</p><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">-a</td><td style="text-align:center">显示所有进程（包括其他用户的）</td></tr><tr><td style="text-align:center">-u</td><td style="text-align:center">用户以及其他信息</td></tr><tr><td style="text-align:center">-x</td><td style="text-align:center">显示没有控制终端的进程</td></tr></tbody></table><p>特别地，<code>ps aux</code> 这种短格式不加减号（-）也是合法的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pidof sshd <span class="comment"># 显示程序 PID</span></span><br><span class="line"><span class="built_in">kill</span> 3459 <span class="comment"># 停止PID对应程序</span></span><br><span class="line">killall httpd <span class="comment"># 终止程序所有进程</span></span><br></pre></td></tr></table></figure><h1 id="有用的小命令"><a href="#有用的小命令" class="headerlink" title="有用的小命令"></a>有用的小命令</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">last <span class="comment"># 系统登录记录</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">history</span> <span class="comment"># 执行命令历史</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 几个全称</span></span><br><span class="line">su：Swith user  <span class="comment"># 切换用户，切换到root用户</span></span><br><span class="line">cat：Concatenate <span class="comment"># 串联</span></span><br><span class="line">uname：Unix name <span class="comment"># 系统名称</span></span><br><span class="line">df：Disk free <span class="comment"># 空余硬盘</span></span><br><span class="line">du：Disk usage <span class="comment"># 硬盘使用率</span></span><br><span class="line">tar：Tape archive <span class="comment"># 解压文件</span></span><br><span class="line"><span class="built_in">pwd</span>：<span class="built_in">print</span> working Directory <span class="comment"># 打印工作目录</span></span><br><span class="line">grep：global regular expression <span class="built_in">print</span></span><br><span class="line">sudo：Superuser <span class="keyword">do</span></span><br><span class="line">chown：Change owner <span class="comment"># 改变所有者</span></span><br><span class="line">chgrp：Change group <span class="comment"># 改变用户组</span></span><br><span class="line">chmod：Change mode <span class="comment"># 改变模式</span></span><br><span class="line"><span class="comment"># 路径全称</span></span><br><span class="line">/bin = BINaries </span><br><span class="line">/dev = DEVices </span><br><span class="line">/etc = Editable Text Configuration <span class="comment"># 配置文件</span></span><br><span class="line">/opt = Optional application software packages</span><br><span class="line">/lib = LIBrary </span><br><span class="line">/tmp = TeMPorary </span><br><span class="line">/usr = Unix Shared Resources </span><br><span class="line">/var = VARiable <span class="comment"># 储存各种变化</span></span><br><span class="line">/proc = PROCesses </span><br><span class="line">/sbin = Superuser BINaries</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">more filename <span class="comment"># 一页一页看</span></span><br><span class="line">head -n 20 filename <span class="comment"># 看头，默认 10行</span></span><br><span class="line">head - 20 filename <span class="comment"># 简洁的写法</span></span><br><span class="line">tail ... <span class="comment"># 和head类似，显示 尾部</span></span><br><span class="line">tr [原始字符] [目标字符] <span class="comment"># 替换，例子如下</span></span><br><span class="line">cat filename | tr [a-z] [A-Z] <span class="comment"># 全部大写</span></span><br><span class="line">wc -lwc <span class="comment"># 统计字等</span></span><br><span class="line"><span class="built_in">stat</span> filename <span class="comment"># 文件详情</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cut 按 列 提取文本</span></span><br><span class="line">tail -20 ～/.bash_history |cut -d<span class="string">' '</span> -f2</span><br><span class="line"><span class="comment"># -d 设置分割， -法显示列</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># diff 比较文件差异</span></span><br><span class="line">diff -c fileA.sh fileB.sh</span><br><span class="line"><span class="comment"># -c 详情， --brief 给出判断结果</span></span><br></pre></td></tr></table></figure><p><code>touch</code> 修改已经存在文件的信息。</p><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">-a</td><td style="text-align:center">修改“读取时间”（atime）</td></tr><tr><td style="text-align:center">-m</td><td style="text-align:center">修改“修改时间”（mtime）</td></tr><tr><td style="text-align:center">-d</td><td style="text-align:center">上面两者同时修改</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch -d <span class="string">'2018-05-15 01:22:23'</span> filemname</span><br></pre></td></tr></table></figure><h1 id="历史命令"><a href="#历史命令" class="headerlink" title="历史命令"></a>历史命令</h1><p><code>！数字</code> 用于重复执行某次命令。<br><code>history</code> 查看历史命令。<br><code>mkdir -p /a/b/c</code> 递归迭代创建文件夹。</p><h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><ul><li>多个匹配：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'1,3s/my/your/g; 3,$s/This/That/g'</span> my.txt</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">sed -e <span class="string">'1,3s/my/your/g'</span> -e <span class="string">'3,$s/This/That/g'</span> my.txt</span><br></pre></td></tr></table></figure><ul><li>使用<code>&amp;</code>来当做被匹配的变量</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'s/my/[&amp;]/g'</span> my.txt</span><br></pre></td></tr></table></figure><ul><li>圆括号</li></ul><p>使用圆括号匹配的示例：（圆括号括起来的正则表达式所匹配的字符串会可以当成变量来使用，sed中使用的是\1,\2…）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'s/This is my \([^,&amp;]*\),.*is \(.*\)/\1:\2/g'</span> my.txt</span><br><span class="line">cat:betty</span><br><span class="line">dog:frank</span><br><span class="line">fish:george</span><br><span class="line">goat:adam</span><br></pre></td></tr></table></figure><p>上面这个例子中的正则表达式有点复杂，解开如下（去掉转义字符）：</p><p>正则为：<code>This is my (\[^,&amp;]\*),.\*is (.*)</code><br>匹配为：<code>This is my (cat),……….is (betty)</code></p><p>然后：<code>\1</code>就是cat，<code>\2</code>就是betty.</p><p><a href="https://coolshell.cn/articles/9104.html" target="_blank" rel="noopener">参考内容</a>。<a href="http://rachpt.github.io/2018/03/23/notes-for-shell-scripting-bible/#and-%E7%AC%A6%E5%8F%B7" target="_blank" rel="noopener">或者这里</a>。</p><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 变量    意义</span></span><br><span class="line"><span class="variable">$0</span>        脚本文件名</span><br><span class="line"><span class="variable">$1</span>/<span class="variable">$2</span>     第N(&gt;1)个参数</span><br><span class="line"><span class="variable">$#</span>        参数个数</span><br><span class="line"><span class="variable">$@</span>        所有参数(数组)</span><br><span class="line">$*        所有参数(字符串)</span><br><span class="line">$-        当前脚本执行时的附加参数，比如`-x`</span><br><span class="line"><span class="variable">$_</span>        最近的参数（或者当前脚本执行的目录）</span><br><span class="line"><span class="variable">$IFS</span>      输入字段分隔符，一般是空格</span><br><span class="line">$!        最近的后台执行的命令</span><br><span class="line">$$        当前脚本的 pid</span><br><span class="line">$?        脚本执行后的返回值</span><br></pre></td></tr></table></figure><p>当脚本内需要向另一个脚本或函数传递所有参数时:<br>应使用<code>&quot;$@&quot;</code>而不是<code>$*</code>或者<code>&quot;$*&quot;</code>。<code>&quot;$@&quot;</code>会把所有参数都按原样传递过去，而<code>$*</code>遇到有空格的参数会分割成多个，<code>&quot;$*&quot;</code>则是把所有参数变成一个参数（字符串）传进去。</p><h1 id="vim-编辑后无权限"><a href="#vim-编辑后无权限" class="headerlink" title="vim 编辑后无权限"></a>vim 编辑后无权限</h1><p>在底栏模式下:<br>:w !sudo tee %<br>然后按提示输入密码 确认:<code>[O]K, (L)oad File:</code> 输入 L 会重新载入,丢失所有操作记录,推荐直接使用 O.<br>解析: 此命令是把当前文件(即%)作为stdin传给sudo tee命令来执行.</p><p>不用 tee 的实现方式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:w !sudo sh -c &quot;cat &gt; %&quot;</span><br><span class="line"></span><br><span class="line"># 当然可以在 vimrc 里面加入下一个映射.</span><br><span class="line">cmap w!! w !sudo sh -c &quot;cat &gt; %&quot;</span><br></pre></td></tr></table></figure></p><p><code>:r !pwd</code> 或 <code>:r !ls</code> 将执行结果复制到 vim 中.</p><p>vim 替换中，<code>%</code>的意义是代表整个文件，而执行外部命令时则是文件名.</p><p>可以详见 <a href="https://www.jb51.net/LINUXjishu/608817.html" target="_blank" rel="noopener">此处</a>.</p><h1 id="查看归档或压缩文件内容"><a href="#查看归档或压缩文件内容" class="headerlink" title="查看归档或压缩文件内容"></a>查看归档或压缩文件内容</h1><p>无需解压，查看 归档文件包含的内容。</p><ol><li><p>vim<br>命令模式下直接使用 vim 可以查看归档文件内容。</p></li><li><p>tar -tf 文件路径<br>此法在 man tar 有说。</p></li><li><p>rar unrar zip unzip</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rar v 文件.rar</span><br><span class="line"><span class="comment"># 字幕 L</span></span><br><span class="line">unrar l 文件.rar</span><br><span class="line"></span><br><span class="line">zip -sf 文件.zip</span><br><span class="line"></span><br><span class="line">unzip -l 文件.zip</span><br></pre></td></tr></table></figure><ol><li>其他</li></ol><p><code>zipinfo</code> <code>zcat</code> <code>zless</code><br>以及 <code>less</code>。</p><p>待续……</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;自学收集的一些有用的 shell 奇淫妙技。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="shell" scheme="http://rachpt.me/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>flexget-and-transmission-on-ubuntu</title>
    <link href="http://rachpt.me/2018/05/07/flexget-and-transmission-on-ubuntu/"/>
    <id>http://rachpt.me/2018/05/07/flexget-and-transmission-on-ubuntu/</id>
    <published>2018-05-06T16:30:00.000Z</published>
    <updated>2018-05-07T05:48:17.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Flexget 进阶。自动下载与删除。<br><a id="more"></a></p></blockquote><h1 id="安装-flexget"><a href="#安装-flexget" class="headerlink" title="安装 flexget"></a>安装 flexget</h1><p>flexget 需要 python2.7, 3.4, 3.5 或者 3.6。（居然支持3.6了  (￣▽￣)／ ）</p><p>命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install flexget</span><br><span class="line"></span><br><span class="line">flexget -V <span class="comment"># 检查版本</span></span><br><span class="line">flexget check <span class="comment"># 检查配置文件</span></span><br><span class="line">flexget --<span class="built_in">test</span> execute <span class="comment"># 测试</span></span><br><span class="line">flexget status <span class="comment"># 状态</span></span><br><span class="line">flexget --db-cleanup <span class="comment"># 初始化 SQLite数据库</span></span><br><span class="line">flexget execute <span class="comment"># 运行</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> flexget <span class="comment"># 查看安装路径，用于 crontab 定时任务</span></span><br></pre></td></tr></table></figure></p><p><a href="http://rachpt.me/2018/03/23/notes-for-shell-scripting-bible/">crontab 配置参考</a> 。</p><p>Control daemon:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo status flexget</span><br><span class="line">sudo stop flexget</span><br><span class="line">sudo start flexget</span><br></pre></td></tr></table></figure><h1 id="yml-配置文件"><a href="#yml-配置文件" class="headerlink" title="yml 配置文件"></a>yml 配置文件</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">templates:</span></span><br><span class="line"><span class="attr">  default:</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      host:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">9091</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">username</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">'password'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    free_space:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"><span class="attr">      space:</span> <span class="number">10240</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    download:</span> <span class="string">/home/rc/Downloads</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  limit_size:</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">512</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">61440</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  clean:</span></span><br><span class="line"><span class="attr">    clean_transmission:</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">      host:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">9091</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">username</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">'password'</span></span><br><span class="line"><span class="attr">      finished_for:</span> <span class="number">7</span> <span class="string">days</span></span><br><span class="line"><span class="attr">      tracker:</span> <span class="string">xxxxxxx|xxxxx</span></span><br><span class="line"><span class="attr">      delete_files:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">    disable:</span> <span class="string">details</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  ttg_wiki:</span></span><br><span class="line"><span class="attr">    if:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'1080p' in title"</span><span class="string">:</span> <span class="string">reject</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'720p' + 'WiKi' in title"</span><span class="string">:</span> <span class="string">accept</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="attr">  byr_test:</span></span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    accept_all:</span> <span class="literal">yes</span> </span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line">      <span class="comment">#- limit_size</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">52</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">6144</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      ratio:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  wiki:</span>   </span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    accept_all:</span> <span class="literal">yes</span> </span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">limit_size</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">clean</span> </span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line">      <span class="comment">#ratio: 2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/data</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">##----------------##</span></span><br><span class="line"><span class="attr">  hdsky:</span></span><br><span class="line"><span class="attr">    rss:</span> <span class="attr">https://xxxxx.xxx</span></span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">default</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">clean</span></span><br><span class="line"><span class="attr">    if:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'Complete' in title"</span><span class="string">:</span> <span class="string">reject</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"'iPad' in title"</span><span class="string">:</span> <span class="string">accept</span></span><br><span class="line"><span class="attr">    content_size:</span></span><br><span class="line"><span class="attr">      min:</span> <span class="number">400</span></span><br><span class="line"><span class="attr">      max:</span> <span class="number">10240</span></span><br><span class="line"><span class="attr">      strict:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">    transmission:</span></span><br><span class="line"><span class="attr">      ratio:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/srv/ftp/mp4</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">##----------------##</span></span><br></pre></td></tr></table></figure><p>#  号注释，yml 需要严格对齐，使用<code>两个空格缩进</code>，形成代码块，yml 文件的语法格式：<code>字段+冒号+空格+内容</code> 。</p><p>templates:  # 模板。</p><p>tasks:  # 任务。</p><p><a href="https://flexget.com/Plugins/transmission" target="_blank" rel="noopener">transmission 模块</a>需要安装，另外，transmission-daemon或者 GUI 需要设置 rpc。</p><p>模块transmission password 记得加上引号。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install transmissionrpc</span><br></pre></td></tr></table></figure><p>space 单位 M，content_size 一样，用于限制大小。download 放的是torrent文件路径。path 为种子内容下载路径。</p><p>具体可以参考 <a href="https://flexget.com/Configuration" target="_blank" rel="noopener">官方文档</a>。</p><p>使用 transmission 模块和使用 watch-dir 相比，更灵活更方便，对不同的 rss ，可以设置不同的分享率 ratio ，以及不同的下载路径 path 。但是添加了的 torrent 文件需要自己写其他脚本删除或者移动。参见<a href="#tr-auto-delete_">其他</a>。</p><h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1><p>使用 flexget 的自动删种可能效果不是很好，需要使用另外的脚本处理。</p><p>待续……</p><p><a href="https://blog.wangyan.org/bt-shell-transmission-clean/" target="_blank" rel="noopener">参考1</a> ，<a href="https://linux.die.net/man/1/transmission-remote" target="_blank" rel="noopener">参考2 transmission-remote</a> ，<a href="http://www.kalso.net/archives/781" target="_blank" rel="noopener">参考3</a> 。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>如果想在种子发布一段时间后猜开始下载，比如越过 新种免费期，可以使用下面的脚本配合 watch-dir 实现。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author rachpt@126.com</span></span><br><span class="line"><span class="comment">#date 2018-05-07</span></span><br><span class="line"><span class="comment">#-----------设置-------------#</span></span><br><span class="line"><span class="comment"># flexget torrent 下载路径</span></span><br><span class="line">flexgetPath=<span class="string">"/home/rachpt/Downloads/temp/"</span></span><br><span class="line"><span class="comment"># transmission watch-dir</span></span><br><span class="line">autoDownloadPath=<span class="string">"/home/rachpt/Downloads/ttg/"</span></span><br><span class="line"><span class="comment"># 间隔时间，秒</span></span><br><span class="line">intervalsTime=25200</span><br><span class="line"><span class="comment">#----------------------------#</span></span><br><span class="line">filelist=$(find <span class="variable">$flexgetPath</span> -iname <span class="string">"*.torrent*"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用换行分割</span></span><br><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">modifiedTime=`<span class="built_in">stat</span> -c %Y <span class="string">"<span class="variable">$filename</span>"</span>`</span><br><span class="line">    currentTime=`date +%s`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [  $[<span class="variable">$currentTime</span> - <span class="variable">$modifiedTime</span>] -gt <span class="variable">$intervalsTime</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">mv -f <span class="string">"<span class="variable">$filename</span>"</span> <span class="string">"<span class="variable">$autoDownloadPath</span><span class="variable">$&#123;flexgetPath##*/&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br></pre></td></tr></table></figure><p><code>&lt;span id=&quot;tr-auto-delete&quot;&gt;</code>transmission 完成下载后自动移动种子文件到指定文件夹脚本。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># author rachpt@126.com</span></span><br><span class="line"><span class="comment"># required dumptorrent to find the real name of torrent</span></span><br><span class="line"><span class="comment"># get dumptorrent here: https://sourceforge.net/projects/dumptorrent/files/</span></span><br><span class="line"><span class="comment">#----------------设置------------------#</span></span><br><span class="line">dumptorrentPath=<span class="string">"/usr/local/bin/dumptorrent"</span></span><br><span class="line">flexgetPath=<span class="string">"/home/rachpt/Downloads/ttg/"</span></span><br><span class="line">moveTotPath=<span class="string">"/home/rachpt/Downloads/finish/"</span></span><br><span class="line">logoPath=<span class="string">"/home/rachpt/Downloads/finish/info"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------日志函数---------------#</span></span><br><span class="line"><span class="keyword">function</span> printLogo &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"================================="</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"匹配成功"</span>  &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"下载到了："</span><span class="variable">$TR_TORRENT_DIR</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"种子编号："</span><span class="variable">$TR_TORRENT_ID</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"于："</span><span class="variable">$TR_TIME_LOCALTIME</span> <span class="string">" \c"</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"完成对："</span><span class="variable">$TR_TORRENT_NAME</span><span class="string">" 的移动！"</span> &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------处理空格---------------#</span></span><br><span class="line"><span class="keyword">function</span> moveBlank &#123;</span><br><span class="line">find <span class="string">"<span class="variable">$1</span>"</span> -name <span class="string">"* *"</span> |</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> name</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">na=$(<span class="built_in">echo</span> <span class="variable">$name</span> | tr <span class="string">' '</span> <span class="string">'.'</span>)</span><br><span class="line">mv <span class="string">"<span class="variable">$name</span>"</span> <span class="variable">$na</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#--------------移动种子文件-------------#</span></span><br><span class="line">moveBlank <span class="variable">$flexgetPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成点分割文件名</span></span><br><span class="line"><span class="keyword">function</span> createMoveToPath &#123;</span><br><span class="line">dotTrPath=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$newname</span>"</span> | sed <span class="string">'s/[ ][ ]*/\./g'</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="variable">$dotTrPath</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">totalMoveToPath=<span class="string">"<span class="variable">$moveTotPath</span><span class="variable">$dotTrPath</span>.torrent"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">totalMoveToPath=<span class="string">"<span class="variable">$moveTotPath</span><span class="variable">$newname</span>.torrent"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filelist=$(find <span class="variable">$flexgetPath</span> -iname <span class="string">"*.torrent.*"</span>)</span><br><span class="line"><span class="comment"># 使用换行分割</span></span><br><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$filelist</span></span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">newname=`<span class="variable">$dumptorrentPath</span> <span class="string">"<span class="variable">$filename</span>"</span> | gawk <span class="string">'BEGIN&#123;FS=":"&#125; /Name/&#123;print $2&#125;'</span>`</span><br><span class="line">    newname=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$newname</span>"</span> | sed <span class="string">'s/^ [ ]*//g'</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$newname</span>"</span> = <span class="string">"<span class="variable">$TR_TORRENT_NAME</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">createMoveToPath</span><br><span class="line">mv -f <span class="string">"<span class="variable">$filename</span>"</span> <span class="string">"<span class="variable">$totalMoveToPath</span>"</span>  &gt;&gt; <span class="variable">$logoPath</span></span><br><span class="line"></span><br><span class="line">printLogo</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$IFS_OLD</span></span><br><span class="line"><span class="comment">#----------------移动完成---------------#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Flexget 进阶。自动下载与删除。&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://rachpt.me/categories/linux/"/>
    
    
      <category term="ubuntu" scheme="http://rachpt.me/tags/ubuntu/"/>
    
      <category term="flexget" scheme="http://rachpt.me/tags/flexget/"/>
    
  </entry>
  
  <entry>
    <title>Windows 使用笔记-02</title>
    <link href="http://rachpt.me/2018/04/02/windows-note-02/"/>
    <id>http://rachpt.me/2018/04/02/windows-note-02/</id>
    <published>2018-04-02T04:00:00.000Z</published>
    <updated>2018-09-06T02:05:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>承诺好的笔记，一直没写，一是不好意思，因为我已经转向 linux 了，不好说啥，二是才学疏浅，想到没必要将自己的观点强加到他人身上。</p><p>但还是继续，承诺需要兑现。</p></blockquote><a id="more"></a><h1 id="装机后驱动"><a href="#装机后驱动" class="headerlink" title="装机后驱动"></a>装机后驱动</h1><p>不管是核心显卡还是独立显卡，刚刚装好系统后，显示一般都比较粗大，甚至是模糊，亮度最大，不能调节，这是驱动的问题，需要更新驱动。如果不是很老的机器，或者硬件特殊，只需要使用 windows 的系统更新即可自动装好合适的驱动。</p><p>你可能需要先激活系统才能进行自定义设置。激活工具推荐 01笔记文末 链接。</p><p>如果嫌 windows 系统更新的下载速度慢，可以使用 <a href="https://pan.baidu.com/s/1eSvl02m" target="_blank" rel="noopener">绿色版的 驱动精灵</a>安装驱动，推荐 在 <a href="http://www.zdfans.com/" target="_blank" rel="noopener">http://www.zdfans.com/</a> 上下载，或者 baidu，如果你经验足够丰富不会下到 <strong>下载器</strong> 安装流氓软件。</p><p>右键 <code>此电脑</code>  —-&gt; <code>管理</code> —-&gt;  <code>设备管理器</code>（或者 <code>ctrl + x</code>   —-&gt; <code>m</code>，或者 <code>右键</code> 开始 —-&gt; <code>设备管理器(M)</code>）进入设备管理器，没有叹号，表明几乎所有驱动 ok 了。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy2n877tnj21030nz0wq.jpg" alt="pic"></p><h1 id="关闭-windows-的自动更新"><a href="#关闭-windows-的自动更新" class="headerlink" title="关闭 windows 的自动更新"></a>关闭 windows 的自动更新</h1><p>为什么要关闭 自动更新，会不会不安全？</p><p>几乎没有坏的影响，好的到是有，之所以 你被流氓 安装 xx管家、xx助手等不是电脑中毒了，而是你自己手贱所致。如何下载到正确的软件 我之后会提到。别用软件管家！真的是没必要，贪图眼前的便利准会掉坑里。</p><p>自动更新，windows 防火墙，windows defender 这三个不是同一个东西。</p><p>如何关闭。（家庭版需要其他方法，自己百度）</p><p>点击 <code>运行</code>，或者     <code>win + R</code> ，输入 <code>gpedit.msc</code> ；或者 打开 <code>cmd</code> 输入 <code>gpedit</code> 。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy310p3rwj20r70gsq3u.jpg" alt="pic"></p><p>依次展开 <code>计算机配置</code> —-&gt; <code>管理模板</code> —-&gt; <code>windows 组件</code> —-&gt;  <code>windows 更新</code>。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy358unh2j20ky0eowfm.jpg" alt="pic"></p><p>将 <code>配置自动更新</code>  （双击打开） 改成 <code>已禁用</code> ，这是最重要的，其他的可以不改，如果你想尝试 ，请仔细阅读 说明。可以将 <code>自动更新频率</code> 设为 <code>禁用</code>。</p><p>同样的道理，你可以在这里面 禁用 onedrive  defender等。</p><p>理论上讲，只要你不自己去点 设置（<code>win+I</code>） 里面的 检查更新，系统不会自己 更新。</p><h1 id="运行库"><a href="#运行库" class="headerlink" title="运行库"></a>运行库</h1><p>Microsoft Visual C++ Redist xxxx，有些软件提醒你安装运行库，</p><p>推荐  <a href="http://www.zdfans.com/systemplus/yunxingku" target="_blank" rel="noopener">zdfans</a>  上面的运行库。说一下，这个 zdfans 大部分软件不是 他自己做的，是搬运，或者说是一种备份。自己百度 常用运行库也是可以的。</p><h1 id="别提醒我-是否"><a href="#别提醒我-是否" class="headerlink" title="别提醒我 是否"></a>别提醒我 是否</h1><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy3kbspuuj210q0p644g.jpg" alt="pic"></p><p>我知道需要运行的软件很安全，不需要这个。怎么去掉？</p><p>打开 <code>控制面板</code>（<code>win + R</code>然后输入 <code>ctontrol</code>）不行的话你点点点找一下，</p><p>展开 <code>用户账户</code>，然后再点击 <code>用户账户</code>。接着 <code>更改用户账户控制设置</code>。</p><p>滑块移到最下面，确定。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy3rh9rg3j20v80lracg.jpg" alt="pic"></p><h1 id="显示此电脑"><a href="#显示此电脑" class="headerlink" title="显示此电脑"></a>显示此电脑</h1><p><code>win + I</code> 打开设置，或者你点点点找一下，不同版本可能不一样。</p><p><code>个性化</code> —-&gt; <code>主题</code> —-&gt; <code>桌面图标设置</code>，把<code>计算机</code>勾上，其他的按需勾选。</p><p>又或者 <code>桌面 右键</code> —-&gt; <code>个性化</code> —-&gt; <code>主题</code> —-&gt; <code>桌面图标设置</code>。</p><p>点点点，没什么好说的。</p><h1 id="更干净的界面"><a href="#更干净的界面" class="headerlink" title="更干净的界面"></a>更干净的界面</h1><p>推荐 软件 <code>dism++</code>， 下载请出门百度，第一个就是（如果你没被广告）。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy41gicfdj20ks06yq3n.jpg" alt="pic"></p><p> 这个  <a href="https://www.chuyu.me/zh-Hans/index.html" target="_blank" rel="noopener">Dism++ x86/x64</a> ，就是下载链接。</p><p> 绿色软件 无需安装，解压后 推荐放到 D 盘(区别于系统盘)。</p><p>dism++ 可以干的事：</p><ul><li>清理垃圾，清理 C盘的windows 目录，我一般是全部勾上清理。</li><li>去掉 桌面 <code>快捷方式 字样</code>，<code>快捷方式箭头</code>，以及<code>小盾牌</code>，具体自己去该软件里面点点点找一下。</li><li>精简 <code>文件资源管理器</code> （就是点开此电脑的界面）左侧 的东西，比如网络、家庭组、可移动设备、以及此电脑下的 6个（或者其他）文件夹。</li><li>找回 window 照片查看器，去掉 ie 右上角笑脸。</li><li>关闭 安全警告等等 。</li><li>卸载 uwp 应用，不懂别乱卸！</li></ul><h1 id="显示复选框-扩展名等"><a href="#显示复选框-扩展名等" class="headerlink" title="显示复选框 扩展名等"></a>显示复选框 扩展名等</h1><p>如下图没什么好说的。</p><p><img src="https://ws1.sinaimg.cn/large/675bda05ly1fpy4cthwiaj20no0g43zm.jpg" alt="pic"></p><h1 id="清理注册表"><a href="#清理注册表" class="headerlink" title="清理注册表"></a>清理注册表</h1><p>软件卸载后一般会在注册表里面留下无用的记录，可以使用 <code>CCleaner</code>清理，这软件不免费，推荐 zdfans 上面下载，或者其他的 什么 大眼仔啥的。</p><p>这个软件也可以清理系统 垃圾 ，主要是 user 目录下的，注意清理别勾选 浏览器的 cookie，否则你每次都要登录。</p><p>使用绿色版！</p><h1 id="一些日用软件"><a href="#一些日用软件" class="headerlink" title="一些日用软件"></a>一些日用软件</h1><ol><li><p>bandizip</p><p><a href="https://www.bandisoft.com/bandizip/cn/" target="_blank" rel="noopener">点击到官网</a>，免费，无广告，图标主题不错！兼容 rar、7z、zip、等各种格式，压缩 推荐 使用 7z 格式，别用 rar 这个收费格式，也别用各种破解版 winRAR 了（别提免费版），好压、360压啥的也不要用。而且支持不解压 看图。自动解压功能也很好用，具体看官网的介绍。</p><p><a href="https://www.7-zip.org/" target="_blank" rel="noopener">7zip</a> 也不错，可是界面有点丑。不嫌弃用这个也可以的。</p></li><li><p>potplayer</p><p>棒子出品，质量不错，解码强，无广告，可玩性很丰富，有很多快捷键。</p><p><a href="http://potplayer.daum.net/?lang=zh_CN" target="_blank" rel="noopener">点击到官网</a> ，安装的时候记得把推荐的额外解码器都装上，保平安。如果嫌烦，可以关闭它的自动更新。开源 全平台的 <a href="http://www.videolan.org/" target="_blank" rel="noopener">vlc</a> 也是不错的，论外观易用性，还是首推 pot。我 Linux 上最喜欢的简洁 <a href="https://mpv.io/" target="_blank" rel="noopener">mpv</a> (全平台)播放器是不会推荐的，那是极客的最爱。</p><p>极客请使用 <a href="https://mpv.io/" target="_blank" rel="noopener">mpv 播放器</a>，介绍可以看<a href="https://www.iplaysoft.com/mpv.html" target="_blank" rel="noopener">这里</a>。</p></li><li><p>TIM</p><p>比 QQ 好，干净些许。</p></li><li><p>Sumatra PDF</p><p>免费小巧的 pdf &amp; 电子书（mobi、epub等）阅读软件，如果你<strong>不需要 做标记</strong>，用这个准没错，有绿色便携版，推荐使用安装版，可以关联格式。</p><p><a href="https://www.sumatrapdfreader.org/free-pdf-reader.html" target="_blank" rel="noopener">点击到官网</a> ，LaTeX 的御用 阅读器。</p></li><li><p>Gimp &amp; photoshop</p><p>这年头，不会P图，好意思说自己会用电脑？</p><p>免费 开源 跨平台 就用 Gimp，只用 win 的话，网上搜个 破解版的 ps cc，有绿色破解版，自己baidu，这玩意儿 熟能生巧。</p><p><a href="https://www.gimp.org/" target="_blank" rel="noopener">点击到 Gimp 官网</a> 。Gimp 比 PS 小巧很多，有中文官方文档。</p></li><li><p>Snipaste</p><p><a href="https://www.snipaste.com/" target="_blank" rel="noopener">点击到官网</a> ，比 QQ（TIM） 的强大，图标好看，快捷键强。免费。希望 linux 版快点出来。</p></li><li><p>写代码</p><p>Visual Studio Code，atom，sublime 破解版，notepad++，notepad2 都不错。</p><p>如果只是想看 linux 生成的 文本文件 ，notepad2 代替默认的记事本很便利 (写字板可以救急！)。</p></li><li><p>IDM &amp; FDM</p><p>下载器，区别前者收费，后者免费，但是前者感觉更好。迅雷什么的还是不要用。</p><p><a href="https://www.freedownloadmanager.org/download.htm" target="_blank" rel="noopener">Get Free Download Manager</a> ，<a href="https://pan.lanzou.com/i0lcb4d" target="_blank" rel="noopener">IDM -旧版- 绿色破解版</a> 。</p></li><li><p>视频压制</p><p>推荐使用 <a href="https://maruko.appinn.me/" target="_blank" rel="noopener">小丸工具箱</a>，如果你不会 使用 ffmpeg 的话，megui 啥的大部分人也用不着。</p></li><li><p>隆重介绍一下火绒</p><p>想不出什么理由让我不推荐它。如果你不放心 defender ，别用管家、别用卫士！</p><p><a href="https://www.huorong.cn/" target="_blank" rel="noopener">点击到官网</a> ，注意 设置取消 它的 主页推广，如果你不想被它换主页。</p></li></ol><p>先这样吧 :joy: 。</p><p>推荐阅读 <a href="https://amazing-apps.gitbooks.io/windows-apps-that-amaze-us/content/zh-CN/" target="_blank" rel="noopener">Windows 绝赞应用</a> 。 可以先关注 <a href="http://amazingapps.org/" target="_blank" rel="noopener">http://amazingapps.org/</a> 这个，截止目前就 windows 的比较完整。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;承诺好的笔记，一直没写，一是不好意思，因为我已经转向 linux 了，不好说啥，二是才学疏浅，想到没必要将自己的观点强加到他人身上。&lt;/p&gt;
&lt;p&gt;但还是继续，承诺需要兑现。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="windows" scheme="http://rachpt.me/tags/windows/"/>
    
  </entry>
  
</feed>
